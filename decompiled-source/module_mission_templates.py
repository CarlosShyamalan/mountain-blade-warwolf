from header_common import *
from header_operations import *
from header_mission_templates import *
from header_animations import *
from header_sounds import *
from header_music import *
from header_items import *
from module_constants import *

####################################################################################################################
#   Each mission-template is a tuple that contains the following fields:
#  1) Mission-template id (string): used for referencing mission-templates in other files.
#     The prefix mt_ is automatically added before each mission-template id
#
#  2) Mission-template flags (int): See header_mission-templates.py for a list of available flags
#  3) Mission-type(int): Which mission types this mission template matches.
#     For mission-types to be used with the default party-meeting system,
#     this should be 'charge' or 'charge_with_ally' otherwise must be -1.
#     
#  4) Mission description text (string).
#  5) List of spawn records (list): Each spawn record is a tuple that contains the following fields:
#    5.1) entry-no: Troops spawned from this spawn record will use this entry
#    5.2) spawn flags.
#    5.3) alter flags. which equipment will be overriden
#    5.4) ai flags.
#    5.5) Number of troops to spawn.
#    5.6) list of equipment to add to troops spawned from here (maximum 8).
#  6) List of triggers (list).
#     See module_triggers.py for infomation about triggers.
#
#  Please note that mission templates is work in progress and can be changed in the future versions.
# 
####################################################################################################################

#pilgrim_disguise = [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff, itm_throwing_daggers]
af_castle_lord = af_override_horse | af_override_weapons| af_require_civilian

mission_templates = [

	("conversation_encounter_dummy", 0, -1,
	"Conversation encounter",
	[(0, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(1, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(2, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(3, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(4, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(5, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(6, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(7, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(8, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(9, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(10, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(11, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(12, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(13, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(14, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(15, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(16, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(17, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(18, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(19, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(20, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(21, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(22, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(23, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(24, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(25, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(26, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(27, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(28, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(29, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(30, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(31, mtef_visitor_source, af_override_fullhelm, 0, 1, [])],
	[
		
	]),

	("conversation_encounter", 0, -1,
	"Conversation encounter",
	[(0, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(1, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(2, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(3, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(4, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(5, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(6, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(7, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(8, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(9, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(10, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(11, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(12, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(13, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(14, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(15, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(16, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(17, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(18, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(19, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(20, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(21, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(22, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(23, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(24, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(25, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(26, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(27, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(28, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(29, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(30, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
	(31, mtef_visitor_source, af_override_fullhelm, 0, 1, [])],
	[
		(-20.0, 0.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(eq, ":troop_id_var_1", "trp_army_size_troop"),
				(agent_equip_item, ":var_1", 1395),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_ram", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle with your battering ram...",
	[(120, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(120, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(124, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(123, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(126, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(47, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(50, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(73, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(74, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 120),
				(assign, "$enemy_first_spawn_entry", 124),
			(else_try),
				(assign, "$player_first_spawn_entry", 124),
				(assign, "$enemy_first_spawn_entry", 120),
			(try_end),
			(assign, "$defender_siege_archer_spawn_entry_1", 40),
			(assign, "$defender_siege_archer_spawn_entry_2", 41),
			(assign, "$defender_siege_archer_spawn_entry_3", 42),
			(assign, "$defender_siege_archer_spawn_entry_4", 43),
			(assign, "$defender_siege_archer_spawn_entry_5", 44),
			(assign, "$defender_siege_archer_spawn_entry_6", 45),
			(assign, "$attacker_siege_ram_spawn_entry_1", 50),
			(assign, "$attacker_siege_ram_spawn_entry_2", 73),
			(assign, "$attacker_siege_ram_spawn_entry_3", 74),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1),
			(assign, "$siege_horse_kill_need", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 0.0, ti_once,
		[
			(set_show_messages, 0),
			(try_begin),
				(eq, "$molda_siege_type", 2),
				(entry_point_get_position, 10, 92),
			(else_try),
				(eq, "$molda_siege_type", 3),
				(entry_point_get_position, 10, 81),
			(else_try),
				(eq, "$molda_siege_type", 4),
				(entry_point_get_position, 10, 103),
			(else_try),
				(entry_point_get_position, 10, 124),
			(try_end),
			(try_for_range, ":number", 0, 9),
				(neq, ":number", 1),
				(team_give_order, "$defender_team", ":number", 0),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 0),
				(team_give_order, "$defender_team_2", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 7),
			(try_end),
			(team_give_order, "$defender_team", 1, 11),
			(team_set_order_position, "$defender_team", 9, 10),
			(team_give_order, "$defender_team_2", 1, 11),
			(team_set_order_position, "$defender_team_2", 9, 10),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 1.0, ti_once,
		[
			(set_show_messages, 0),
			(team_give_order, "$attacker_team", 9, 8),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[
			(call_script, "script_siege_init_ai_and_ram")
		],

		[]),

		(0.0, 0.0, ti_once,
		[
			(call_script, "script_cf_siege_move_ram")
		],

		[]),

		(1.0, 0.0, 0.0,
		[
			(eq, "$ram_positioned", 1)
		],

		[
			(scene_prop_get_instance, ":scene_prop_instance_ram_shaft_0", "spr_ram_shaft", 0),
			(scene_prop_get_instance, ":scene_prop_instance_towngate_rectangle_door_right_0", "spr_towngate_rectangle_door_right", 0),
			(scene_prop_get_instance, ":scene_prop_instance_towngate_rectangle_door_left_0", "spr_towngate_rectangle_door_left", 0),
			(prop_instance_get_position, 1, ":scene_prop_instance_ram_shaft_0"),
			(prop_instance_get_position, 2, ":scene_prop_instance_towngate_rectangle_door_right_0"),
			(prop_instance_get_position, 3, ":scene_prop_instance_towngate_rectangle_door_left_0"),
			(val_add, "$ram_timer", 1),
			(try_begin),
				(eq, "$ram_timer", 1),
				(position_move_y, 1, -150),
				(prop_instance_animate_to_position, ":scene_prop_instance_ram_shaft_0", 1, 600),
			(else_try),
				(eq, "$ram_timer", 13),
				(position_move_y, 1, -250),
				(prop_instance_animate_to_position, ":scene_prop_instance_ram_shaft_0", 1, 600),
			(else_try),
				(eq, "$ram_timer", 24),
				(position_move_y, 1, -250),
				(prop_instance_animate_to_position, ":scene_prop_instance_ram_shaft_0", 1, 600),
			(else_try),
				(eq, "$ram_timer", 35),
				(position_move_y, 1, -250),
				(prop_instance_animate_to_position, ":scene_prop_instance_ram_shaft_0", 1, 600),
				(assign, "$ram_positioned", 3),
			(try_end),
			(try_begin),
				(eq, "$ram_timer", 9),
				(position_move_y, 1, 300),
				(prop_instance_animate_to_position, ":scene_prop_instance_ram_shaft_0", 1, 200),
				(call_script, "script_molda_prop_physics_on_off", "spr_ram_body", 0),
			(else_try),
				(eq, "$ram_timer", 20),
				(position_move_y, 1, 300),
				(prop_instance_animate_to_position, ":scene_prop_instance_ram_shaft_0", 1, 200),
			(else_try),
				(eq, "$ram_timer", 31),
				(position_move_y, 1, 300),
				(prop_instance_animate_to_position, ":scene_prop_instance_ram_shaft_0", 1, 200),
			(try_end),
			(try_begin),
				(eq, "$ram_timer", 11),
				(position_rotate_z, 2, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_towngate_rectangle_door_right_0", 2, 50),
				(particle_system_burst, "psys_dummy_smoke", 2, 100),
				(position_rotate_z, 3, 10),
				(prop_instance_animate_to_position, ":scene_prop_instance_towngate_rectangle_door_left_0", 3, 50),
				(particle_system_burst, "psys_gourd_smoke", 3, 50),
				(play_sound, "snd_siege_weapon_hit_2d"),
				(call_script, "script_molda_prop_physics_on_off", "spr_666_portculis_new", 0),
				(call_script, "script_molda_prop_visible_on_off", "spr_666_portculis_new", 0),
			(else_try),
				(eq, "$ram_timer", 22),
				(position_rotate_z, 2, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_towngate_rectangle_door_right_0", 2, 50),
				(particle_system_burst, "psys_dummy_smoke", 2, 100),
				(position_rotate_z, 3, 10),
				(prop_instance_animate_to_position, ":scene_prop_instance_towngate_rectangle_door_left_0", 3, 50),
				(particle_system_burst, "psys_gourd_smoke", 3, 50),
				(play_sound, "snd_siege_weapon_hit_2d"),
			(else_try),
				(eq, "$ram_timer", 33),
				(position_rotate_z, 2, -100),
				(prop_instance_animate_to_position, ":scene_prop_instance_towngate_rectangle_door_right_0", 2, 100),
				(particle_system_burst, "psys_dummy_smoke", 2, 500),
				(position_rotate_z, 3, 100),
				(prop_instance_animate_to_position, ":scene_prop_instance_towngate_rectangle_door_left_0", 3, 100),
				(particle_system_burst, "psys_gourd_smoke", 3, 250),
				(play_sound, "snd_siege_weapon_hit_2d"),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$catapult_end", 0),
				(gt, "$catapult_shoot_msec_5", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_5"),
				(try_begin),
					(ge, reg0, 14950),
					(call_script, "script_molda_prop_visible_on_off", "spr_ram_body", 0),
					(call_script, "script_molda_prop_visible_on_off", "spr_ram_shaft", 0),
					(call_script, "script_molda_prop_visible_on_off", "spr_ram_wheel", 0),
					(assign, "$catapult_shoot_msec_5", 0),
					(assign, "$catapult_end", 1),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(call_script, "script_cf_siege_assign_men_to_ram")
		],

		[]),

		(1.0, 0.0, 0.0,
		[
			(eq, "$town_gate_destroyed", 0),
			(this_or_next|ge, "$ram_timer", 33),
			(ge, "$catapult_attack_time", "$catapult_attack_max")
		],

		[
			(play_sound, "snd_siege_weapon_hit_2d"),
			(call_script, "script_molda_prop_physics_on_off", "spr_ram_body", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_666_siege_large_shield_plyr", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_666siege_large_shield_a", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_ram_body", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_666_siege_large_shield_plyr", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_666siege_large_shield_a", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_666_portculis_new", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_666_portculis_new", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_towngate_rectangle_door_left", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_towngate_rectangle_door_left", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_towngate_rectangle_door_right", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_towngate_rectangle_door_right", 0),
			(display_message, "str_gate_des", 0x0000ffff),
			(assign, "$town_gate_destroyed", 1),
			(assign, "$catapult_end", 1),
			(try_begin),
				(get_player_agent_no, ":player_agent_no"),
				(agent_is_alive, ":player_agent_no"),
				(agent_set_hit_points, ":player_agent_no", 100),
			(try_end),
			(store_mission_timer_c_msec, "$catapult_shoot_msec_5")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$ballista_timer1", -1),
			(assign, "$ballista_timer2", -4),
			(assign, "$ballista_shoot_msec_1", 0),
			(assign, "$ballista_shoot_msec_2", 0)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$town_gate_destroyed", 0)
		],

		[
			(try_begin),
				(eq, "$def_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannon_1"),
				(assign, ":value_2", "spr_666_cannonball_ready_1"),
				(assign, ":value_3", "spr_666_cannonball_shoot"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666_ballista_1"),
				(assign, ":value_2", "spr_666_ballista_javelin_ready_1"),
				(assign, ":value_3", "spr_666_ballista_javelin"),
				(assign, ":value_4", "snd_ballista_shoot"),
			(try_end),
			(val_add, "$ballista_timer1", 1),
			(try_begin),
				(eq, "$ballista_timer1", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value_2", 0),
				(entry_point_get_position, 1, 71),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_3"),
				(assign, "$ballista_jav_id_1", reg0),
				(prop_instance_add_particle_system, "$ballista_jav_id_1", "psys_fireplace_fire_big", 33),
				(prop_instance_add_particle_system, "$ballista_jav_id_1", "psys_torch_smoke", 33),
				(store_mission_timer_c_msec, "$ballista_shoot_msec_1"),
				(store_random_in_range, ":random_in_range_0_2", 0, 2),
				(try_begin),
					(eq, ":random_in_range_0_2", 0),
					(scene_prop_get_instance, ":scene_prop_instance_value_0", "spr_ram_body", 0),
					(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(else_try),
					(entry_point_get_position, 1, 73),
					(try_begin),
						(store_random_in_range, ":random_in_range_0_2001", 0, 2001),
						(store_random_in_range, ":random_in_range_0_2001_2", 0, 2001),
						(val_sub, ":random_in_range_0_2001", 1000),
						(val_sub, ":random_in_range_0_2001_2", 1000),
						(position_move_x, 1, ":random_in_range_0_2001"),
						(position_move_z, 1, ":random_in_range_0_2001_2"),
					(try_end),
				(try_end),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$ballista_shoot_pos_1_x", reg3),
				(assign, "$ballista_shoot_pos_1_y", reg4),
				(assign, "$ballista_shoot_pos_1_z", reg5),
				(prop_instance_animate_to_position, "$ballista_jav_id_1", 1, 150),
				(assign, "$ballista_shoot_snd_1", 0),
			(else_try),
				(eq, "$ballista_timer1", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, 55),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
			(else_try),
				(eq, "$ballista_timer1", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, -55),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
				(call_script, "script_molda_prop_visible_on_off", ":value_2", 1),
				(assign, "$ballista_timer1", -1),
			(try_end)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$town_gate_destroyed", 0)
		],

		[
			(try_begin),
				(eq, "$def_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannon_2"),
				(assign, ":value_2", "spr_666_cannonball_ready_2"),
				(assign, ":value_3", "spr_666_cannonball_shoot"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666_ballista_2"),
				(assign, ":value_2", "spr_666_ballista_javelin_ready_2"),
				(assign, ":value_3", "spr_666_ballista_javelin"),
				(assign, ":value_4", "snd_ballista_shoot"),
			(try_end),
			(val_add, "$ballista_timer2", 1),
			(try_begin),
				(eq, "$ballista_timer2", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value_2", 0),
				(entry_point_get_position, 1, 72),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_3"),
				(assign, "$ballista_jav_id_2", reg0),
				(prop_instance_add_particle_system, "$ballista_jav_id_2", "psys_fireplace_fire_big", 33),
				(prop_instance_add_particle_system, "$ballista_jav_id_2", "psys_torch_smoke", 33),
				(store_mission_timer_c_msec, "$ballista_shoot_msec_2"),
				(store_random_in_range, ":random_in_range_0_2", 0, 2),
				(try_begin),
					(eq, ":random_in_range_0_2", 0),
					(scene_prop_get_instance, ":scene_prop_instance_value_0", "spr_ram_body", 0),
					(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(else_try),
					(entry_point_get_position, 1, 74),
					(try_begin),
						(store_random_in_range, ":random_in_range_0_2001", 0, 2001),
						(store_random_in_range, ":random_in_range_0_2001_2", 0, 2001),
						(val_sub, ":random_in_range_0_2001", 1000),
						(val_sub, ":random_in_range_0_2001_2", 1000),
						(position_move_x, 1, ":random_in_range_0_2001"),
						(position_move_z, 1, ":random_in_range_0_2001_2"),
					(try_end),
				(try_end),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$ballista_shoot_pos_2_x", reg3),
				(assign, "$ballista_shoot_pos_2_y", reg4),
				(assign, "$ballista_shoot_pos_2_z", reg5),
				(prop_instance_animate_to_position, "$ballista_jav_id_2", 1, 150),
				(assign, "$ballista_shoot_snd_2", 0),
			(else_try),
				(eq, "$ballista_timer2", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, 45),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
			(else_try),
				(eq, "$ballista_timer2", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, -45),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
				(call_script, "script_molda_prop_visible_on_off", ":value_2", 1),
				(assign, "$ballista_timer2", -1),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$town_gate_destroyed", 0)
		],

		[
			(try_begin),
				(gt, "$ballista_shoot_msec_1", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$ballista_shoot_msec_1"),
				(try_begin),
					(ge, reg0, 2950),
					(prop_instance_stop_all_particle_systems, "$ballista_jav_id_1"),
					(assign, "$ballista_shoot_msec_1", 0),
				(else_try),
					(ge, reg0, 1450),
					(neq, "$ballista_shoot_snd_1", 1),
					(assign, "$ballista_shoot_snd_1", 1),
					(position_set_x, 1, "$ballista_shoot_pos_1_x"),
					(position_set_y, 1, "$ballista_shoot_pos_1_y"),
					(position_set_z, 1, "$ballista_shoot_pos_1_z"),
					(call_script, "script_molda_siege_ballista_dmg"),
					(scene_prop_set_visibility, "$ballista_jav_id_1", 0),
				(try_end),
			(try_end),
			(try_begin),
				(gt, "$ballista_shoot_msec_2", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$ballista_shoot_msec_2"),
				(try_begin),
					(ge, reg0, 2950),
					(prop_instance_stop_all_particle_systems, "$ballista_jav_id_2"),
					(assign, "$ballista_shoot_msec_2", 0),
				(else_try),
					(ge, reg0, 1450),
					(neq, "$ballista_shoot_snd_2", 1),
					(assign, "$ballista_shoot_snd_2", 1),
					(position_set_x, 1, "$ballista_shoot_pos_2_x"),
					(position_set_y, 1, "$ballista_shoot_pos_2_y"),
					(position_set_z, 1, "$ballista_shoot_pos_2_z"),
					(call_script, "script_molda_siege_ballista_dmg"),
					(scene_prop_set_visibility, "$ballista_jav_id_2", 0),
				(try_end),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$catapult_attack_time", 0),
			(assign, "$catapult_timer1", -1),
			(assign, "$catapult_timer2", -7),
			(assign, "$catapult_timer3", -4),
			(assign, "$catapult_timer4", -10),
			(assign, "$catapult_shoot_msec_1", 0),
			(assign, "$catapult_shoot_msec_2", 0),
			(assign, "$catapult_shoot_msec_3", 0),
			(assign, "$catapult_shoot_msec_4", 0),
			(assign, "$catapult_shoot_msec_5", 0),
			(assign, "$catapult_end", 0)
		]),

		(-20.0, 2.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_1"),
				(assign, ":value_2", "spr_666_cannonb_ready_2"),
				(assign, ":value_3", "spr_666_cannonb_ready_3"),
				(assign, ":value_4", "spr_666_cannonb_ready_4"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_1"),
				(assign, ":value_2", "spr_666Catapult_stone_ready_2"),
				(assign, ":value_3", "spr_666Catapult_stone_ready_3"),
				(assign, ":value_4", "spr_666Catapult_stone_ready_4"),
			(try_end),
			(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
			(init_position, 33),
			(prop_instance_add_particle_system, ":scene_prop_instance_value_0", "psys_war_smoke_tall", 33),
			(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value_2", 0),
			(init_position, 33),
			(prop_instance_add_particle_system, ":scene_prop_instance_value_0", "psys_war_smoke_tall", 33),
			(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value_3", 0),
			(init_position, 33),
			(prop_instance_add_particle_system, ":scene_prop_instance_value_0", "psys_war_smoke_tall", 33),
			(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value_4", 0),
			(init_position, 33),
			(prop_instance_add_particle_system, ":scene_prop_instance_value_0", "psys_war_smoke_tall", 33)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_1"),
				(assign, ":value_2", "spr_666_cannonball_1"),
				(assign, ":value_3", "spr_666_fake_stone_for_cannon_1"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_1"),
				(assign, ":value_2", "spr_666Catapult_stone_1"),
				(assign, ":value_3", "spr_666Catapult_pul_1"),
				(assign, ":value_4", "snd_catapult_in_battle"),
			(try_end),
			(val_add, "$catapult_timer1", 1),
			(try_begin),
				(eq, "$catapult_timer1", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, 85),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value", 0),
				(init_position, 33),
				(entry_point_get_position, 1, 56),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_2"),
				(assign, "$catapult_stone_id_1", reg0),
				(store_mission_timer_c_msec, "$catapult_shoot_msec_1"),
				(store_random_in_range, "$catapult_entry_1", 60, 71),
				(entry_point_get_position, 1, "$catapult_entry_1"),
				(prop_instance_add_particle_system, "$catapult_stone_id_1", "psys_village_fire_smoke_big", 33),
				(prop_instance_animate_to_position, "$catapult_stone_id_1", 1, 250),
				(assign, "$catapult_shoot_snd_1", 0),
			(else_try),
				(eq, "$catapult_timer1", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer1", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer1", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer1", 5),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer1", 6),
			(else_try),
				(eq, "$catapult_timer1", 7),
				(assign, "$catapult_timer1", -1),
				(call_script, "script_molda_prop_visible_on_off", ":value", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value", 0),
				(init_position, 33),
				(prop_instance_add_particle_system, ":scene_prop_instance_value_3_0", "psys_war_smoke_tall", 33),
			(try_end)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_2"),
				(assign, ":value_2", "spr_666_cannonball_2"),
				(assign, ":value_3", "spr_666_fake_stone_for_cannon_2"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_2"),
				(assign, ":value_2", "spr_666Catapult_stone_2"),
				(assign, ":value_3", "spr_666Catapult_pul_2"),
				(assign, ":value_4", "snd_catapult_in_battle"),
			(try_end),
			(val_add, "$catapult_timer2", 1),
			(try_begin),
				(eq, "$catapult_timer2", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, 85),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value", 0),
				(init_position, 33),
				(entry_point_get_position, 1, 57),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_2"),
				(assign, "$catapult_stone_id_2", reg0),
				(store_mission_timer_c_msec, "$catapult_shoot_msec_2"),
				(store_random_in_range, "$catapult_entry_2", 60, 71),
				(entry_point_get_position, 1, "$catapult_entry_2"),
				(prop_instance_add_particle_system, "$catapult_stone_id_2", "psys_village_fire_smoke_big", 33),
				(prop_instance_animate_to_position, "$catapult_stone_id_2", 1, 250),
				(assign, "$catapult_shoot_snd_2", 0),
			(else_try),
				(eq, "$catapult_timer2", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer2", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer2", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer2", 5),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer2", 6),
			(else_try),
				(eq, "$catapult_timer2", 7),
				(assign, "$catapult_timer2", -1),
				(call_script, "script_molda_prop_visible_on_off", ":value", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value", 0),
				(init_position, 33),
				(prop_instance_add_particle_system, ":scene_prop_instance_value_3_0", "psys_war_smoke_tall", 33),
			(try_end)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_3"),
				(assign, ":value_2", "spr_666_cannonball_3"),
				(assign, ":value_3", "spr_666_fake_stone_for_cannon_3"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_3"),
				(assign, ":value_2", "spr_666Catapult_stone_3"),
				(assign, ":value_3", "spr_666Catapult_pul_3"),
				(assign, ":value_4", "snd_catapult_in_battle"),
			(try_end),
			(val_add, "$catapult_timer3", 1),
			(try_begin),
				(eq, "$catapult_timer3", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, 85),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value", 0),
				(init_position, 33),
				(entry_point_get_position, 1, 57),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_2"),
				(assign, "$catapult_stone_id_3", reg0),
				(store_mission_timer_c_msec, "$catapult_shoot_msec_3"),
				(store_random_in_range, "$catapult_entry_3", 60, 71),
				(entry_point_get_position, 1, "$catapult_entry_3"),
				(prop_instance_add_particle_system, "$catapult_stone_id_3", "psys_village_fire_smoke_big", 33),
				(prop_instance_animate_to_position, "$catapult_stone_id_3", 1, 250),
				(assign, "$catapult_shoot_snd_3", 0),
			(else_try),
				(eq, "$catapult_timer3", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer3", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer3", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer3", 5),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer3", 6),
			(else_try),
				(eq, "$catapult_timer3", 7),
				(assign, "$catapult_timer3", -1),
				(call_script, "script_molda_prop_visible_on_off", ":value", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value", 0),
				(init_position, 33),
				(prop_instance_add_particle_system, ":scene_prop_instance_value_3_0", "psys_war_smoke_tall", 33),
			(try_end)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_4"),
				(assign, ":value_2", "spr_666_cannonball_4"),
				(assign, ":value_3", "spr_666_fake_stone_for_cannon_4"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_4"),
				(assign, ":value_2", "spr_666Catapult_stone_4"),
				(assign, ":value_3", "spr_666Catapult_pul_4"),
				(assign, ":value_4", "snd_catapult_in_battle"),
			(try_end),
			(val_add, "$catapult_timer4", 1),
			(try_begin),
				(eq, "$catapult_timer4", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, 85),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value", 0),
				(init_position, 33),
				(entry_point_get_position, 1, 57),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_2"),
				(assign, "$catapult_stone_id_4", reg0),
				(store_mission_timer_c_msec, "$catapult_shoot_msec_4"),
				(store_random_in_range, "$catapult_entry_4", 60, 71),
				(entry_point_get_position, 1, "$catapult_entry_1"),
				(prop_instance_add_particle_system, "$catapult_stone_id_4", "psys_village_fire_smoke_big", 33),
				(prop_instance_animate_to_position, "$catapult_stone_id_4", 1, 250),
				(assign, "$catapult_shoot_snd_4", 0),
			(else_try),
				(eq, "$catapult_timer4", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer4", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer4", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer4", 5),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer4", 6),
			(else_try),
				(eq, "$catapult_timer4", 7),
				(assign, "$catapult_timer4", -1),
				(call_script, "script_molda_prop_visible_on_off", ":value", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value", 0),
				(init_position, 33),
				(prop_instance_add_particle_system, ":scene_prop_instance_value_3_0", "psys_war_smoke_tall", 33),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonball_1"),
				(assign, ":value_2", "spr_666_cannonball_2"),
				(assign, ":value_3", "spr_666_cannonball_3"),
				(assign, ":value_4", "spr_666_cannonball_4"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_1"),
				(assign, ":value_2", "spr_666Catapult_stone_2"),
				(assign, ":value_3", "spr_666Catapult_stone_3"),
				(assign, ":value_4", "spr_666Catapult_stone_4"),
			(try_end),
			(try_begin),
				(gt, "$catapult_shoot_msec_1", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_1"),
				(try_begin),
					(ge, reg0, 18950),
					(call_script, "script_molda_prop_physics_on_off", ":value", 0),
					(call_script, "script_molda_prop_visible_on_off", ":value", 0),
					(assign, "$catapult_shoot_msec_1", 0),
				(else_try),
					(ge, reg0, 2450),
					(neq, "$catapult_shoot_snd_1", 1),
					(prop_instance_stop_all_particle_systems, "$catapult_stone_id_1"),
					(assign, "$catapult_shoot_snd_1", 1),
					(call_script, "script_molda_siege_catapult_dmg", "$catapult_entry_1"),
					(val_add, "$catapult_attack_time", 1),
					(assign, reg8, "$catapult_attack_time"),
					(assign, reg9, "$catapult_attack_max"),
					(display_message, "str_catapult_shot_num"),
				(try_end),
			(try_end),
			(try_begin),
				(gt, "$catapult_shoot_msec_2", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_2"),
				(try_begin),
					(ge, reg0, 18950),
					(call_script, "script_molda_prop_physics_on_off", ":value_2", 0),
					(call_script, "script_molda_prop_visible_on_off", ":value_2", 0),
					(assign, "$catapult_shoot_msec_2", 0),
				(else_try),
					(ge, reg0, 2450),
					(neq, "$catapult_shoot_snd_2", 1),
					(prop_instance_stop_all_particle_systems, "$catapult_stone_id_2"),
					(assign, "$catapult_shoot_snd_2", 1),
					(call_script, "script_molda_siege_catapult_dmg", "$catapult_entry_2"),
					(val_add, "$catapult_attack_time", 1),
					(assign, reg8, "$catapult_attack_time"),
					(assign, reg9, "$catapult_attack_max"),
					(display_message, "str_catapult_shot_num"),
				(try_end),
			(try_end),
			(try_begin),
				(gt, "$catapult_shoot_msec_3", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_3"),
				(try_begin),
					(ge, reg0, 18950),
					(call_script, "script_molda_prop_physics_on_off", ":value_3", 0),
					(call_script, "script_molda_prop_visible_on_off", ":value_3", 0),
					(assign, "$catapult_shoot_msec_3", 0),
				(else_try),
					(ge, reg0, 2450),
					(neq, "$catapult_shoot_snd_3", 1),
					(prop_instance_stop_all_particle_systems, "$catapult_stone_id_3"),
					(assign, "$catapult_shoot_snd_3", 1),
					(call_script, "script_molda_siege_catapult_dmg", "$catapult_entry_3"),
					(val_add, "$catapult_attack_time", 1),
					(assign, reg8, "$catapult_attack_time"),
					(assign, reg9, "$catapult_attack_max"),
					(display_message, "str_catapult_shot_num"),
				(try_end),
			(try_end),
			(try_begin),
				(gt, "$catapult_shoot_msec_4", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_4"),
				(try_begin),
					(ge, reg0, 18950),
					(call_script, "script_molda_prop_physics_on_off", ":value_4", 0),
					(call_script, "script_molda_prop_visible_on_off", ":value_4", 0),
					(assign, "$catapult_shoot_msec_4", 0),
				(else_try),
					(ge, reg0, 2450),
					(neq, "$catapult_shoot_snd_4", 1),
					(prop_instance_stop_all_particle_systems, "$catapult_stone_id_4"),
					(assign, "$catapult_shoot_snd_4", 1),
					(call_script, "script_molda_siege_catapult_dmg", "$catapult_entry_4"),
					(val_add, "$catapult_attack_time", 1),
					(assign, reg8, "$catapult_attack_time"),
					(assign, reg9, "$catapult_attack_max"),
					(display_message, "str_catapult_shot_num"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 1.0,
		[],

		[
			(assign, ":value", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_value_number", ":value", ":number"),
				(try_begin),
					(neq, ":movement_order_value_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":value", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(assign, ":value", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_value_number", ":value", ":number"),
				(try_begin),
					(neq, ":movement_order_value_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":value", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$town_gate_destroyed", 1),
				(assign, ":value", "$defender_team"),
				(try_for_range, ":number", 0, 6),
					(team_get_movement_order, ":movement_order_value_number", ":value", ":number"),
					(try_begin),
						(neq, ":movement_order_value_number", 2),
						(set_show_messages, 0),
						(team_give_order, ":value", ":number", 2),
						(set_show_messages, 1),
					(try_end),
				(try_end),
				(assign, ":value", "$defender_team_2"),
				(try_for_range, ":number", 0, 6),
					(team_get_movement_order, ":movement_order_value_number", ":value", ":number"),
					(try_begin),
						(neq, ":movement_order_value_number", 2),
						(set_show_messages, 0),
						(team_give_order, ":value", ":number", 2),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end),
			(call_script, "script_molda_siege_kill_horse_for_advance")
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_ladder_belfry", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle...",
	[(91, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(91, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(92, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(93, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(94, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(106, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(95, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(96, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(97, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(98, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(99, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(100, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(101, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 91),
				(assign, "$enemy_first_spawn_entry", 92),
			(else_try),
				(assign, "$player_first_spawn_entry", 92),
				(assign, "$enemy_first_spawn_entry", 91),
			(try_end),
			(assign, "$defence_sub_spawn_entry", 79),
			(assign, "$defender_siege_archer_spawn_entry_1", 95),
			(assign, "$defender_siege_archer_spawn_entry_2", 96),
			(assign, "$defender_siege_archer_spawn_entry_3", 97),
			(assign, "$defender_siege_archer_spawn_entry_4", 98),
			(assign, "$defender_siege_archer_spawn_entry_5", 99),
			(assign, "$defender_siege_archer_spawn_entry_6", 100),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1),
			(assign, "$siege_horse_kill_need", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 0.0, ti_once,
		[
			(set_show_messages, 0),
			(try_begin),
				(eq, "$molda_siege_type", 2),
				(entry_point_get_position, 10, 92),
			(else_try),
				(eq, "$molda_siege_type", 3),
				(entry_point_get_position, 10, 81),
			(else_try),
				(eq, "$molda_siege_type", 4),
				(entry_point_get_position, 10, 103),
			(else_try),
				(entry_point_get_position, 10, 124),
			(try_end),
			(try_for_range, ":number", 0, 9),
				(neq, ":number", 1),
				(team_give_order, "$defender_team", ":number", 0),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 0),
				(team_give_order, "$defender_team_2", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 7),
			(try_end),
			(team_give_order, "$defender_team", 1, 11),
			(team_set_order_position, "$defender_team", 9, 10),
			(team_give_order, "$defender_team_2", 1, 11),
			(team_set_order_position, "$defender_team_2", 9, 10),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$ballista_timer1", -1),
			(assign, "$ballista_timer2", -4),
			(assign, "$ballista_shoot_msec_1", 0),
			(assign, "$ballista_shoot_msec_2", 0)
		]),

		(2.0, 1.0, 1.0,
		[],

		[
			(try_begin),
				(eq, "$def_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannon_12"),
				(assign, ":value_2", "spr_666_cannonball_ready_12"),
				(assign, ":value_3", "spr_666_cannonball_shoot"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_6662_ballista_1"),
				(assign, ":value_2", "spr_6662_ballista_javelin_ready_1"),
				(assign, ":value_3", "spr_666_ballista_javelin"),
				(assign, ":value_4", "snd_ballista_shoot"),
			(try_end),
			(val_add, "$ballista_timer1", 1),
			(try_begin),
				(eq, "$ballista_timer1", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value_2", 0),
				(entry_point_get_position, 1, 75),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_3"),
				(assign, "$ballista_jav_id_1", reg0),
				(prop_instance_add_particle_system, "$ballista_jav_id_1", "psys_fireplace_fire_big", 33),
				(prop_instance_add_particle_system, "$ballista_jav_id_1", "psys_torch_smoke", 33),
				(store_mission_timer_c_msec, "$ballista_shoot_msec_1"),
				(store_random_in_range, ":random_in_range_0_2", 0, 2),
				(try_begin),
					(eq, ":random_in_range_0_2", 0),
					(entry_point_get_position, 1, 77),
					(try_begin),
						(store_random_in_range, ":random_in_range_0_251", 0, 251),
						(store_random_in_range, ":random_in_range_0_251_2", 0, 251),
						(val_sub, ":random_in_range_0_251", 125),
						(val_sub, ":random_in_range_0_251_2", 125),
						(position_move_x, 1, ":random_in_range_0_251"),
						(position_move_z, 1, ":random_in_range_0_251_2"),
					(try_end),
				(else_try),
					(entry_point_get_position, 1, 78),
					(try_begin),
						(store_random_in_range, ":random_in_range_0_251", 0, 251),
						(store_random_in_range, ":random_in_range_0_251_2", 0, 251),
						(val_sub, ":random_in_range_0_251", 125),
						(val_sub, ":random_in_range_0_251_2", 125),
						(position_move_x, 1, ":random_in_range_0_251"),
						(position_move_z, 1, ":random_in_range_0_251_2"),
					(try_end),
				(try_end),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$ballista_shoot_pos_1_x", reg3),
				(assign, "$ballista_shoot_pos_1_y", reg4),
				(assign, "$ballista_shoot_pos_1_z", reg5),
				(prop_instance_animate_to_position, "$ballista_jav_id_1", 1, 150),
				(assign, "$ballista_shoot_snd_1", 0),
			(else_try),
				(eq, "$ballista_timer1", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, 45),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
			(else_try),
				(eq, "$ballista_timer1", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, -75),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
				(call_script, "script_molda_prop_visible_on_off", ":value_2", 1),
			(else_try),
				(eq, "$ballista_timer1", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, 30),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
				(assign, "$ballista_timer1", -1),
			(try_end)
		]),

		(2.0, 1.0, 1.0,
		[],

		[
			(try_begin),
				(eq, "$def_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannon_22"),
				(assign, ":value_2", "spr_666_cannonball_ready_22"),
				(assign, ":value_3", "spr_666_cannonball_shoot"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_6662_ballista_2"),
				(assign, ":value_2", "spr_6662_ballista_javelin_ready_2"),
				(assign, ":value_3", "spr_666_ballista_javelin"),
				(assign, ":value_4", "snd_ballista_shoot"),
			(try_end),
			(val_add, "$ballista_timer2", 1),
			(try_begin),
				(eq, "$ballista_timer2", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value_2", 0),
				(entry_point_get_position, 1, 76),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_3"),
				(assign, "$ballista_jav_id_2", reg0),
				(prop_instance_add_particle_system, "$ballista_jav_id_2", "psys_fireplace_fire_big", 33),
				(prop_instance_add_particle_system, "$ballista_jav_id_2", "psys_torch_smoke", 33),
				(store_mission_timer_c_msec, "$ballista_shoot_msec_2"),
				(store_random_in_range, ":random_in_range_0_2", 0, 2),
				(try_begin),
					(eq, ":random_in_range_0_2", 0),
					(entry_point_get_position, 1, 79),
					(try_begin),
						(store_random_in_range, ":random_in_range_0_251", 0, 251),
						(store_random_in_range, ":random_in_range_0_251_2", 0, 251),
						(val_sub, ":random_in_range_0_251", 125),
						(val_sub, ":random_in_range_0_251_2", 125),
						(position_move_x, 1, ":random_in_range_0_251"),
						(position_move_z, 1, ":random_in_range_0_251_2"),
					(try_end),
				(else_try),
					(entry_point_get_position, 1, 107),
					(try_begin),
						(store_random_in_range, ":random_in_range_0_251", 0, 251),
						(store_random_in_range, ":random_in_range_0_251_2", 0, 251),
						(val_sub, ":random_in_range_0_251", 125),
						(val_sub, ":random_in_range_0_251_2", 125),
						(position_move_x, 1, ":random_in_range_0_251"),
						(position_move_z, 1, ":random_in_range_0_251_2"),
					(try_end),
				(try_end),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$ballista_shoot_pos_2_x", reg3),
				(assign, "$ballista_shoot_pos_2_y", reg4),
				(assign, "$ballista_shoot_pos_2_z", reg5),
				(prop_instance_animate_to_position, "$ballista_jav_id_2", 1, 150),
				(assign, "$ballista_shoot_snd_2", 0),
			(else_try),
				(eq, "$ballista_timer2", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, 45),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
			(else_try),
				(eq, "$ballista_timer2", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, -75),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
				(call_script, "script_molda_prop_visible_on_off", ":value_2", 1),
			(else_try),
				(eq, "$ballista_timer2", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_0"),
				(position_rotate_z, 1, 30),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_0", 1, 90),
				(assign, "$ballista_timer2", -1),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(gt, "$ballista_shoot_msec_1", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$ballista_shoot_msec_1"),
				(try_begin),
					(ge, reg0, 2950),
					(prop_instance_stop_all_particle_systems, "$ballista_jav_id_1"),
					(assign, "$ballista_shoot_msec_1", 0),
				(else_try),
					(ge, reg0, 1450),
					(neq, "$ballista_shoot_snd_1", 1),
					(assign, "$ballista_shoot_snd_1", 1),
					(position_set_x, 1, "$ballista_shoot_pos_1_x"),
					(position_set_y, 1, "$ballista_shoot_pos_1_y"),
					(position_set_z, 1, "$ballista_shoot_pos_1_z"),
					(call_script, "script_molda_siege_ballista_dmg"),
					(scene_prop_set_visibility, "$ballista_jav_id_1", 0),
				(try_end),
			(try_end),
			(try_begin),
				(gt, "$ballista_shoot_msec_2", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$ballista_shoot_msec_2"),
				(try_begin),
					(ge, reg0, 2950),
					(prop_instance_stop_all_particle_systems, "$ballista_jav_id_2"),
					(assign, "$ballista_shoot_msec_2", 0),
				(else_try),
					(ge, reg0, 1450),
					(neq, "$ballista_shoot_snd_2", 1),
					(assign, "$ballista_shoot_snd_2", 1),
					(position_set_x, 1, "$ballista_shoot_pos_2_x"),
					(position_set_y, 1, "$ballista_shoot_pos_2_y"),
					(position_set_z, 1, "$ballista_shoot_pos_2_z"),
					(call_script, "script_molda_siege_ballista_dmg"),
					(scene_prop_set_visibility, "$ballista_jav_id_2", 0),
				(try_end),
			(try_end)
		]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_ladder_two", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle...",
	[(80, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(80, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(81, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(82, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(83, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(84, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(85, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(86, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(87, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(88, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(89, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(90, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 80),
				(assign, "$enemy_first_spawn_entry", 81),
			(else_try),
				(assign, "$player_first_spawn_entry", 81),
				(assign, "$enemy_first_spawn_entry", 80),
			(try_end),
			(assign, "$defence_sub_spawn_entry", 82),
			(assign, "$defender_siege_archer_spawn_entry_1", 84),
			(assign, "$defender_siege_archer_spawn_entry_2", 85),
			(assign, "$defender_siege_archer_spawn_entry_3", 86),
			(assign, "$defender_siege_archer_spawn_entry_4", 87),
			(assign, "$defender_siege_archer_spawn_entry_5", 88),
			(assign, "$defender_siege_archer_spawn_entry_6", 89),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1),
			(assign, "$siege_horse_kill_need", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 0.0, ti_once,
		[
			(set_show_messages, 0),
			(try_begin),
				(eq, "$molda_siege_type", 2),
				(entry_point_get_position, 10, 92),
			(else_try),
				(eq, "$molda_siege_type", 3),
				(entry_point_get_position, 10, 81),
			(else_try),
				(eq, "$molda_siege_type", 4),
				(entry_point_get_position, 10, 103),
			(else_try),
				(entry_point_get_position, 10, 124),
			(try_end),
			(try_for_range, ":number", 0, 9),
				(neq, ":number", 1),
				(team_give_order, "$defender_team", ":number", 0),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 0),
				(team_give_order, "$defender_team_2", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 7),
			(try_end),
			(team_give_order, "$defender_team", 1, 11),
			(team_set_order_position, "$defender_team", 9, 10),
			(team_give_order, "$defender_team_2", 1, 11),
			(team_set_order_position, "$defender_team_2", 9, 10),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(call_script, "script_molda_siege_kill_horse_for_advance")
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_open_gate", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle...",
	[(120, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(120, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(124, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(123, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 120),
				(assign, "$enemy_first_spawn_entry", 124),
			(else_try),
				(assign, "$player_first_spawn_entry", 124),
				(assign, "$enemy_first_spawn_entry", 120),
			(try_end),
			(assign, "$defender_siege_archer_spawn_entry_1", 40),
			(assign, "$defender_siege_archer_spawn_entry_2", 41),
			(assign, "$defender_siege_archer_spawn_entry_3", 42),
			(assign, "$defender_siege_archer_spawn_entry_4", 43),
			(assign, "$defender_siege_archer_spawn_entry_5", 44),
			(assign, "$defender_siege_archer_spawn_entry_6", 45),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1)
		]),

		(0.0, 1.0, ti_once,
		[],

		[
			(call_script, "script_molda_prop_physics_on_off", "spr_666_portculis_new", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_666_portculis_new", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_towngate_rectangle_door_left", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_towngate_rectangle_door_left", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_towngate_rectangle_door_right", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_towngate_rectangle_door_right", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_666_door_left", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_666_door_left", 0),
			(call_script, "script_molda_prop_physics_on_off", "spr_666_door_right", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_666_door_right", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_666_portculis_second", 0),
			(call_script, "script_molda_prop_visible_on_off", "spr_666_portculis_second", 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(call_script, "script_molda_siege_kill_horse_for_advance")
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_infil_river", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle...",
	[(102, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(102, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(103, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(104, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 102),
				(assign, "$enemy_first_spawn_entry", 103),
			(else_try),
				(assign, "$enemy_first_spawn_entry", 102),
				(assign, "$player_first_spawn_entry", 103),
			(try_end),
			(assign, "$defender_siege_archer_spawn_entry_1", 40),
			(assign, "$defender_siege_archer_spawn_entry_2", 41),
			(assign, "$defender_siege_archer_spawn_entry_3", 42),
			(assign, "$defender_siege_archer_spawn_entry_4", 43),
			(assign, "$defender_siege_archer_spawn_entry_5", 44),
			(assign, "$defender_siege_archer_spawn_entry_6", 45),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1),
			(assign, "$siege_horse_kill_need", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 4),
				(agent_is_human, ":trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(agent_is_human, ":trigger_param_1"),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(eq, ":team_trigger_param_1", ":team_player_agent_no"),
					(agent_equip_item, ":trigger_param_1", 655),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(neq, ":team_trigger_param_1", ":team_player_agent_no"),
					(agent_equip_item, ":trigger_param_1", 655),
				(try_end),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 0.0, ti_once,
		[
			(set_show_messages, 0),
			(try_begin),
				(eq, "$molda_siege_type", 2),
				(entry_point_get_position, 10, 92),
			(else_try),
				(eq, "$molda_siege_type", 3),
				(entry_point_get_position, 10, 81),
			(else_try),
				(eq, "$molda_siege_type", 4),
				(entry_point_get_position, 10, 103),
			(else_try),
				(entry_point_get_position, 10, 124),
			(try_end),
			(try_for_range, ":number", 0, 9),
				(neq, ":number", 1),
				(team_give_order, "$defender_team", ":number", 0),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 0),
				(team_give_order, "$defender_team_2", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 7),
			(try_end),
			(team_give_order, "$defender_team", 1, 11),
			(team_set_order_position, "$defender_team", 9, 10),
			(team_give_order, "$defender_team_2", 1, 11),
			(team_set_order_position, "$defender_team_2", 9, 10),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_uurt", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle...",
	[(120, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(120, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(124, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(123, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 120),
				(assign, "$enemy_first_spawn_entry", 124),
			(else_try),
				(assign, "$enemy_first_spawn_entry", 120),
				(assign, "$player_first_spawn_entry", 124),
			(try_end),
			(assign, "$defender_siege_archer_spawn_entry_1", 40),
			(assign, "$defender_siege_archer_spawn_entry_2", 41),
			(assign, "$defender_siege_archer_spawn_entry_3", 42),
			(assign, "$defender_siege_archer_spawn_entry_4", 43),
			(assign, "$defender_siege_archer_spawn_entry_5", 44),
			(assign, "$defender_siege_archer_spawn_entry_6", 45),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 0.0, ti_once,
		[
			(set_show_messages, 0),
			(try_for_range, ":number", 0, 9),
				(team_give_order, "$defender_team", ":number", 2),
				(team_give_order, "$defender_team", ":number", 2),
				(team_give_order, "$defender_team", ":number", 2),
				(team_give_order, "$defender_team_2", ":number", 2),
				(team_give_order, "$defender_team_2", ":number", 2),
				(team_give_order, "$defender_team_2", ":number", 2),
			(try_end),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[
			(store_current_scene, ":current_scene"),
			(this_or_next|eq, ":current_scene", "scn_molda_siege_mission_urt"),
			(eq, ":current_scene", "scn_8_vill_urt")
		],

		[
			(set_show_messages, 0),
			(entry_point_get_position, 1, 32),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 33),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 34),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 35),
			(set_spawn_position, 1),
			(spawn_horse, 154, 0),
			(entry_point_get_position, 1, 36),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 37),
			(set_spawn_position, 1),
			(spawn_horse, 154, 0),
			(entry_point_get_position, 1, 38),
			(set_spawn_position, 1),
			(spawn_horse, 155, 0),
			(entry_point_get_position, 1, 39),
			(set_spawn_position, 1),
			(spawn_horse, 156, 0),
			(entry_point_get_position, 1, 51),
			(set_spawn_position, 1),
			(spawn_horse, 157, 0),
			(entry_point_get_position, 1, 52),
			(set_spawn_position, 1),
			(spawn_horse, 156, 0),
			(entry_point_get_position, 1, 53),
			(set_spawn_position, 1),
			(spawn_horse, 157, 0),
			(entry_point_get_position, 1, 54),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 55),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 56),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 57),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 58),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 59),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 60),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 61),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 62),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 63),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 64),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 65),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 66),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 67),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 68),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 69),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 70),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 71),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 72),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 73),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 74),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 75),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 76),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 77),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 78),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 79),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 80),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(set_show_messages, 1)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_teepee", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle...",
	[(120, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(120, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(124, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(123, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1|mtef_archers_first, 0, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 120),
				(assign, "$enemy_first_spawn_entry", 124),
			(else_try),
				(assign, "$enemy_first_spawn_entry", 120),
				(assign, "$player_first_spawn_entry", 124),
			(try_end),
			(assign, "$defender_siege_archer_spawn_entry_1", 40),
			(assign, "$defender_siege_archer_spawn_entry_2", 41),
			(assign, "$defender_siege_archer_spawn_entry_3", 42),
			(assign, "$defender_siege_archer_spawn_entry_4", 43),
			(assign, "$defender_siege_archer_spawn_entry_5", 44),
			(assign, "$defender_siege_archer_spawn_entry_6", 45),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 0.0, ti_once,
		[
			(set_show_messages, 0),
			(try_for_range, ":number", 0, 9),
				(team_give_order, "$defender_team", ":number", 2),
				(team_give_order, "$defender_team", ":number", 2),
				(team_give_order, "$defender_team", ":number", 2),
				(team_give_order, "$defender_team_2", ":number", 2),
				(team_give_order, "$defender_team_2", ":number", 2),
				(team_give_order, "$defender_team_2", ":number", 2),
			(try_end),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_jap", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle...",
	[(120, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(120, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(124, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(123, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 120),
				(assign, "$enemy_first_spawn_entry", 124),
			(else_try),
				(assign, "$enemy_first_spawn_entry", 120),
				(assign, "$player_first_spawn_entry", 124),
			(try_end),
			(assign, "$defender_siege_archer_spawn_entry_1", 40),
			(assign, "$defender_siege_archer_spawn_entry_2", 41),
			(assign, "$defender_siege_archer_spawn_entry_3", 42),
			(assign, "$defender_siege_archer_spawn_entry_4", 43),
			(assign, "$defender_siege_archer_spawn_entry_5", 44),
			(assign, "$defender_siege_archer_spawn_entry_6", 45),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1),
			(assign, "$siege_horse_kill_need", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 0.0, ti_once,
		[
			(set_show_messages, 0),
			(try_begin),
				(eq, "$molda_siege_type", 2),
				(entry_point_get_position, 10, 92),
			(else_try),
				(eq, "$molda_siege_type", 3),
				(entry_point_get_position, 10, 81),
			(else_try),
				(eq, "$molda_siege_type", 4),
				(entry_point_get_position, 10, 103),
			(else_try),
				(entry_point_get_position, 10, 124),
			(try_end),
			(try_for_range, ":number", 0, 9),
				(neq, ":number", 1),
				(team_give_order, "$defender_team", ":number", 0),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 0),
				(team_give_order, "$defender_team_2", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 7),
			(try_end),
			(team_give_order, "$defender_team", 1, 11),
			(team_set_order_position, "$defender_team", 9, 10),
			(team_give_order, "$defender_team_2", 1, 11),
			(team_set_order_position, "$defender_team_2", 9, 10),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_inner_fight_coup_1", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle...",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(123, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1|mtef_archers_first, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$player_is_attack", 1),
				(assign, "$player_first_spawn_entry", 0),
				(assign, "$enemy_first_spawn_entry", 105),
			(else_try),
				(assign, "$enemy_first_spawn_entry", 105),
				(assign, "$player_first_spawn_entry", 0),
			(try_end),
			(assign, "$defender_siege_archer_spawn_entry_1", 40),
			(assign, "$defender_siege_archer_spawn_entry_2", 41),
			(assign, "$defender_siege_archer_spawn_entry_3", 42),
			(assign, "$defender_siege_archer_spawn_entry_4", 43),
			(assign, "$defender_siege_archer_spawn_entry_5", 44),
			(assign, "$defender_siege_archer_spawn_entry_6", 45),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1),
			(assign, "$siege_horse_kill_need", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 2.0, ti_once,
		[],

		[]),

		(2.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_siege_move_archers_to_archer_positions")
		]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(call_script, "script_molda_siege_kill_horse_for_advance")
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("castle_attack_walls_molda_catapult", mtf_battle_mode|mtf_synch_inventory, -1,
	"You attack the walls of the castle with your battering ram...",
	[(120, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(120, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(124, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(123, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(105, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(126, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(47, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(50, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(73, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(74, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(assign, "$player_first_spawn_entry", 120),
				(assign, "$enemy_first_spawn_entry", 124),
			(else_try),
				(assign, "$player_first_spawn_entry", 124),
				(assign, "$enemy_first_spawn_entry", 120),
			(try_end),
			(assign, "$defender_siege_archer_spawn_entry_1", 40),
			(assign, "$defender_siege_archer_spawn_entry_2", 41),
			(assign, "$defender_siege_archer_spawn_entry_3", 42),
			(assign, "$defender_siege_archer_spawn_entry_4", 43),
			(assign, "$defender_siege_archer_spawn_entry_5", 44),
			(assign, "$defender_siege_archer_spawn_entry_6", 45),
			(assign, "$attacker_siege_ram_spawn_entry_1", 50),
			(assign, "$attacker_siege_ram_spawn_entry_2", 73),
			(assign, "$attacker_siege_ram_spawn_entry_3", 74),
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(val_div, ":var_2", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(store_div, ":value_3", "$player_spawn_num", 4),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$player_first_spawn_entry"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_1"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_2"),
					(call_script, "script_troop_spawn_basic", ":value", ":value_3", 0, "$attacker_siege_ram_spawn_entry_3"),
				(else_try),
					(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
				(try_end),
				(assign, ":value_4", "$enemy_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
			(else_try),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
				(assign, ":value_4", "$player_first_spawn_entry"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 2),
					(eq, "$molda_siege_type", 3),
					(assign, ":value_4", "$defence_sub_spawn_entry"),
				(try_end),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_6", "$temp_party_troop_01", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_02", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_1", "$temp_party_troop_03", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_04", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_2", "$temp_party_troop_05", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_3", "$temp_party_troop_06", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$player_first_spawn_entry", "$temp_party_troop_07", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", ":value_4", "$temp_party_troop_08", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_4", "$temp_party_troop_09", ":value", 1, ":var_1"),
				(call_script, "script_battle_tile_spawn_try_for", "$defender_siege_archer_spawn_entry_5", "$temp_party_troop_10", ":value", 1, ":var_1"),
				(try_begin),
					(this_or_next|eq, "$molda_siege_type", 6),
					(eq, "$molda_siege_type", 1),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_1", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_2", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$attacker_siege_ram_spawn_entry_3", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(else_try),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_01", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_02", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_04", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_05", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_06", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_07", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_08", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_09", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", "$enemy_first_spawn_entry", "$temp_party_troop_10", ":value_2", -1, ":var_2"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$defender_siege_archer_spawn_entry_1", 40),
				(eq, "$defender_siege_archer_spawn_entry_2", 41),
				(eq, "$defender_siege_archer_spawn_entry_3", 42),
				(eq, "$defender_siege_archer_spawn_entry_4", 43),
				(eq, "$defender_siege_archer_spawn_entry_5", 44),
				(eq, "$defender_siege_archer_spawn_entry_6", 45),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 46, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 47, "$temp_party_troop_fire", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$molda_siege_type", 6),
				(try_begin),
					(eq, "$is_siege_defence", 0),
					(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value_2", -1, ":var_2"),
				(else_try),
					(eq, "$is_siege_defence", 1),
					(call_script, "script_wm_troop_type_depend_train", "p_main_party", 2),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_fire", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 41, "$temp_party_troop_03", ":value", 1, ":var_1"),
					(call_script, "script_battle_tile_spawn_try_for", 42, "$temp_party_troop_03", ":value", 1, ":var_1"),
				(try_end),
			(try_end),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(0.0, 0.0, ti_once,
		[
			(set_show_messages, 0),
			(try_begin),
				(eq, "$molda_siege_type", 2),
				(entry_point_get_position, 10, 92),
			(else_try),
				(eq, "$molda_siege_type", 3),
				(entry_point_get_position, 10, 81),
			(else_try),
				(eq, "$molda_siege_type", 4),
				(entry_point_get_position, 10, 103),
			(else_try),
				(entry_point_get_position, 10, 124),
			(try_end),
			(try_for_range, ":number", 0, 9),
				(neq, ":number", 1),
				(team_give_order, "$defender_team", ":number", 0),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 0),
				(team_give_order, "$defender_team_2", ":number", 7),
				(team_give_order, "$defender_team_2", ":number", 7),
			(try_end),
			(team_give_order, "$defender_team", 1, 11),
			(team_set_order_position, "$defender_team", 9, 10),
			(team_give_order, "$defender_team_2", 1, 11),
			(team_set_order_position, "$defender_team_2", 9, 10),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 1.0, ti_once,
		[
			(set_show_messages, 0),
			(team_give_order, "$attacker_team", 9, 8),
			(set_show_messages, 1),
			(call_script, "script_molda_prop_visible_on_off", "spr_666_destroy_heap_no_bo", 0)
		],

		[]),

		(0.0, 3.0, 8.0,
		[],

		[
			(call_script, "script_battle_tile_agent_division_reset"),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$attacker_team"),
				(eq, ":team_var_1", "$attacker_team_2"),
				(try_begin),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_1"),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(30.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(this_or_next|eq, ":team_var_1", "$defender_team"),
				(eq, ":team_var_1", "$defender_team_2"),
				(agent_refill_ammo, ":var_1"),
			(try_end)
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(0.0, 0.0, 1.0,
		[],

		[
			(assign, ":value", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_value_number", ":value", ":number"),
				(try_begin),
					(neq, ":movement_order_value_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":value", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(assign, ":value", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_value_number", ":value", ":number"),
				(try_begin),
					(neq, ":movement_order_value_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":value", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$town_gate_destroyed", 1),
				(assign, ":value", "$defender_team"),
				(try_for_range, ":number", 0, 6),
					(team_get_movement_order, ":movement_order_value_number", ":value", ":number"),
					(try_begin),
						(neq, ":movement_order_value_number", 2),
						(set_show_messages, 0),
						(team_give_order, ":value", ":number", 2),
						(set_show_messages, 1),
					(try_end),
				(try_end),
				(assign, ":value", "$defender_team_2"),
				(try_for_range, ":number", 0, 6),
					(team_get_movement_order, ":movement_order_value_number", ":value", ":number"),
					(try_begin),
						(neq, ":movement_order_value_number", 2),
						(set_show_messages, 0),
						(team_give_order, ":value", ":number", 2),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end),
			(call_script, "script_molda_siege_kill_horse_for_advance")
		]),

		(1.0, 0.0, 0.0,
		[
			(eq, "$town_gate_destroyed", 0),
			(ge, "$catapult_attack_time", "$catapult_attack_max")
		],

		[
			(play_sound, "snd_siege_weapon_hit_2d"),
			(store_current_scene, ":current_scene"),
			(try_begin),
				(this_or_next|eq, ":current_scene", "scn_battle_tile_siege_highland_d"),
				(this_or_next|eq, ":current_scene", "scn_battle_tile_siege_highland_s"),
				(eq, ":current_scene", "scn_battle_tile_siege_highland"),
				(entry_point_get_position, 7, 72),
				(call_script, "script_molda_prop_animate_to_pos", "spr_6663_castle_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_77712_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_77713_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_7772_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_77722_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_7773_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_7774_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_77742_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_7775_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_77752_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_7776_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_77762_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_77763_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_animate_to_pos", "spr_7777_wall_on_off", 7, 300),
				(call_script, "script_molda_prop_visible_on_off", "spr_666_destroy_heap_no_bo", 1),
				(play_sound, "snd_fallrocks"),
				(entry_point_get_position, 7, 60),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(entry_point_get_position, 7, 61),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(entry_point_get_position, 7, 62),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(entry_point_get_position, 7, 63),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(entry_point_get_position, 7, 64),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(entry_point_get_position, 7, 65),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(entry_point_get_position, 7, 67),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(entry_point_get_position, 7, 68),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(entry_point_get_position, 7, 69),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_rock_dynamic_physics"),
				(display_message, "str_wall_des", 0x0000ffff),
			(else_try),
				(entry_point_get_position, 7, 60),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_666_portculis_part_1"),
				(set_spawn_position, 7),
				(spawn_scene_prop, "spr_666_portculis_part_2"),
				(call_script, "script_molda_prop_physics_on_off", "spr_666_portculis_new", 0),
				(call_script, "script_molda_prop_visible_on_off", "spr_666_portculis_new", 0),
				(call_script, "script_molda_prop_physics_on_off", "spr_towngate_rectangle_door_left", 0),
				(call_script, "script_molda_prop_visible_on_off", "spr_towngate_rectangle_door_left", 0),
				(call_script, "script_molda_prop_physics_on_off", "spr_towngate_rectangle_door_right", 0),
				(call_script, "script_molda_prop_visible_on_off", "spr_towngate_rectangle_door_right", 0),
				(display_message, "str_gate_des", 0x0000ffff),
			(try_end),
			(assign, "$town_gate_destroyed", 1),
			(assign, "$catapult_end", 1),
			(try_begin),
				(get_player_agent_no, ":player_agent_no"),
				(agent_is_alive, ":player_agent_no"),
				(agent_set_hit_points, ":player_agent_no", 100),
			(try_end),
			(store_mission_timer_c_msec, "$catapult_shoot_msec_5")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$catapult_attack_time", 0),
			(assign, "$catapult_timer1", -1),
			(assign, "$catapult_timer2", -7),
			(assign, "$catapult_timer3", -4),
			(assign, "$catapult_timer4", -10),
			(assign, "$catapult_shoot_msec_1", 0),
			(assign, "$catapult_shoot_msec_2", 0),
			(assign, "$catapult_shoot_msec_3", 0),
			(assign, "$catapult_shoot_msec_4", 0),
			(assign, "$catapult_shoot_msec_5", 0),
			(assign, "$catapult_end", 0)
		]),

		(-20.0, 2.0, ti_once,
		[],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_1"),
				(assign, ":value_2", "spr_666_cannonb_ready_2"),
				(assign, ":value_3", "spr_666_cannonb_ready_3"),
				(assign, ":value_4", "spr_666_cannonb_ready_4"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_1"),
				(assign, ":value_2", "spr_666Catapult_stone_ready_2"),
				(assign, ":value_3", "spr_666Catapult_stone_ready_3"),
				(assign, ":value_4", "spr_666Catapult_stone_ready_4"),
			(try_end),
			(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value", 0),
			(init_position, 33),
			(prop_instance_add_particle_system, ":scene_prop_instance_value_0", "psys_war_smoke_tall", 33),
			(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value_2", 0),
			(init_position, 33),
			(prop_instance_add_particle_system, ":scene_prop_instance_value_0", "psys_war_smoke_tall", 33),
			(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value_3", 0),
			(init_position, 33),
			(prop_instance_add_particle_system, ":scene_prop_instance_value_0", "psys_war_smoke_tall", 33),
			(scene_prop_get_instance, ":scene_prop_instance_value_0", ":value_4", 0),
			(init_position, 33),
			(prop_instance_add_particle_system, ":scene_prop_instance_value_0", "psys_war_smoke_tall", 33)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_1"),
				(assign, ":value_2", "spr_666_cannonball_1"),
				(assign, ":value_3", "spr_666_fake_stone_for_cannon_1"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_1"),
				(assign, ":value_2", "spr_666Catapult_stone_1"),
				(assign, ":value_3", "spr_666Catapult_pul_1"),
				(assign, ":value_4", "snd_catapult_in_battle"),
			(try_end),
			(val_add, "$catapult_timer1", 1),
			(try_begin),
				(eq, "$catapult_timer1", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, 85),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value", 0),
				(init_position, 33),
				(entry_point_get_position, 1, 56),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_2"),
				(assign, "$catapult_stone_id_1", reg0),
				(store_mission_timer_c_msec, "$catapult_shoot_msec_1"),
				(store_random_in_range, "$catapult_entry_1", 60, 71),
				(entry_point_get_position, 1, "$catapult_entry_1"),
				(prop_instance_add_particle_system, "$catapult_stone_id_1", "psys_village_fire_smoke_big", 33),
				(prop_instance_animate_to_position, "$catapult_stone_id_1", 1, 250),
				(assign, "$catapult_shoot_snd_1", 0),
			(else_try),
				(eq, "$catapult_timer1", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer1", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer1", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer1", 5),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer1", 6),
			(else_try),
				(eq, "$catapult_timer1", 7),
				(assign, "$catapult_timer1", -1),
				(call_script, "script_molda_prop_visible_on_off", ":value", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value", 0),
				(init_position, 33),
				(prop_instance_add_particle_system, ":scene_prop_instance_value_3_0", "psys_war_smoke_tall", 33),
			(try_end)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_2"),
				(assign, ":value_2", "spr_666_cannonball_2"),
				(assign, ":value_3", "spr_666_fake_stone_for_cannon_2"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_2"),
				(assign, ":value_2", "spr_666Catapult_stone_2"),
				(assign, ":value_3", "spr_666Catapult_pul_2"),
				(assign, ":value_4", "snd_catapult_in_battle"),
			(try_end),
			(val_add, "$catapult_timer2", 1),
			(try_begin),
				(eq, "$catapult_timer2", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, 85),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value", 0),
				(init_position, 33),
				(entry_point_get_position, 1, 57),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_2"),
				(assign, "$catapult_stone_id_2", reg0),
				(store_mission_timer_c_msec, "$catapult_shoot_msec_2"),
				(store_random_in_range, "$catapult_entry_2", 60, 71),
				(entry_point_get_position, 1, "$catapult_entry_2"),
				(prop_instance_add_particle_system, "$catapult_stone_id_2", "psys_village_fire_smoke_big", 33),
				(prop_instance_animate_to_position, "$catapult_stone_id_2", 1, 250),
				(assign, "$catapult_shoot_snd_2", 0),
			(else_try),
				(eq, "$catapult_timer2", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer2", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer2", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer2", 5),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer2", 6),
			(else_try),
				(eq, "$catapult_timer2", 7),
				(assign, "$catapult_timer2", -1),
				(call_script, "script_molda_prop_visible_on_off", ":value", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value", 0),
				(init_position, 33),
				(prop_instance_add_particle_system, ":scene_prop_instance_value_3_0", "psys_war_smoke_tall", 33),
			(try_end)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_3"),
				(assign, ":value_2", "spr_666_cannonball_3"),
				(assign, ":value_3", "spr_666_fake_stone_for_cannon_3"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_3"),
				(assign, ":value_2", "spr_666Catapult_stone_3"),
				(assign, ":value_3", "spr_666Catapult_pul_3"),
				(assign, ":value_4", "snd_catapult_in_battle"),
			(try_end),
			(val_add, "$catapult_timer3", 1),
			(try_begin),
				(eq, "$catapult_timer3", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, 85),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value", 0),
				(init_position, 33),
				(entry_point_get_position, 1, 57),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_2"),
				(assign, "$catapult_stone_id_3", reg0),
				(store_mission_timer_c_msec, "$catapult_shoot_msec_3"),
				(store_random_in_range, "$catapult_entry_3", 60, 71),
				(entry_point_get_position, 1, "$catapult_entry_3"),
				(prop_instance_add_particle_system, "$catapult_stone_id_3", "psys_village_fire_smoke_big", 33),
				(prop_instance_animate_to_position, "$catapult_stone_id_3", 1, 250),
				(assign, "$catapult_shoot_snd_3", 0),
			(else_try),
				(eq, "$catapult_timer3", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer3", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer3", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer3", 5),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer3", 6),
			(else_try),
				(eq, "$catapult_timer3", 7),
				(assign, "$catapult_timer3", -1),
				(call_script, "script_molda_prop_visible_on_off", ":value", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value", 0),
				(init_position, 33),
				(prop_instance_add_particle_system, ":scene_prop_instance_value_3_0", "psys_war_smoke_tall", 33),
			(try_end)
		]),

		(2.0, 1.0, 1.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonb_ready_4"),
				(assign, ":value_2", "spr_666_cannonball_4"),
				(assign, ":value_3", "spr_666_fake_stone_for_cannon_4"),
				(assign, ":value_4", "snd_cannon_shot"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_ready_4"),
				(assign, ":value_2", "spr_666Catapult_stone_4"),
				(assign, ":value_3", "spr_666Catapult_pul_4"),
				(assign, ":value_4", "snd_catapult_in_battle"),
			(try_end),
			(val_add, "$catapult_timer4", 1),
			(try_begin),
				(eq, "$catapult_timer4", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, 85),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
				(play_sound, ":value_4"),
				(call_script, "script_molda_prop_visible_on_off", ":value", 0),
				(init_position, 33),
				(entry_point_get_position, 1, 57),
				(set_spawn_position, 1),
				(spawn_scene_prop, ":value_2"),
				(assign, "$catapult_stone_id_4", reg0),
				(store_mission_timer_c_msec, "$catapult_shoot_msec_4"),
				(store_random_in_range, "$catapult_entry_4", 60, 71),
				(entry_point_get_position, 1, "$catapult_entry_1"),
				(prop_instance_add_particle_system, "$catapult_stone_id_4", "psys_village_fire_smoke_big", 33),
				(prop_instance_animate_to_position, "$catapult_stone_id_4", 1, 250),
				(assign, "$catapult_shoot_snd_4", 0),
			(else_try),
				(eq, "$catapult_timer4", 2),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer4", 3),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer4", 4),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -25),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer4", 5),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value_3", 0),
				(prop_instance_get_position, 1, ":scene_prop_instance_value_3_0"),
				(position_rotate_y, 1, -10),
				(prop_instance_animate_to_position, ":scene_prop_instance_value_3_0", 1, 90),
			(else_try),
				(eq, "$catapult_timer4", 6),
			(else_try),
				(eq, "$catapult_timer4", 7),
				(assign, "$catapult_timer4", -1),
				(call_script, "script_molda_prop_visible_on_off", ":value", 1),
				(scene_prop_get_instance, ":scene_prop_instance_value_3_0", ":value", 0),
				(init_position, 33),
				(prop_instance_add_particle_system, ":scene_prop_instance_value_3_0", "psys_war_smoke_tall", 33),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$catapult_end", 0)
		],

		[
			(try_begin),
				(eq, "$att_cannon_use_yes", 1),
				(assign, ":value", "spr_666_cannonball_1"),
				(assign, ":value_2", "spr_666_cannonball_2"),
				(assign, ":value_3", "spr_666_cannonball_3"),
				(assign, ":value_4", "spr_666_cannonball_4"),
			(else_try),
				(assign, ":value", "spr_666Catapult_stone_1"),
				(assign, ":value_2", "spr_666Catapult_stone_2"),
				(assign, ":value_3", "spr_666Catapult_stone_3"),
				(assign, ":value_4", "spr_666Catapult_stone_4"),
			(try_end),
			(try_begin),
				(gt, "$catapult_shoot_msec_1", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_1"),
				(try_begin),
					(ge, reg0, 18950),
					(call_script, "script_molda_prop_physics_on_off", ":value", 0),
					(call_script, "script_molda_prop_visible_on_off", ":value", 0),
					(assign, "$catapult_shoot_msec_1", 0),
				(else_try),
					(ge, reg0, 2450),
					(neq, "$catapult_shoot_snd_1", 1),
					(prop_instance_stop_all_particle_systems, "$catapult_stone_id_1"),
					(assign, "$catapult_shoot_snd_1", 1),
					(call_script, "script_molda_siege_catapult_dmg", "$catapult_entry_1"),
					(val_add, "$catapult_attack_time", 1),
					(assign, reg8, "$catapult_attack_time"),
					(assign, reg9, "$catapult_attack_max"),
					(display_message, "str_catapult_shot_num"),
				(try_end),
			(try_end),
			(try_begin),
				(gt, "$catapult_shoot_msec_2", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_2"),
				(try_begin),
					(ge, reg0, 18950),
					(call_script, "script_molda_prop_physics_on_off", ":value_2", 0),
					(call_script, "script_molda_prop_visible_on_off", ":value_2", 0),
					(assign, "$catapult_shoot_msec_2", 0),
				(else_try),
					(ge, reg0, 2450),
					(neq, "$catapult_shoot_snd_2", 1),
					(prop_instance_stop_all_particle_systems, "$catapult_stone_id_2"),
					(assign, "$catapult_shoot_snd_2", 1),
					(call_script, "script_molda_siege_catapult_dmg", "$catapult_entry_2"),
					(val_add, "$catapult_attack_time", 1),
					(assign, reg8, "$catapult_attack_time"),
					(assign, reg9, "$catapult_attack_max"),
					(display_message, "str_catapult_shot_num"),
				(try_end),
			(try_end),
			(try_begin),
				(gt, "$catapult_shoot_msec_3", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_3"),
				(try_begin),
					(ge, reg0, 18950),
					(call_script, "script_molda_prop_physics_on_off", ":value_3", 0),
					(call_script, "script_molda_prop_visible_on_off", ":value_3", 0),
					(assign, "$catapult_shoot_msec_3", 0),
				(else_try),
					(ge, reg0, 2450),
					(neq, "$catapult_shoot_snd_3", 1),
					(prop_instance_stop_all_particle_systems, "$catapult_stone_id_3"),
					(assign, "$catapult_shoot_snd_3", 1),
					(call_script, "script_molda_siege_catapult_dmg", "$catapult_entry_3"),
					(val_add, "$catapult_attack_time", 1),
					(assign, reg8, "$catapult_attack_time"),
					(assign, reg9, "$catapult_attack_max"),
					(display_message, "str_catapult_shot_num"),
				(try_end),
			(try_end),
			(try_begin),
				(gt, "$catapult_shoot_msec_4", 0),
				(store_mission_timer_c_msec, reg0),
				(val_sub, reg0, "$catapult_shoot_msec_4"),
				(try_begin),
					(ge, reg0, 18950),
					(call_script, "script_molda_prop_physics_on_off", ":value_4", 0),
					(call_script, "script_molda_prop_visible_on_off", ":value_4", 0),
					(assign, "$catapult_shoot_msec_4", 0),
				(else_try),
					(ge, reg0, 2450),
					(neq, "$catapult_shoot_snd_4", 1),
					(prop_instance_stop_all_particle_systems, "$catapult_stone_id_4"),
					(assign, "$catapult_shoot_snd_4", 1),
					(call_script, "script_molda_siege_catapult_dmg", "$catapult_entry_4"),
					(val_add, "$catapult_attack_time", 1),
					(assign, reg8, "$catapult_attack_time"),
					(assign, reg9, "$catapult_attack_max"),
					(display_message, "str_catapult_shot_num"),
				(try_end),
			(try_end)
		]),

		(3.0, 1.0, 0.0,
		[],

		[
			(assign, ":var_1", "$attacker_team"),
			(try_for_range, ":number", 0, 6),
				(team_get_movement_order, ":movement_order_var_1_number", ":var_1", ":number"),
				(try_begin),
					(neq, ":movement_order_var_1_number", 2),
					(set_show_messages, 0),
					(team_give_order, ":var_1", ":number", 2),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[
			(assign, "$attacker_team", 0),
			(assign, "$defender_team", 1),
			(assign, "$attacker_team_2", 2),
			(assign, "$defender_team_2", 3)
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2"),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_player_team_dead_num", 20),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_player_team_respawn", 3),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 4),
				(val_add, "$g_player_team_respawn", 1),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_enemy_team_dead_num", 20),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(lt, "$g_enemy_team_respawn", 3),
				(call_script, "script_team_spawn_again", 3),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 0),
				(gt, "$g_player_team_dead_num", 20),
				(lt, "$g_player_team_respawn", 2),
				(le, "$minimap_ally_team_num", "$alive_num_global_for_respawn"),
				(party_get_num_companion_stacks, ":num_companion_stacks_main_party", "p_main_party"),
				(assign, ":value", 0),
				(try_for_range, ":localvariable", 0, ":num_companion_stacks_main_party"),
					(party_stack_get_troop_id, ":party_stack_troop_id_main_party_localvariable", "p_main_party", ":localvariable"),
					(gt, ":party_stack_troop_id_main_party_localvariable", "trp_army_size_troop"),
					(neg|troop_is_hero, ":party_stack_troop_id_main_party_localvariable"),
					(party_stack_get_size, ":party_stack_size_main_party_localvariable", "p_main_party", ":localvariable"),
					(try_begin),
						(gt, ":party_stack_size_main_party_localvariable", 0),
						(val_add, ":value", ":party_stack_size_main_party_localvariable"),
					(try_end),
				(try_end),
				(gt, ":value", 0),
				(call_script, "script_team_spawn_again", 2),
				(display_message, "str_ally_reinf", 0x0000ff00),
				(assign, "$need_herald_fix", 1),
				(val_add, "$g_player_team_respawn", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end),
			(try_begin),
				(eq, "$is_siege_defence", 1),
				(gt, "$g_enemy_team_dead_num", 20),
				(lt, "$g_enemy_team_respawn", 2),
				(le, "$minimap_enemy_team_num", "$alive_num_global_for_respawn"),
				(call_script, "script_team_spawn_again", 5),
				(val_add, "$g_enemy_team_respawn", 1),
				(display_message, "str_enemy_reinf", 0x00ffff00),
				(assign, "$need_herald_fix", 1),
				(call_script, "script_alive_count_global_sett", 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		]),

		(20.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(scene_prop_get_instance, ":scene_prop_instance_5_freamed_1_0", "spr_5_freamed_1", 0),
				(prop_instance_get_position, 11, ":scene_prop_instance_5_freamed_1_0"),
				(position_get_z, ":position_z_11", 11),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(set_show_messages, 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_get_position, 12, ":var_5"),
					(position_get_z, ":position_z_12", 12),
					(try_begin),
						(le, ":position_z_12", ":position_z_11"),
						(agent_get_team, ":team_var_5", ":var_5"),
						(try_begin),
							(eq, ":team_var_5", ":team_player_agent_no"),
							(assign, ":value", "$player_first_spawn_entry"),
						(else_try),
							(assign, ":value", "$enemy_first_spawn_entry"),
						(try_end),
						(entry_point_get_position, 13, ":value"),
						(agent_set_position, ":var_5", 13),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("camp_mission", 0, -1,
	"camp mission",
	[(0, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(1, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(2, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(3, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(4, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(5, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(6, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(7, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(8, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(9, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(10, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(11, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(12, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(13, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(14, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(15, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(16, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(17, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(18, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(19, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(20, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(21, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(22, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(23, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(24, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(25, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(26, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(27, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(28, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(29, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(30, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(31, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(32, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(33, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(34, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(35, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(36, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(37, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(38, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(39, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(40, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(41, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(42, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(43, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(44, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(45, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(46, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(47, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(48, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(49, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(50, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(51, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(52, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(53, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(54, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(55, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(56, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(57, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(58, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(59, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(60, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(61, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(62, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(63, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(64, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(65, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(66, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(67, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(68, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(69, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(70, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(71, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(72, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(73, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(74, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(75, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(76, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(77, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(78, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(79, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(80, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(81, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(82, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(83, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(84, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(85, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(86, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(87, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(88, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(89, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, [])],
	[
		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$sex_cam_on", 1),
			(eq, "$deathcam_on", 0)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_watching_mode", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(key_clicked, 1)
		],

		[
			(display_message, "str_escape_alarm", 0x00ffff00)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 4, -1)
		]),

		(-22.0, 0.0, 0.0,
		[
			(set_trigger_result, 1)
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$wm_talk_state", 13)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":var_1", ":number"),
				(try_end),
				(set_show_messages, 1),
				(eq, "$adult_content", 1),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_walker_m"),
					(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_walker_f"),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 2, ":var_1"),
				(try_end),
				(call_script, "script_wm_main_party_has_troop_sc", ":troop_id_var_1"),
				(try_begin),
					(this_or_next|eq, "$wm_comp_continue", 1),
					(eq, ":troop_id_var_1", "trp_player"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(gt, "$troop_gender_type", 10),
						(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 0, ":var_1"),
					(else_try),
						(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
					(try_end),
				(try_end),
			(try_end)
		]),

		(1.0, 0.0, 0.0,
		[
			(eq, "$rand_event_type", 10),
			(eq, "$wm_talk_state", 13)
		],

		[
			(get_player_agent_no, ":player_agent_no"),
			(agent_is_alive, ":player_agent_no"),
			(agent_is_human, ":player_agent_no"),
			(agent_set_animation, ":player_agent_no", "anim_male_masterb")
		]),

		(0.0, 10.0, ti_once,
		[
			(eq, "$rand_event_type", 10),
			(eq, "$wm_talk_state", 13)
		],

		[
			(assign, "$rand_event_type", 0),
			(play_sound, "snd_fallrocks"),
			(entry_point_get_position, 7, 8),
			(call_script, "script_molda_prop_animate_to_pos", "spr_arena_barrier_c", 7, 300),
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_player"),
					(agent_set_team, ":var_1", 0),
				(try_end),
				(try_begin),
					(neq, ":troop_id_var_1", "trp_player"),
					(str_store_troop_name, 8, ":troop_id_var_1"),
					(display_message, "str_rand_event_woman_t", 0x00ff2222),
					(agent_set_team, ":var_1", 4),
					(agent_set_is_alarmed, ":var_1", 1),
					(agent_ai_set_aggressiveness, ":var_1", 199),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$wm_talk_state", 1)
		],

		[
			(store_current_scene, ":current_scene"),
			(call_script, "script_wm_main_party_has_troop_sc", "$g_sex_officer"),
			(store_party_size_wo_prisoners, ":party_size_wo_prisoners_main_party", "p_main_party"),
			(try_begin),
				(ge, ":party_size_wo_prisoners_main_party", 50),
				(eq, "$adult_content", 1),
				(eq, "$wm_comp_continue", 1),
				(neq, ":current_scene", "scn_conv_camp_sea"),
				(call_script, "script_wm_troop_type_depend_train", "p_main_party", 0),
				(try_for_agents, ":var_3"),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(try_begin),
						(eq, ":troop_id_var_3", "$temp_party_troop_09"),
						(call_script, "script_molda_body_hand_for_man", "$temp_party_troop_09", ":var_3"),
						(agent_set_stand_animation, ":var_3", "anim_male_fucked"),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "$g_sex_officer"),
						(call_script, "script_molda_body_hand_set", "$g_sex_officer", 0, ":var_3"),
						(agent_set_stand_animation, ":var_3", "anim_female_fucker_1"),
					(try_end),
				(try_end),
			(try_end)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return")
		])
	]),

	("sex_mission", 0, -1,
	"sex mission",
	[(0, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(1, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(2, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(3, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(4, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(5, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(6, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(7, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(8, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(9, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(10, mtef_scene_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(11, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(12, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(13, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(14, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(15, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(16, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(17, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(18, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(19, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(20, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(21, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(22, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(23, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(24, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(25, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(26, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(27, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(28, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(29, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(30, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(31, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(32, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(33, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(34, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(35, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(36, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(37, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(38, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(39, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(40, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(41, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(42, mtef_visitor_source, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, [])],
	[
		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$sex_cam_on", 1),
			(eq, "$deathcam_on", 0)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_watching_mode", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(key_clicked, 1)
		],

		[
			(display_message, "str_escape_alarm", 0x00ffff00)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk)
		]),

		(-22.0, 0.0, 0.0,
		[
			(set_trigger_result, 1)
		],

		[]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(play_track, "track_love_scene", 2)
		])
	]),

	("coup_last_battle", mtf_battle_mode|mtf_synch_inventory, 8,
	"You lead your men to battle.",
	[(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(4, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(4, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 0)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 10),
			(set_show_messages, 1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_begin),
				(eq, ":team_player_agent_no", 0),
				(assign, ":value", 0),
				(assign, ":value_2", 1),
			(else_try),
				(assign, ":value", 1),
				(assign, ":value_2", 0),
			(try_end),
			(call_script, "script_troop_spawn_basic", ":value", "$player_spawn_num", 0, "$player_first_spawn_entry"),
			(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
			(call_script, "script_battle_tile_spawn_try_for", 31, "$temp_party_troop_01", ":value_2", -1, ":var_1"),
			(call_script, "script_battle_tile_spawn_try_for", 32, "$temp_party_troop_02", ":value_2", -1, ":var_1"),
			(call_script, "script_battle_tile_spawn_try_for", 33, "$temp_party_troop_03", ":value_2", -1, ":var_1"),
			(call_script, "script_battle_tile_spawn_try_for", 34, "$temp_party_troop_04", ":value_2", -1, ":var_1"),
			(call_script, "script_battle_tile_spawn_try_for", 35, "$temp_party_troop_05", ":value_2", -1, ":var_1"),
			(call_script, "script_battle_tile_spawn_try_for", 36, "$temp_party_troop_06", ":value_2", -1, ":var_1"),
			(call_script, "script_battle_tile_spawn_try_for", 37, "$temp_party_troop_07", ":value_2", -1, ":var_1"),
			(call_script, "script_battle_tile_spawn_try_for", 38, "$temp_party_troop_08", ":value_2", -1, ":var_1"),
			(call_script, "script_battle_tile_spawn_try_for", 39, "$temp_party_troop_09", ":value_2", -1, ":var_1"),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_place_player_banner_near_inventory_bms")
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("ai_training", mtf_battle_mode, -1,
	"You start training.",
	[(0, 0, 0, aif_start_alarmed, 1, [])],
	[
		(-21.0, 0.0, 0.0,
		[],

		[
			(finish_mission)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(scene_set_day_time, 13)
		])
	]),

	("duel_mission", mtf_battle_mode|mtf_synch_inventory, 8,
	"You lead your men to battle.",
	[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(1, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(2, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(3, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(4, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(5, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(6, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(7, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(8, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(9, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(10, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(11, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(12, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(13, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(14, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(15, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(16, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(17, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(18, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(19, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(20, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(21, mtef_visitor_source|mtef_team_3, 0, 0, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0),
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 2, 1),
			(team_set_relation, 0, 3, 1),
			(team_set_relation, 1, 3, 1),
			(team_set_relation, 2, 3, 1),
			(assign, "$wm_duel_won", 0)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 20),
			(val_div, ":var_2", 20),
			(set_show_messages, 1),
			(call_script, "script_wm_troop_type_depend_train", "p_main_party", 0),
			(add_visitors_to_current_scene, 12, "$temp_party_troop_01", ":var_1"),
			(add_visitors_to_current_scene, 13, "$temp_party_troop_02", ":var_1"),
			(add_visitors_to_current_scene, 14, "$temp_party_troop_03", ":var_1"),
			(add_visitors_to_current_scene, 15, "$temp_party_troop_04", ":var_1"),
			(add_visitors_to_current_scene, 16, "$temp_party_troop_05", ":var_1"),
			(add_visitors_to_current_scene, 17, "$temp_party_troop_06", ":var_1"),
			(add_visitors_to_current_scene, 18, "$temp_party_troop_07", ":var_1"),
			(add_visitors_to_current_scene, 19, "$temp_party_troop_08", ":var_1"),
			(add_visitors_to_current_scene, 20, "$temp_party_troop_09", ":var_1"),
			(add_visitors_to_current_scene, 21, "$temp_party_troop_10", ":var_1"),
			(try_begin),
				(gt, "$wm_comp_id_1", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_1", 1),
			(try_end),
			(try_begin),
				(gt, "$wm_comp_id_2", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_2", 1),
			(try_end),
			(try_begin),
				(gt, "$wm_comp_id_3", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_3", 1),
			(try_end),
			(try_begin),
				(gt, "$wm_comp_id_4", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_4", 1),
			(try_end),
			(try_begin),
				(gt, "$wm_comp_id_5", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_5", 1),
			(try_end),
			(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
			(add_visitors_to_current_scene, 2, "$temp_party_troop_01", ":var_2"),
			(add_visitors_to_current_scene, 3, "$temp_party_troop_02", ":var_2"),
			(add_visitors_to_current_scene, 4, "$temp_party_troop_03", ":var_2"),
			(add_visitors_to_current_scene, 5, "$temp_party_troop_04", ":var_2"),
			(add_visitors_to_current_scene, 6, "$temp_party_troop_05", ":var_2"),
			(add_visitors_to_current_scene, 7, "$temp_party_troop_06", ":var_2"),
			(add_visitors_to_current_scene, 8, "$temp_party_troop_07", ":var_2"),
			(add_visitors_to_current_scene, 9, "$temp_party_troop_08", ":var_2"),
			(add_visitors_to_current_scene, 10, "$temp_party_troop_09", ":var_2"),
			(add_visitors_to_current_scene, 11, "$temp_party_troop_10", ":var_2")
		]),

		(0.0, 1.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(set_show_messages, 0),
				(agent_set_ammo, ":var_1", 197, 0),
				(agent_set_ammo, ":var_1", 198, 0),
				(agent_set_ammo, ":var_1", 199, 0),
				(agent_set_ammo, ":var_1", 200, 0),
				(agent_set_ammo, ":var_1", 1333, 0),
				(agent_set_ammo, ":var_1", 1334, 0),
				(agent_set_ammo, ":var_1", 1335, 0),
				(agent_set_ammo, ":var_1", 1336, 0),
				(set_show_messages, 1),
			(try_end)
		]),

		(0.0, 1.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(try_begin),
					(gt, ":horse_var_1", 0),
					(store_agent_hit_points, ":agent_hit_points_horse_var_1_1", ":horse_var_1", 1),
					(store_mul, ":value", 100, 1000),
					(val_add, ":agent_hit_points_horse_var_1_1", ":value"),
					(agent_set_max_hit_points, ":horse_var_1", ":agent_hit_points_horse_var_1_1", 1),
					(agent_set_hit_points, ":horse_var_1", 100, 0),
				(try_end),
			(try_end)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$wm_battle_result_state", 1),
				(assign, "$wm_duel_won", 1),
				(try_begin),
					(eq, "$wm_duel_persnal", 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_pst_battle_tile"),
				(else_try),
					(eq, "$wm_duel_persnal", 1),
					(try_begin),
						(eq, "$qquest_type", 22),
						(num_active_teams_le, 1),
						(assign, "$qquest_progress", 1),
						(display_message, "str_questsucc", 0x00ffff00),
						(play_sound, "snd_quest_succeeded"),
						(display_message, "str_duel_lord_win"),
					(try_end),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(assign, "$wm_duel_won", 2),
				(try_begin),
					(eq, "$wm_duel_persnal", 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_pst_battle_tile"),
				(else_try),
					(eq, "$wm_duel_persnal", 1),
					(try_begin),
						(eq, "$qquest_type", 22),
						(main_hero_fallen),
						(assign, "$qquest_progress", 2),
						(display_message, "str_questfail", 0x00ffff00),
						(play_sound, "snd_bad_drum"),
						(display_message, "str_duel_lord_lose"),
					(try_end),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(try_end),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(neq, ":team_trigger_param_1", ":team_player_agent_no"),
			(assign, "$wm_battle_result_state", 1)
		]),

		(1.0, 2.0, ti_once,
		[
			(main_hero_fallen)
		],

		[
			(assign, "$wm_battle_result_state", 2)
		]),

		(1.0, 0.0, 3.0,
		[
			(this_or_next|eq, "$wm_duel_won", 1),
			(eq, "$wm_duel_won", 2)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(try_begin),
					(eq, ":team_var_1", 2),
					(main_hero_fallen),
					(agent_set_animation, ":var_1", "anim_cheer"),
					(play_sound, "snd_man_yell"),
				(else_try),
					(eq, ":team_var_1", 3),
					(neg|main_hero_fallen),
					(agent_set_animation, ":var_1", "anim_cheer"),
					(play_sound, "snd_man_victory"),
				(try_end),
			(try_end)
		]),

		(-22.0, 0.0, 0.0,
		[],

		[
			(display_message, "str_use_baggage_for_inventory")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("duel_mission_sea", mtf_battle_mode|mtf_synch_inventory, 8,
	"You lead your men to battle.",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(2, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(3, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(4, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(5, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(6, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(7, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(8, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(9, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(10, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(11, mtef_visitor_source|mtef_team_2, 0, 0, 0, []),
	(12, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(13, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(14, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(15, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(16, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(17, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(18, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(19, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(20, mtef_visitor_source|mtef_team_3, 0, 0, 0, []),
	(21, mtef_visitor_source|mtef_team_3, 0, 0, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0),
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 2, 1),
			(team_set_relation, 0, 3, 1),
			(team_set_relation, 1, 3, 1),
			(team_set_relation, 2, 3, 1),
			(assign, "$wm_duel_won", 0)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_battle_scale_sett"),
			(assign, ":var_1", "$player_spawn_num"),
			(assign, ":var_2", "$enemy_spawn_num"),
			(set_show_messages, 0),
			(val_div, ":var_1", 20),
			(val_div, ":var_2", 20),
			(set_show_messages, 1),
			(call_script, "script_wm_troop_type_depend_train", "p_main_party", 0),
			(add_visitors_to_current_scene, 12, "$temp_party_troop_01", ":var_1"),
			(add_visitors_to_current_scene, 13, "$temp_party_troop_02", ":var_1"),
			(add_visitors_to_current_scene, 14, "$temp_party_troop_03", ":var_1"),
			(add_visitors_to_current_scene, 15, "$temp_party_troop_04", ":var_1"),
			(add_visitors_to_current_scene, 16, "$temp_party_troop_05", ":var_1"),
			(add_visitors_to_current_scene, 17, "$temp_party_troop_06", ":var_1"),
			(add_visitors_to_current_scene, 18, "$temp_party_troop_07", ":var_1"),
			(add_visitors_to_current_scene, 19, "$temp_party_troop_08", ":var_1"),
			(add_visitors_to_current_scene, 20, "$temp_party_troop_09", ":var_1"),
			(add_visitors_to_current_scene, 21, "$temp_party_troop_10", ":var_1"),
			(try_begin),
				(gt, "$wm_comp_id_1", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_1", 1),
			(try_end),
			(try_begin),
				(gt, "$wm_comp_id_2", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_2", 1),
			(try_end),
			(try_begin),
				(gt, "$wm_comp_id_3", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_3", 1),
			(try_end),
			(try_begin),
				(gt, "$wm_comp_id_4", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_4", 1),
			(try_end),
			(try_begin),
				(gt, "$wm_comp_id_5", 0),
				(add_visitors_to_current_scene, 12, "$wm_comp_id_5", 1),
			(try_end),
			(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 0),
			(add_visitors_to_current_scene, 2, "$temp_party_troop_01", ":var_2"),
			(add_visitors_to_current_scene, 3, "$temp_party_troop_02", ":var_2"),
			(add_visitors_to_current_scene, 4, "$temp_party_troop_03", ":var_2"),
			(add_visitors_to_current_scene, 5, "$temp_party_troop_04", ":var_2"),
			(add_visitors_to_current_scene, 6, "$temp_party_troop_05", ":var_2"),
			(add_visitors_to_current_scene, 7, "$temp_party_troop_06", ":var_2"),
			(add_visitors_to_current_scene, 8, "$temp_party_troop_07", ":var_2"),
			(add_visitors_to_current_scene, 9, "$temp_party_troop_08", ":var_2"),
			(add_visitors_to_current_scene, 10, "$temp_party_troop_09", ":var_2"),
			(add_visitors_to_current_scene, 11, "$temp_party_troop_10", ":var_2")
		]),

		(0.0, 1.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(set_show_messages, 0),
				(agent_set_ammo, ":var_1", 197, 0),
				(agent_set_ammo, ":var_1", 198, 0),
				(agent_set_ammo, ":var_1", 199, 0),
				(agent_set_ammo, ":var_1", 200, 0),
				(agent_set_ammo, ":var_1", 1333, 0),
				(agent_set_ammo, ":var_1", 1334, 0),
				(agent_set_ammo, ":var_1", 1335, 0),
				(agent_set_ammo, ":var_1", 1336, 0),
				(set_show_messages, 1),
			(try_end)
		]),

		(0.0, 1.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(try_begin),
					(gt, ":horse_var_1", 0),
					(store_agent_hit_points, ":agent_hit_points_horse_var_1_1", ":horse_var_1", 1),
					(store_mul, ":value", 100, 1000),
					(val_add, ":agent_hit_points_horse_var_1_1", ":value"),
					(agent_set_max_hit_points, ":horse_var_1", ":agent_hit_points_horse_var_1_1", 1),
					(agent_set_hit_points, ":horse_var_1", 100, 0),
				(try_end),
			(try_end)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$wm_battle_result_state", 1),
				(assign, "$wm_duel_won", 1),
				(try_begin),
					(eq, "$wm_duel_persnal", 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_pst_battle_tile"),
				(else_try),
					(eq, "$wm_duel_persnal", 1),
					(try_begin),
						(eq, "$qquest_type", 22),
						(num_active_teams_le, 1),
						(assign, "$qquest_progress", 1),
						(display_message, "str_questsucc", 0x00ffff00),
						(play_sound, "snd_quest_succeeded"),
						(display_message, "str_duel_lord_win"),
					(try_end),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(assign, "$wm_duel_won", 2),
				(try_begin),
					(eq, "$wm_duel_persnal", 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_pst_battle_tile"),
				(else_try),
					(eq, "$wm_duel_persnal", 1),
					(try_begin),
						(eq, "$qquest_type", 22),
						(main_hero_fallen),
						(assign, "$qquest_progress", 2),
						(display_message, "str_questfail", 0x00ffff00),
						(play_sound, "snd_bad_drum"),
						(display_message, "str_duel_lord_lose"),
					(try_end),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(try_end),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(neq, ":team_trigger_param_1", ":team_player_agent_no"),
			(assign, "$wm_battle_result_state", 1)
		]),

		(1.0, 2.0, ti_once,
		[
			(main_hero_fallen)
		],

		[
			(assign, "$wm_battle_result_state", 2)
		]),

		(1.0, 0.0, 3.0,
		[
			(this_or_next|eq, "$wm_duel_won", 1),
			(eq, "$wm_duel_won", 2)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(try_begin),
					(eq, ":team_var_1", 2),
					(main_hero_fallen),
					(agent_set_animation, ":var_1", "anim_cheer"),
					(play_sound, "snd_man_yell"),
				(else_try),
					(eq, ":team_var_1", 3),
					(neg|main_hero_fallen),
					(agent_set_animation, ":var_1", "anim_cheer"),
					(play_sound, "snd_man_victory"),
				(try_end),
			(try_end)
		]),

		(-22.0, 0.0, 0.0,
		[],

		[
			(display_message, "str_use_baggage_for_inventory")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("lead_charge_molda_sea_battle", mtf_battle_mode, 8,
	"You lead your men to battle.",
	[(0, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(1, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(2, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(3, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(4, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(5, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(6, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(7, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(8, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(9, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(10, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(11, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(12, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(13, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(14, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(15, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(16, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(17, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(18, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(19, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(20, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(21, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(22, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(23, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(24, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(25, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(26, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(27, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(28, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(29, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(30, mtef_visitor_source|mtef_team_0, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(31, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(32, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(33, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(34, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(35, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(36, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(37, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(38, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(39, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(40, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(41, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(42, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(43, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(44, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(45, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(46, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(47, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(48, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(49, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(50, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(51, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(52, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(53, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(54, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(55, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(56, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(57, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(58, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(59, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(60, mtef_visitor_source|mtef_team_1, af_override_head|af_override_body|af_override_foot|af_override_gloves, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody]),
	(61, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_caravel, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(62, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_carrack, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(63, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_xebec, itm_ship_melee_1, itm_ship_range_arrow_1]),
	(64, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_galley, itm_ship_melee_1, itm_ship_range_arrow_1]),
	(65, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_galleon, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(66, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_turship, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(67, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_junkship, itm_ship_melee_1, itm_ship_range_arrow_1]),
	(68, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_panship, itm_ship_melee_1, itm_ship_range_arrow_1]),
	(69, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_frigate, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(70, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_dragonship, itm_ship_melee_1, itm_ship_range_arrow_1]),
	(71, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_galleas, itm_ship_melee_1, itm_ship_range_arrow_1]),
	(72, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_black_ship, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(73, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_ghost, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(74, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_antecship, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(75, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_nugakship, itm_ship_melee_1, itm_ship_range_arrow_1]),
	(76, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_panokship, itm_ship_melee_gun_1, itm_ship_range_ball_1]),
	(77, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, [itm_ship_invisiblehead, itm_ship_invisiblehand, itm_ship_invisiblefoot, itm_ship_invisiblebody, itm_mi_sb_Boat, itm_ship_melee_1, itm_ship_range_arrow_1])],
	[
		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_set_division, ":trigger_param_1", 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$wm_battle_result_state", 0),
			(call_script, "script_change_banners_and_chest"),
			(team_set_relation, 0, 1, -1),
			(assign, "$count_player_team", "$sb_ally_max_spawn"),
			(assign, "$count_enemy_team", "$sb_enemy_max_spawn")
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(this_or_next|party_slot_eq, "$g_encountered_party", 15, 40),
				(party_slot_eq, "$g_encountered_party", 15, 41),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_cannot_leave_now"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(assign, "$wm_quest_mission_anti_skip_menu", 0),
					(assign, "$wm_quest_result", 1),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$wm_quest_mission_anti_skip_menu", 0),
					(assign, "$wm_quest_result", 2),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
				(try_end),
			(else_try),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(question_box, "str_do_you_want_to_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
				(try_end),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(call_script, "script_wm_count_army_damage_after_battle"),
			(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
			(assign, "$wm_battle_result_state", 3),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief")
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(try_begin),
				(agent_is_human, ":trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(neq, ":team_trigger_param_1", ":team_player_agent_no"),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_ship_06"),
					(try_begin),
						(lt, "$blueprint_turtle", 20),
						(val_add, "$blueprint_turtle", 1),
					(try_end),
					(try_begin),
						(eq, "$blueprint_turtle", 20),
						(val_add, "$blueprint_turtle", 1),
						(assign, ":value", 1423),
						(troop_add_item, "trp_player", ":value", 0),
						(display_message, "str_bluep_turtle", 0x00ffff00),
					(try_end),
				(else_try),
					(eq, ":troop_id_trigger_param_1", "trp_ship_09"),
					(try_begin),
						(lt, "$blueprint_frigate", 20),
						(val_add, "$blueprint_frigate", 1),
					(try_end),
					(try_begin),
						(eq, "$blueprint_frigate", 20),
						(val_add, "$blueprint_frigate", 1),
						(assign, ":value", 1422),
						(troop_add_item, "trp_player", ":value", 0),
						(display_message, "str_bluep_frigate", 0x00ffff00),
					(try_end),
				(else_try),
					(eq, ":troop_id_trigger_param_1", "trp_ship_12"),
					(try_begin),
						(lt, "$blueprint_blackship", 20),
						(val_add, "$blueprint_blackship", 1),
					(try_end),
					(try_begin),
						(eq, "$blueprint_blackship", 20),
						(val_add, "$blueprint_blackship", 1),
						(assign, ":value", 1421),
						(troop_add_item, "trp_player", ":value", 0),
						(display_message, "str_bluep_black", 0x00ffff00),
					(try_end),
				(try_end),
			(try_end),
			(set_show_messages, 1)
		]),

		(2.0, 0.0, ti_once,
		[
			(assign, "$sb_ally_remain", 0),
			(assign, "$sb_enemy_remain", 0),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_for_agents, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_is_human, ":var_3"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(try_begin),
					(eq, ":team_var_3", ":team_player_agent_no"),
					(val_add, "$sb_ally_remain", 1),
				(else_try),
					(val_add, "$sb_enemy_remain", 1),
				(try_end),
			(try_end),
			(this_or_next|le, "$sb_enemy_remain", 0),
			(le, "$sb_ally_remain", 0)
		],

		[
			(try_begin),
				(le, "$sb_enemy_remain", 0),
				(assign, "$wm_battle_result_state", 1),
				(display_message, "str_msg_battle_won"),
				(call_script, "script_molda_music_box", 10, 0),
			(else_try),
				(le, "$sb_ally_remain", 0),
				(assign, "$wm_battle_result_state", 2),
				(assign, "$wm_battle_result_state", 2),
				(call_script, "script_molda_music_box", 10, 0),
			(try_end)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(0.0, 2.0, 2.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(try_begin),
					(eq, ":horse_var_1", -1),
					(set_show_messages, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 1.0, ti_once,
		[],

		[
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_for_agents, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_is_human, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(try_begin),
					(eq, ":team_var_3", ":team_player_agent_no"),
					(assign, ":value", "$player_shipwood"),
					(assign, ":value_2", "$player_shipammo"),
					(assign, ":value_3", "$player_has_finewood"),
					(assign, ":value_4", "$player_has_iron"),
					(assign, ":value_5", "$player_naval_skill"),
				(else_try),
					(assign, ":value", "$enemy_shipwood"),
					(assign, ":value_2", "$enemy_shipammo"),
					(assign, ":value_3", "$enemy_has_finewood"),
					(assign, ":value_4", "$enemy_has_iron"),
					(assign, ":value_5", "$enemy_naval_skill"),
				(try_end),
				(try_begin),
					(try_begin),
						(gt, ":horse_var_3", 0),
						(try_begin),
							(eq, ":var_3", ":player_agent_no"),
							(try_begin),
								(eq, "$m_ship_type_1", 1400),
								(store_mul, ":value_6", 100, 5),
							(else_try),
								(eq, "$m_ship_type_1", 1401),
								(store_mul, ":value_6", 100, 7),
							(else_try),
								(eq, "$m_ship_type_1", 1402),
								(store_mul, ":value_6", 100, 8),
							(else_try),
								(eq, "$m_ship_type_1", 1403),
								(store_mul, ":value_6", 100, 8),
							(else_try),
								(eq, "$m_ship_type_1", 1404),
								(store_mul, ":value_6", 25, 30),
							(else_try),
								(eq, "$m_ship_type_1", 1405),
								(store_mul, ":value_6", 100, 10),
								(val_add, ":value_6", 100),
							(else_try),
								(eq, "$m_ship_type_1", 1406),
								(store_mul, ":value_6", 100, 20),
								(val_sub, ":value_6", 200),
							(else_try),
								(eq, "$m_ship_type_1", 1407),
								(store_mul, ":value_6", 100, 8),
							(else_try),
								(eq, "$m_ship_type_1", 1408),
								(store_mul, ":value_6", 100, 7),
							(else_try),
								(eq, "$m_ship_type_1", 1409),
								(store_mul, ":value_6", 100, 15),
								(val_add, ":value_6", 100),
							(else_try),
								(eq, "$m_ship_type_1", 1410),
								(store_mul, ":value_6", 100, 7),
							(else_try),
								(eq, "$m_ship_type_1", 1411),
								(store_mul, ":value_6", 100, 10),
								(val_add, ":value_6", 100),
							(else_try),
								(eq, "$m_ship_type_1", 1412),
								(store_mul, ":value_6", 100, 15),
							(else_try),
								(eq, "$m_ship_type_1", 1413),
								(store_mul, ":value_6", 100, 15),
								(val_add, ":value_6", 100),
							(else_try),
								(eq, "$m_ship_type_1", 1414),
								(store_mul, ":value_6", 100, 9),
								(val_add, ":value_6", 50),
							(else_try),
								(eq, "$m_ship_type_1", 1415),
								(store_mul, ":value_6", 100, 8),
							(else_try),
								(eq, "$m_ship_type_1", 1416),
								(store_mul, ":value_6", 100, 9),
							(try_end),
						(else_try),
							(try_begin),
								(eq, ":troop_id_var_3", "trp_ship_00"),
								(store_mul, ":value_6", 100, 5),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_01"),
								(store_mul, ":value_6", 100, 7),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_02"),
								(store_mul, ":value_6", 100, 8),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_03"),
								(store_mul, ":value_6", 100, 8),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_04"),
								(store_mul, ":value_6", 25, 30),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_05"),
								(store_mul, ":value_6", 100, 10),
								(val_add, ":value_6", 100),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_06"),
								(store_mul, ":value_6", 100, 20),
								(val_sub, ":value_6", 200),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_07"),
								(store_mul, ":value_6", 100, 8),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_08"),
								(store_mul, ":value_6", 100, 7),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_09"),
								(store_mul, ":value_6", 100, 15),
								(val_add, ":value_6", 100),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_10"),
								(store_mul, ":value_6", 100, 7),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_11"),
								(store_mul, ":value_6", 100, 10),
								(val_add, ":value_6", 100),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_12"),
								(store_mul, ":value_6", 100, 15),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_13"),
								(store_mul, ":value_6", 100, 15),
								(val_add, ":value_6", 100),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_14"),
								(store_mul, ":value_6", 100, 9),
								(val_add, ":value_6", 50),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_15"),
								(store_mul, ":value_6", 100, 8),
							(else_try),
								(eq, ":troop_id_var_3", "trp_ship_16"),
								(store_mul, ":value_6", 100, 9),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":horse_var_3", ":value_6", 1),
						(agent_set_hit_points, ":horse_var_3", 50, 1),
						(agent_set_hit_points, ":horse_var_3", 100, 0),
						(store_agent_hit_points, ":value_6", ":horse_var_3", 1),
						(try_begin),
							(eq, ":value_3", 1),
							(val_add, ":value_6", 70),
						(try_end),
						(try_begin),
							(gt, ":value_5", 0),
							(store_mul, ":value_7", ":value_5", 15),
							(val_add, ":value_6", ":value_7"),
						(try_end),
						(val_add, ":value_6", ":value"),
						(agent_set_max_hit_points, ":horse_var_3", ":value_6", 1),
						(agent_set_hit_points, ":horse_var_3", 100, 0),
					(try_end),
					(assign, ":var_14", 5),
					(val_add, ":var_14", ":value_2"),
					(try_begin),
						(eq, ":value_4", 1),
						(val_add, ":var_14", 5),
					(try_end),
					(agent_set_ammo, ":var_3", 1426, ":var_14"),
					(try_begin),
						(eq, ":value_4", 1),
						(val_sub, ":var_14", 5),
					(try_end),
					(agent_set_ammo, ":var_3", 1427, ":var_14"),
				(try_end),
			(try_end),
			(agent_get_horse, ":horse_var_3", ":player_agent_no"),
			(try_begin),
				(gt, ":horse_var_3", 0),
				(store_agent_hit_points, reg8, ":horse_var_3", 1),
				(display_message, "str_ply_hp_disp2"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("visit_town_castle", 0, -1,
	"You enter the halls of the lord.",
	[(0, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(1, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(5, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
	(6, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
	(7, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
	(8, mtef_visitor_source, af_override_horse, 0, 1, []),
	(9, mtef_visitor_source, af_override_horse, 0, 1, []),
	(10, mtef_scene_source, af_override_horse, 0, 1, []),
	(11, mtef_scene_source, af_override_horse, 0, 1, []),
	(12, mtef_visitor_source, af_override_horse, 0, 1, []),
	(13, mtef_visitor_source, 0, 0, 1, []),
	(14, mtef_visitor_source, 0, 0, 1, []),
	(15, mtef_visitor_source, 0, 0, 1, []),
	(16, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(17, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(18, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(19, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(20, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(21, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(22, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(23, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(24, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(25, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(26, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(27, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(28, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(29, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(30, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, []),
	(31, mtef_visitor_source, af_override_weapons|af_override_horse|af_require_civilian, 0, 1, [])],
	[
		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, 0.0,
		[
			(key_clicked, 1)
		],

		[
			(display_message, "str_escape_alarm", 0x00ffff00)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, 0)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_23_00"),
				(eq, ":troop_id_var_1", "trp_tt_lord_18_08"),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":var_1", ":number"),
				(try_end),
				(agent_equip_item, ":var_1", 438),
				(agent_equip_item, ":var_1", 203),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_change_banners_and_chest")
		]),

		(-22.0, 0.0, 0.0,
		[
			(set_trigger_result, 1)
		],

		[]),

		(-21.0, 0.0, 0.0,
		[
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit")
		],

		[])
	]),

	("town_center", 0, -1,
	"Default town visit",
	[(0, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood, itm_pilgrim_disguise, itm_quarter_staff]),
	(1, mtef_scene_source|mtef_team_0, 0, 0, 1, []),
	(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood, itm_pilgrim_disguise, itm_quarter_staff]),
	(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood, itm_pilgrim_disguise, itm_quarter_staff]),
	(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood, itm_pilgrim_disguise, itm_quarter_staff]),
	(5, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood, itm_pilgrim_disguise, itm_quarter_staff]),
	(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood, itm_pilgrim_disguise, itm_quarter_staff]),
	(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood, itm_pilgrim_disguise, itm_quarter_staff]),
	(8, mtef_visitor_source, af_override_horse, 0, 1, []),
	(9, mtef_visitor_source, af_override_horse, 0, 1, []),
	(10, mtef_visitor_source, af_override_horse, 0, 1, []),
	(11, mtef_visitor_source, af_override_horse, 0, 1, []),
	(12, mtef_visitor_source, af_override_horse, 0, 1, []),
	(13, mtef_visitor_source, 0, 0, 1, []),
	(14, mtef_scene_source, 0, 0, 1, []),
	(15, mtef_scene_source, 0, 0, 1, []),
	(16, mtef_visitor_source, af_override_horse, 0, 1, []),
	(17, mtef_visitor_source, af_override_horse, 0, 1, []),
	(18, mtef_visitor_source, af_override_horse, 0, 1, []),
	(19, mtef_visitor_source, af_override_horse, 0, 1, []),
	(20, mtef_visitor_source, af_override_horse, 0, 1, []),
	(21, mtef_visitor_source, af_override_horse, 0, 1, []),
	(22, mtef_visitor_source, af_override_horse, 0, 1, []),
	(23, mtef_visitor_source, af_override_horse, 0, 1, []),
	(24, mtef_visitor_source, af_override_horse, 0, 1, []),
	(25, mtef_visitor_source, af_override_horse, 0, 1, []),
	(26, mtef_visitor_source, af_override_horse, 0, 1, []),
	(27, mtef_visitor_source, af_override_horse, 0, 1, []),
	(28, mtef_visitor_source, af_override_horse, 0, 1, []),
	(29, mtef_visitor_source, af_override_horse, 0, 1, []),
	(30, mtef_visitor_source, af_override_horse, 0, 1, []),
	(31, mtef_visitor_source, af_override_horse, 0, 1, []),
	(32, mtef_visitor_source, af_override_horse, 0, 1, []),
	(33, mtef_visitor_source, af_override_horse, 0, 1, []),
	(34, mtef_visitor_source, af_override_horse, 0, 1, []),
	(35, mtef_visitor_source, af_override_horse, 0, 1, []),
	(36, mtef_visitor_source, af_override_horse, 0, 1, []),
	(37, mtef_visitor_source, af_override_horse, 0, 1, []),
	(38, mtef_visitor_source, af_override_horse, 0, 1, []),
	(39, mtef_visitor_source, af_override_horse, 0, 1, []),
	(40, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(41, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(42, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(43, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(44, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(45, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(46, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(47, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, [])],
	[
		(0.0, 0.0, 0.0,
		[
			(key_clicked, 1)
		],

		[
			(display_message, "str_escape_alarm", 0x00ffff00)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-20.0, 0.0, ti_once,
		[
			(store_current_scene, ":current_scene"),
			(this_or_next|eq, ":current_scene", "scn_molda_siege_mission_urt"),
			(eq, ":current_scene", "scn_8_vill_urt")
		],

		[
			(set_show_messages, 0),
			(entry_point_get_position, 1, 32),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 33),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 34),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 35),
			(set_spawn_position, 1),
			(spawn_horse, 154, 0),
			(entry_point_get_position, 1, 36),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 37),
			(set_spawn_position, 1),
			(spawn_horse, 154, 0),
			(entry_point_get_position, 1, 38),
			(set_spawn_position, 1),
			(spawn_horse, 155, 0),
			(entry_point_get_position, 1, 39),
			(set_spawn_position, 1),
			(spawn_horse, 156, 0),
			(entry_point_get_position, 1, 51),
			(set_spawn_position, 1),
			(spawn_horse, 157, 0),
			(entry_point_get_position, 1, 52),
			(set_spawn_position, 1),
			(spawn_horse, 156, 0),
			(entry_point_get_position, 1, 53),
			(set_spawn_position, 1),
			(spawn_horse, 157, 0),
			(entry_point_get_position, 1, 54),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 55),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 56),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 57),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 58),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 59),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 60),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 61),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 62),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 63),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 64),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 65),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 66),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 67),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 68),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 69),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 70),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 71),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 72),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 73),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 74),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 75),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 76),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 77),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 78),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 79),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 80),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(set_show_messages, 1)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, -1),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, 0),
			(assign, "$prison_guard_agent", -1),
			(try_begin),
				(eq, "$main_q_step", 22),
				(scene_set_day_time, 23),
			(try_end),
			(try_begin),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(party_slot_eq, "$g_encountered_party", 15, 5),
				(scene_set_day_time, 23),
			(try_end),
			(try_begin),
				(eq, "$qquest_type", 24),
				(eq, "$qquest_target_party", "$g_encountered_party"),
				(mission_disable_talk),
				(scene_set_day_time, 23),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(eq, ":troop_id_trigger_param_1", "trp_fugitive"),
				(eq, "$qquest_type", 2),
				(eq, "$qquest_target_party", "$g_encountered_party"),
				(assign, "$qquest_progress", 1),
				(dialog_box, "str_questsucc", "str_box_note"),
				(play_sound, "snd_quest_succeeded"),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit"),
			(else_try),
				(eq, ":troop_id_trigger_param_1", "trp_player"),
				(eq, "$qquest_type", 2),
				(eq, "$qquest_target_party", "$g_encountered_party"),
				(call_script, "script_qquest_initialize"),
				(dialog_box, "str_fugitive_fail", "str_box_note"),
				(play_sound, "snd_bad_drum"),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit"),
			(else_try),
				(eq, ":troop_id_trigger_param_1", "trp_player"),
				(eq, "$qquest_type", 32),
				(display_message, "str_questfail", 0x00ffff00),
				(play_sound, "snd_bad_drum"),
				(call_script, "script_qquest_initialize"),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit"),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(call_script, "script_init_town_agent", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(eq, ":troop_id_trigger_param_1", "trp_fugitive"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(eq, "$qquest_type", 24),
				(eq, ":troop_id_trigger_param_1", "$qquest_target_faction"),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":trigger_param_1", ":number"),
				(try_end),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(eq, "$qquest_type", 24),
				(eq, ":troop_id_trigger_param_1", "$qquest_target_troop"),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":trigger_param_1", ":number"),
				(try_end),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(eq, "$qquest_type", 32),
				(eq, ":trigger_param_1", "$prison_guard_agent"),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_jailbreak_enter"),
			(try_end),
			(try_begin),
				(eq, "$main_q_step", 22),
				(eq, ":troop_id_trigger_param_1", "trp_player"),
				(assign, "$main_q_step", 24),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(try_end),
			(try_begin),
				(eq, "$main_q_step", 22),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(assign, "$main_q_step", 23),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(try_end)
		]),

		(0.0, 2.0, ti_once,
		[
			(eq, "$qquest_type", 32)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(is_between, ":troop_id_var_1", "trp_farmer", "trp_town_walker_1"),
				(agent_get_position, 11, ":var_1"),
				(entry_point_get_position, 12, 24),
				(get_distance_between_positions, ":distance_between_positions_11_12", 11, 12),
				(try_begin),
					(lt, ":distance_between_positions_11_12", 200),
					(assign, "$prison_guard_agent", ":var_1"),
				(try_end),
			(try_end)
		]),

		(0.0, 1.0, ti_once,
		[],

		[
			(call_script, "script_init_town_walker_agents")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_change_banners_and_chest")
		]),

		(-21.0, 0.0, 0.0,
		[
			(try_begin),
				(eq, "$main_q_step", 22),
				(display_message, "str_cannot_leave_now"),
			(else_try),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(party_slot_eq, "$g_encountered_party", 15, 3),
				(assign, "$wm_quest_mission_anti_skip_menu", 0),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(else_try),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(party_slot_eq, "$g_encountered_party", 15, 5),
				(assign, "$wm_quest_mission_anti_skip_menu", 0),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(else_try),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit"),
			(try_end)
		],

		[]),

		(1.0, 0.0, ti_once,
		[
			(eq, "$main_q_step", 22)
		],

		[
			(eq, "$main_q_step", 22),
			(mission_disable_talk),
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(try_begin),
					(this_or_next|eq, ":troop_id_var_1", "trp_raid_bandit_boss"),
					(eq, ":troop_id_var_1", "trp_raid_bandit_brigand"),
					(agent_set_team, ":var_1", 4),
					(agent_set_is_alarmed, ":var_1", 1),
					(agent_ai_set_aggressiveness, ":var_1", 199),
				(else_try),
					(eq, ":troop_id_var_1", "$first_comp_id"),
					(agent_set_team, ":var_1", 0),
					(agent_set_is_alarmed, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(3.0, 5.0, 0.0,
		[
			(eq, "$wm_quest_mission_anti_skip_menu", 1),
			(party_slot_eq, "$g_encountered_party", 15, 5),
			(le, "$assassinate_arrow_chance", 0)
		],

		[
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(0.0, 2.0, ti_once,
		[
			(eq, "$wm_quest_mission_anti_skip_menu", 1),
			(party_slot_eq, "$g_encountered_party", 15, 5)
		],

		[
			(dialog_box, "str_wm_qst_assasin_target", "str_box_say")
		]),

		(3.0, 0.0, 0.0,
		[
			(eq, "$qquest_type", 2),
			(eq, "$qquest_target_party", "$g_encountered_party")
		],

		[
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_position, 31, ":player_agent_no"),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(neq, ":var_2", ":player_agent_no"),
				(agent_get_position, 33, ":var_2"),
				(get_distance_between_positions, ":distance_between_positions_31_33", 31, 33),
				(try_begin),
					(lt, ":distance_between_positions_31_33", 150),
					(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
					(eq, ":troop_id_var_2", "trp_fugitive"),
					(display_message, "str_fugitive_alert", 0x0000ff00),
				(try_end),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[
			(eq, "$qquest_type", 24),
			(eq, "$qquest_target_party", "$g_encountered_party")
		],

		[
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_position, 31, ":player_agent_no"),
			(assign, ":value", 0),
			(try_for_agents, ":var_3"),
				(agent_is_alive, ":var_3"),
				(neq, ":var_3", ":player_agent_no"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(try_begin),
					(eq, ":troop_id_var_3", "$qquest_target_troop"),
					(try_for_agents, ":var_5"),
						(agent_is_alive, ":var_5"),
						(neq, ":var_5", ":player_agent_no"),
						(agent_get_troop_id, ":troop_id_var_3", ":var_5"),
						(eq, ":troop_id_var_3", "$qquest_target_faction"),
						(agent_get_position, 32, ":var_5"),
					(try_end),
					(agent_set_scripted_destination_no_attack, ":var_3", 32, 0),
					(agent_get_position, 33, ":var_3"),
					(get_distance_between_positions, ":distance_between_positions_32_33", 32, 33),
					(try_begin),
						(lt, ":distance_between_positions_32_33", 300),
						(assign, ":value", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(eq, ":troop_id_var_3", "$qquest_target_faction"),
					(agent_get_position, 34, ":var_3"),
					(get_distance_between_positions, ":distance_between_positions_31_34", 31, 34),
					(try_begin),
						(lt, ":distance_between_positions_31_34", 200),
						(display_message, "str_misdoubt_witness", 0x0000ff00),
						(mission_enable_talk),
					(try_end),
				(try_end),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[
			(eq, "$wm_quest_mission_anti_skip_menu", 1),
			(party_slot_eq, "$g_encountered_party", 15, 5)
		],

		[
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_position, 31, ":player_agent_no"),
			(assign, ":value", 0),
			(try_for_agents, ":value_2"),
				(agent_is_alive, ":value_2"),
				(neq, ":value_2", ":player_agent_no"),
				(agent_get_position, 33, ":value_2"),
				(get_distance_between_positions, ":distance_between_positions_31_33", 31, 33),
				(try_begin),
					(lt, ":distance_between_positions_31_33", 1000),
					(assign, ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(display_message, "str_ass_witnesses", 0x00ff0000),
				(assign, "$assassinate_witness", 1),
			(else_try),
				(display_message, "str_ass_no_witnesses", 0x0000ff00),
				(assign, "$assassinate_witness", 0),
			(try_end),
			(try_for_agents, ":value_2"),
				(agent_get_troop_id, ":troop_id_value_2", ":value_2"),
				(eq, ":troop_id_value_2", "$assasin_mission_rand_target"),
				(agent_get_position, 32, ":value_2"),
				(get_distance_between_positions, ":distance_between_positions_31_32", 31, 32),
				(try_begin),
					(lt, ":distance_between_positions_31_32", 3000),
					(display_message, "str_ass_target_too_close", 0x00ff0000),
				(else_try),
					(display_message, "str_ass_target_ready", 0x0000ff00),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(is_currently_night),
				(play_sound, "snd_town_ambiance", 2),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[
			(call_script, "script_tick_town_walkers")
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(call_script, "script_center_ambiance_sounds")
		],

		[]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("village_center", 0, -1,
	"village center",
	[(0, mtef_scene_source|mtef_team_0, 0, 0, 1, []),
	(1, mtef_scene_source|mtef_team_0, 0, 0, 1, []),
	(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(5, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(8, mtef_visitor_source, 0, 0, 1, []),
	(9, mtef_visitor_source, 0, 0, 1, []),
	(10, mtef_visitor_source, af_override_horse, 0, 1, []),
	(11, mtef_visitor_source, af_override_horse, 0, 1, []),
	(12, mtef_visitor_source, af_override_horse, 0, 1, []),
	(13, mtef_visitor_source, 0, 0, 1, []),
	(14, mtef_visitor_source, 0, 0, 1, []),
	(15, mtef_visitor_source, 0, 0, 1, []),
	(16, mtef_visitor_source, af_override_horse, 0, 1, []),
	(17, mtef_visitor_source, 0, 0, 1, []),
	(18, mtef_visitor_source, af_override_horse, 0, 1, []),
	(19, mtef_visitor_source, af_override_horse, 0, 1, []),
	(20, mtef_visitor_source, af_override_horse, 0, 1, []),
	(21, mtef_visitor_source, af_override_horse, 0, 1, []),
	(22, mtef_visitor_source, af_override_horse, 0, 1, []),
	(23, mtef_visitor_source, af_override_horse, 0, 1, []),
	(24, mtef_visitor_source, af_override_horse, 0, 1, []),
	(25, mtef_visitor_source, 0, 0, 1, []),
	(26, mtef_visitor_source, 0, 0, 1, []),
	(27, mtef_visitor_source, 0, 0, 1, []),
	(28, mtef_visitor_source, 0, 0, 1, []),
	(29, mtef_visitor_source, af_override_horse, 0, 1, []),
	(30, mtef_visitor_source, af_override_horse, 0, 1, []),
	(31, mtef_visitor_source, af_override_horse, 0, 1, []),
	(32, mtef_visitor_source, af_override_horse, 0, 1, []),
	(33, mtef_visitor_source, 0, 0, 1, []),
	(34, mtef_visitor_source, 0, 0, 1, []),
	(35, mtef_visitor_source, 0, 0, 1, []),
	(36, mtef_visitor_source, 0, 0, 1, []),
	(37, mtef_visitor_source, af_override_horse, 0, 1, []),
	(38, mtef_visitor_source, af_override_horse, 0, 1, []),
	(39, mtef_visitor_source, af_override_horse, 0, 1, []),
	(40, mtef_visitor_source, af_override_horse, 0, 1, []),
	(41, mtef_visitor_source, 0, 0, 1, []),
	(42, mtef_visitor_source, af_override_horse, 0, 1, []),
	(43, mtef_visitor_source, af_override_horse, 0, 1, []),
	(44, mtef_visitor_source, af_override_horse, 0, 1, []),
	(45, mtef_visitor_source, af_override_horse, 0, 1, []),
	(46, mtef_visitor_source, af_override_horse, 0, 1, []),
	(47, mtef_visitor_source, af_override_horse, 0, 1, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_scene_replace_trig")
		]),

		(-20.0, 0.0, ti_once,
		[
			(store_current_scene, ":current_scene"),
			(this_or_next|eq, ":current_scene", "scn_molda_siege_mission_urt"),
			(eq, ":current_scene", "scn_8_vill_urt")
		],

		[
			(set_show_messages, 0),
			(entry_point_get_position, 1, 32),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 33),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 34),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 35),
			(set_spawn_position, 1),
			(spawn_horse, 154, 0),
			(entry_point_get_position, 1, 36),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 37),
			(set_spawn_position, 1),
			(spawn_horse, 154, 0),
			(entry_point_get_position, 1, 38),
			(set_spawn_position, 1),
			(spawn_horse, 155, 0),
			(entry_point_get_position, 1, 39),
			(set_spawn_position, 1),
			(spawn_horse, 156, 0),
			(entry_point_get_position, 1, 51),
			(set_spawn_position, 1),
			(spawn_horse, 157, 0),
			(entry_point_get_position, 1, 52),
			(set_spawn_position, 1),
			(spawn_horse, 156, 0),
			(entry_point_get_position, 1, 53),
			(set_spawn_position, 1),
			(spawn_horse, 157, 0),
			(entry_point_get_position, 1, 54),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 55),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 56),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 57),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 58),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 59),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 60),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 61),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 62),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 63),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 64),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 65),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 66),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 67),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 68),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 69),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 70),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 71),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 72),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 73),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 74),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 75),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 76),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 77),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 78),
			(set_spawn_position, 1),
			(spawn_horse, 152, 0),
			(entry_point_get_position, 1, 79),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(entry_point_get_position, 1, 80),
			(set_spawn_position, 1),
			(spawn_horse, 153, 0),
			(set_show_messages, 1)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, 0.0,
		[
			(key_clicked, 1)
		],

		[
			(display_message, "str_escape_alarm", 0x00ffff00)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, 0)
		]),

		(1.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_init_town_walker_agents")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_change_banners_and_chest")
		]),

		(3.0, 0.0, 0.0,
		[
			(call_script, "script_tick_town_walkers")
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(call_script, "script_center_ambiance_sounds")
		],

		[]),

		(-21.0, 0.0, 0.0,
		[
			(try_begin),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(party_slot_eq, "$g_encountered_party", 15, 4),
				(assign, "$wm_quest_mission_anti_skip_menu", 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(else_try),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit"),
			(try_end)
		],

		[]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("tavern_mission", 0, -1,
	"Default town visit",
	[(0, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood, itm_pilgrim_disguise, itm_quarter_staff]),
	(1, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(5, mtef_visitor_source, af_override_horse, 0, 1, []),
	(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(8, mtef_scene_source, af_override_horse, 0, 1, []),
	(9, mtef_visitor_source, af_override_horse, 0, 1, []),
	(10, mtef_scene_source, af_override_horse, 0, 1, []),
	(11, mtef_visitor_source, af_override_horse, 0, 1, []),
	(12, mtef_scene_source, af_override_horse, 0, 1, []),
	(13, mtef_scene_source, 0, 0, 1, []),
	(14, mtef_scene_source, 0, 0, 1, []),
	(15, mtef_scene_source, 0, 0, 1, []),
	(16, mtef_visitor_source, af_override_horse, 0, 1, []),
	(17, mtef_visitor_source, af_override_horse, 0, 1, []),
	(18, mtef_visitor_source, af_override_horse, 0, 1, []),
	(19, mtef_visitor_source, af_override_horse, 0, 1, []),
	(20, mtef_visitor_source, af_override_horse, 0, 1, []),
	(21, mtef_visitor_source, af_override_horse, 0, 1, []),
	(22, mtef_visitor_source, af_override_horse, 0, 1, []),
	(23, mtef_visitor_source, af_override_horse, 0, 1, []),
	(24, mtef_visitor_source, af_override_horse, 0, 1, []),
	(25, mtef_visitor_source, af_override_horse, 0, 1, []),
	(26, mtef_visitor_source, af_override_horse, 0, 1, []),
	(27, mtef_visitor_source, af_override_horse, 0, 1, []),
	(28, mtef_visitor_source, af_override_horse, 0, 1, []),
	(29, mtef_visitor_source, af_override_horse, 0, 1, []),
	(30, mtef_visitor_source, af_override_horse, 0, 1, []),
	(31, mtef_visitor_source, af_override_horse, 0, 1, [])],
	[
		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$sex_cam_on", 1),
			(eq, "$deathcam_on", 0)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_watching_mode", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, 0)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(eq, "$main_q_step", 76),
				(eq, ":troop_id_trigger_param_1", "trp_ww_a_5_2"),
				(call_script, "script_adv_exp_diff", 150, 87),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_change_banners_and_chest")
		]),

		(-21.0, 0.0, 0.0,
		[
			(try_begin),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(party_slot_eq, "$g_encountered_party", 15, 1),
				(assign, "$wm_quest_mission_anti_skip_menu", 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(else_try),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit"),
			(try_end)
		],

		[]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$main_q_step", 76),
			(le, "$main_q_day", 0),
			(party_slot_eq, "$g_encountered_party", slot_town_claimed_by_player, 6)
		],

		[
			(mission_disable_talk),
			(add_visitors_to_current_scene, 11, "trp_ww_a_5_2", 3),
			(team_set_relation, 0, 1, -1),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_position, 1, ":player_agent_no"),
			(position_move_x, 1, -110),
			(set_spawn_position, 1),
			(spawn_agent, "trp_ww_a_5_2"),
			(assign, ":value", reg0),
			(agent_set_team, ":value", 1),
			(agent_ai_set_aggressiveness, ":value", 199),
			(agent_set_is_alarmed, ":value", 1),
			(agent_get_position, 1, ":player_agent_no"),
			(position_move_x, 1, 110),
			(set_spawn_position, 1),
			(spawn_agent, "trp_ww_a_5_2"),
			(assign, ":value", reg0),
			(agent_set_team, ":value", 1),
			(agent_ai_set_aggressiveness, ":value", 199),
			(agent_set_is_alarmed, ":value", 1),
			(try_for_agents, ":value"),
				(agent_get_troop_id, ":troop_id_value", ":value"),
				(try_begin),
					(neq, ":troop_id_value", "trp_ww_a_5_2"),
					(agent_set_team, ":value", 0),
					(agent_set_is_alarmed, ":value", 1),
				(try_end),
			(try_end),
			(assign, "$main_q_day", 60)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("rescue_mission", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(6, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(7, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(8, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(9, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(10, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(11, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(12, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(13, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(14, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(15, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
	(16, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
	(17, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 1, 1),
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 0, 3, 1),
			(team_set_relation, 1, 2, 1),
			(team_set_relation, 1, 3, 1),
			(team_set_relation, 2, 3, 1)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 1.0, ti_once,
		[
			(eq, "$adult_content", 1)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_walker_f"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 2, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_female"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_kidnapper_rape"),
					(call_script, "script_molda_body_hand_for_man", "trp_kidnapper_rape", ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_male"),
				(try_end),
			(try_end)
		]),

		(0.0, 16.0, ti_once,
		[],

		[
			(team_set_relation, 0, 1, -1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(15.0, 15.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_set_is_alarmed, ":var_1", 1),
			(try_end)
		]),

		(2.0, 5.0, ti_once,
		[
			(this_or_next|main_hero_fallen),
			(num_active_teams_le, 1)
		],

		[
			(try_begin),
				(main_hero_fallen),
				(assign, "$wm_quest_result", 2),
			(else_try),
				(assign, "$wm_quest_result", 1),
			(try_end),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("raid_bandits_hideout", mtf_battle_mode|mtf_synch_inventory, 8,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(6, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(7, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(8, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(9, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(10, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, []),
	(18, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 20, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(0.0, 0.0, 10.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_set_is_alarmed, ":var_1", 1),
			(try_end)
		]),

		(2.0, 5.0, ti_once,
		[
			(this_or_next|main_hero_fallen),
			(num_active_teams_le, 1)
		],

		[
			(try_begin),
				(main_hero_fallen),
				(assign, "$wm_quest_result", 2),
			(else_try),
				(assign, "$wm_quest_result", 1),
			(try_end),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("bandit_leader_hideout", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, 0)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(team_set_relation, 0, 2, -1),
			(try_end),
			(try_begin),
				(eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(team_set_relation, 0, 3, -1),
			(try_end),
			(try_begin),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(dialog_box, "str_bandit_leader_comm", "str_box_say"),
				(team_set_relation, 0, 4, -1),
			(try_end)
		]),

		(0.0, 0.0, 10.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_set_is_alarmed, ":var_1", 1),
			(try_end)
		]),

		(2.0, 5.0, ti_once,
		[
			(this_or_next|main_hero_fallen),
			(num_active_teams_le, 1)
		],

		[
			(try_begin),
				(main_hero_fallen),
				(assign, "$wm_quest_result", 2),
			(else_try),
				(assign, "$wm_quest_result", 1),
			(try_end),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("rescue_lady", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, -1),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, 0),
			(scene_set_day_time, 23)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(try_begin),
				(eq, "$g_encountered_party", "p_ruin_dummy_5"),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
			(else_try),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		],

		[]),

		(1.0, 0.0, 0.0,
		[],

		[
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_position, 31, ":player_agent_no"),
			(assign, ":value", 0),
			(try_for_agents, ":value_2"),
				(agent_is_alive, ":value_2"),
				(agent_get_troop_id, ":troop_id_value_2", ":value_2"),
				(neq, ":value_2", ":player_agent_no"),
				(neg|is_between, ":troop_id_value_2", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(agent_get_position, 33, ":value_2"),
				(get_distance_between_positions, ":distance_between_positions_31_33", 31, 33),
				(agent_get_team, ":team_value_2", ":value_2"),
				(neq, ":team_value_2", 4),
				(try_begin),
					(lt, ":distance_between_positions_31_33", 500),
					(agent_set_team, ":value_2", 4),
					(agent_set_is_alarmed, ":value_2", 1),
					(assign, ":value", 1),
					(store_random_in_range, ":random_in_range_enemy_alert_01_enemy_alert_end", "str_enemy_alert_01", "str_enemy_alert_end"),
					(display_message, ":random_in_range_enemy_alert_01_enemy_alert_end", 0x00ff0000),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(try_for_agents, ":value_2"),
					(agent_is_alive, ":value_2"),
					(agent_get_troop_id, ":troop_id_value_2", ":value_2"),
					(neq, ":value_2", ":player_agent_no"),
					(is_between, ":troop_id_value_2", "trp_tt_lady_01_01", "trp_tt_lady_end"),
					(agent_get_position, 33, ":value_2"),
					(get_distance_between_positions, ":distance_between_positions_31_33", 31, 33),
					(try_begin),
						(lt, ":distance_between_positions_31_33", 100),
						(assign, "$molda_start_map_conversation", ":troop_id_value_2"),
						(assign, "$wm_talk_state", 19),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_molda_map_talk"),
					(try_end),
				(try_end),
			(try_end)
		]),

		(2.0, 5.0, ti_once,
		[
			(main_hero_fallen)
		],

		[
			(try_begin),
				(eq, "$g_encountered_party", "p_ruin_dummy_5"),
				(main_hero_fallen),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
			(else_try),
				(main_hero_fallen),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("kill_druken_thug", mtf_battle_mode, -1,
	"Default town visit",
	[(0, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(1, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(5, mtef_visitor_source, af_override_horse, 0, 1, []),
	(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(8, mtef_scene_source, af_override_horse, 0, 1, []),
	(9, mtef_visitor_source, af_override_horse, 0, 1, []),
	(10, mtef_scene_source, af_override_horse, 0, 1, []),
	(11, mtef_visitor_source, af_override_horse, 0, 1, []),
	(12, mtef_scene_source, af_override_horse, 0, 1, []),
	(13, mtef_scene_source, 0, 0, 1, []),
	(14, mtef_scene_source, 0, 0, 1, []),
	(15, mtef_scene_source, 0, 0, 1, []),
	(16, mtef_visitor_source, af_override_horse, 0, 1, []),
	(17, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(18, mtef_visitor_source, af_override_horse, 0, 1, []),
	(19, mtef_visitor_source, af_override_horse, 0, 1, []),
	(20, mtef_visitor_source, af_override_horse, 0, 1, []),
	(21, mtef_visitor_source, af_override_horse, 0, 1, []),
	(22, mtef_visitor_source, af_override_horse, 0, 1, []),
	(23, mtef_visitor_source, af_override_horse, 0, 1, []),
	(24, mtef_visitor_source, af_override_horse, 0, 1, []),
	(25, mtef_visitor_source, af_override_horse, 0, 1, []),
	(26, mtef_visitor_source, af_override_horse, 0, 1, []),
	(27, mtef_visitor_source, af_override_horse, 0, 1, []),
	(28, mtef_visitor_source, af_override_horse, 0, 1, []),
	(29, mtef_visitor_source, af_override_horse, 0, 1, []),
	(30, mtef_visitor_source, af_override_horse, 0, 1, []),
	(31, mtef_visitor_source, af_override_horse, 0, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$sex_cam_on", 1),
			(eq, "$deathcam_on", 0)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_watching_mode", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 1, 0)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(dialog_box, "str_drunken_1", "str_box_note"),
			(try_for_agents, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(call_script, "script_troop_type_sett", ":troop_id_var_1"),
				(try_begin),
					(gt, ":troop_id_var_1", 1),
					(gt, "$troop_gender_type", 10),
					(try_begin),
						(eq, "$adult_content", 1),
						(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 2, ":var_1"),
					(try_end),
					(agent_play_sound, ":var_1", "snd_cryyy_female"),
					(store_random_in_range, ":random_in_range_1_5", 1, 5),
					(try_begin),
						(eq, ":random_in_range_1_5", 1),
						(agent_set_stand_animation, ":var_1", "anim_dancer_1"),
					(else_try),
						(eq, ":random_in_range_1_5", 2),
						(agent_set_stand_animation, ":var_1", "anim_dancer_2"),
					(else_try),
						(eq, ":random_in_range_1_5", 3),
						(agent_set_stand_animation, ":var_1", "anim_dancer_3"),
					(else_try),
						(eq, ":random_in_range_1_5", 4),
						(agent_set_stand_animation, ":var_1", "anim_dancer_4"),
					(try_end),
				(try_end),
			(try_end)
		]),

		(0.0, 5.0, ti_once,
		[],

		[
			(display_message, "str_drunken_2", 0x00ffff00)
		]),

		(0.0, 9.0, ti_once,
		[],

		[
			(display_message, "str_drunken_3", 0x0000ff00)
		]),

		(0.0, 15.0, ti_once,
		[],

		[
			(display_message, "str_drunken_4", 0x00ffff00),
			(set_party_battle_mode),
			(try_for_agents, ":value"),
				(agent_get_troop_id, ":troop_id_value", ":value"),
				(eq, ":troop_id_value", "trp_raid_bandit_brigand"),
				(agent_set_team, ":value", 1),
				(agent_ai_set_aggressiveness, ":value", 199),
			(try_end),
			(team_set_relation, 0, 1, -1),
			(try_for_agents, ":value"),
				(agent_is_alive, ":value"),
				(agent_is_human, ":value"),
				(agent_set_is_alarmed, ":value", 1),
			(try_end)
		]),

		(2.0, 5.0, ti_once,
		[
			(assign, ":var_1", 0),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(eq, ":troop_id_var_2", "trp_raid_bandit_brigand"),
				(val_add, ":var_1", 1),
			(try_end),
			(this_or_next|le, ":var_1", 0),
			(main_hero_fallen)
		],

		[
			(try_begin),
				(main_hero_fallen),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(else_try),
				(assign, "$wm_quest_result", 1),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("protect_family", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(team_set_relation, 0, 1, 1),
			(team_set_relation, 0, 2, -1),
			(team_set_relation, 1, 2, -1)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 5.0, ti_once,
		[],

		[
			(display_message, "str_def_fam_1", 0x0000ff00)
		]),

		(0.0, 10.0, ti_once,
		[],

		[
			(display_message, "str_def_fam_2", 0x00ffff00)
		]),

		(0.0, 15.0, ti_once,
		[],

		[
			(display_message, "str_def_fam_3", 0x0000ff00),
			(add_visitors_to_current_scene, 10, "trp_raid_bandit_looter", 1, 2, 1),
			(add_visitors_to_current_scene, 11, "trp_raid_bandit_looter", 1, 2, 1),
			(add_visitors_to_current_scene, 12, "trp_raid_bandit_looter", 1, 2, 1)
		]),

		(0.0, 30.0, ti_once,
		[],

		[
			(add_visitors_to_current_scene, 10, "trp_raid_bandit_looter", 1, 2, 1),
			(add_visitors_to_current_scene, 11, "trp_raid_bandit_brigand", 1, 2, 1),
			(add_visitors_to_current_scene, 12, "trp_raid_bandit_looter", 1, 2, 1)
		]),

		(0.0, 45.0, ti_once,
		[],

		[
			(display_message, "str_def_fam_4", 0x00ff0000),
			(add_visitors_to_current_scene, 10, "trp_raid_bandit_brigand", 1, 2, 1),
			(add_visitors_to_current_scene, 11, "trp_raid_bandit_boss", 1, 2, 1),
			(add_visitors_to_current_scene, 12, "trp_raid_bandit_brigand", 1, 2, 1)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neg|main_hero_fallen),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(assign, "$wm_quest_result", 1),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(2.0, 4.0, ti_once,
		[
			(assign, ":var_1", 0),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(this_or_next|eq, ":troop_id_var_2", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_var_2", "trp_protect_family_2"),
				(this_or_next|eq, ":troop_id_var_2", "trp_protect_family_3"),
				(eq, ":troop_id_var_2", "trp_protect_family_4"),
				(val_add, ":var_1", 1),
			(try_end),
			(this_or_next|le, ":var_1", 1),
			(main_hero_fallen)
		],

		[
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("farm_defence", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_horse, aif_start_alarmed, 1, [itm_hunting_bow, itm_arrows, itm_arrows, itm_arrows]),
	(1, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, -1),
			(assign, "$temp_num_01", 0),
			(scene_set_day_time, 13)
		]),

		(-21.0, 0.0, 0.0,
		[
			(question_box, "str_give_up_fight")
		],

		[]),

		(-8.0, 0.0, 0.0,
		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		],

		[]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(agent_set_hit_points, ":trigger_param_1", 2, 1),
			(try_end),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(2.0, 0.0, 0.0,
		[],

		[
			(get_player_agent_no, ":player_agent_no"),
			(entry_point_get_position, 32, 50),
			(entry_point_get_position, 31, 51),
			(try_for_agents, ":value"),
				(agent_is_alive, ":value"),
				(neg|agent_is_human, ":value"),
				(neq, ":value", ":player_agent_no"),
				(agent_get_position, 33, ":value"),
				(get_distance_between_positions, ":distance_between_positions_32_33", 32, 33),
				(try_begin),
					(lt, ":distance_between_positions_32_33", 350),
					(set_show_messages, 0),
					(agent_set_visibility, ":value", 0),
					(agent_set_hit_points, ":value", 0, 0),
					(agent_deliver_damage_to_agent, ":value", ":value", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(try_for_agents, ":value"),
				(agent_is_human, ":value"),
				(agent_is_alive, ":value"),
				(neq, ":value", ":player_agent_no"),
				(agent_get_troop_id, ":troop_id_value", ":value"),
				(try_begin),
					(this_or_next|eq, ":troop_id_value", "trp_raid_bandit_boss"),
					(eq, ":troop_id_value", "trp_raid_bandit_boss_mounted"),
					(agent_set_scripted_destination_no_attack, ":value", 31, 0),
				(try_end),
				(neq, ":troop_id_value", "trp_raid_bandit_boss"),
				(neq, ":troop_id_value", "trp_raid_bandit_boss_mounted"),
				(agent_set_scripted_destination_no_attack, ":value", 32, 0),
				(agent_get_position, 33, ":value"),
				(get_distance_between_positions, ":distance_between_positions_32_33", 32, 33),
				(try_begin),
					(lt, ":distance_between_positions_32_33", 150),
					(val_add, "$temp_num_01", 1),
					(presentation_set_duration, 0),
					(start_presentation, "prsnt_mini_map"),
					(play_sound, "snd_bad_drum"),
					(assign, reg8, "$temp_num_01"),
					(display_message, "str_farm_def_count", 0x00ff0000),
					(set_show_messages, 0),
					(agent_set_visibility, ":value", 0),
					(agent_set_hit_points, ":value", 0, 0),
					(agent_deliver_damage_to_agent, ":value", ":value", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(try_begin),
				(ge, "$temp_num_01", 5),
				(assign, "$wm_quest_result", 2),
				(play_sound, "snd_bad_drum"),
				(display_message, "str_farm_def_fail", 0x00ff0000),
			(try_end)
		]),

		(10.0, 0.0, 0.0,
		[],

		[
			(get_player_agent_no, ":player_agent_no"),
			(agent_set_ammo, ":player_agent_no", 197, 100),
			(assign, reg8, "$temp_num_01"),
			(display_message, "str_farm_def_count", 0x00ffff00)
		]),

		(0.0, 4.0, 0.0,
		[
			(eq, "$wm_quest_result", 2)
		],

		[
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(5.0, 0.0, 0.0,
		[],

		[
			(store_random_in_range, ":random_in_range_1_8", 1, 8),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, ":random_in_range_0_5", 0),
				(add_visitors_to_current_scene, ":random_in_range_1_8", "trp_raid_bandit_looter_mounted", 1, 2, 1),
			(else_try),
				(add_visitors_to_current_scene, ":random_in_range_1_8", "trp_raid_bandit_looter", 1, 2, 1),
			(try_end)
		]),

		(0.0, 100.0, ti_once,
		[],

		[
			(display_message, "str_def_fam_arc", 0x00ff0000),
			(store_random_in_range, ":random_in_range_1_8", 1, 8),
			(store_random_in_range, ":random_in_range_0_3", 0, 3),
			(try_begin),
				(eq, ":random_in_range_0_3", 0),
				(add_visitors_to_current_scene, ":random_in_range_1_8", "trp_raid_bandit_boss_mounted", 1, 2, 1),
			(else_try),
				(add_visitors_to_current_scene, ":random_in_range_1_8", "trp_raid_bandit_boss", 1, 2, 1),
			(try_end),
			(dialog_box, "str_farm_def_leader", "str_box_note")
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(assign, "$wm_quest_result", 1),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("farm_defence_hardmode", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_horse, aif_start_alarmed, 1, [itm_hunting_bow, itm_arrows, itm_arrows, itm_arrows]),
	(1, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, -1),
			(assign, "$temp_num_01", 2),
			(scene_set_day_time, 13)
		]),

		(-21.0, 0.0, 0.0,
		[
			(question_box, "str_give_up_fight")
		],

		[]),

		(-8.0, 0.0, 0.0,
		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		],

		[]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(agent_set_hit_points, ":trigger_param_1", 2, 1),
			(try_end),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(2.0, 0.0, 0.0,
		[],

		[
			(get_player_agent_no, ":player_agent_no"),
			(entry_point_get_position, 32, 50),
			(entry_point_get_position, 31, 51),
			(try_for_agents, ":value"),
				(agent_is_alive, ":value"),
				(neg|agent_is_human, ":value"),
				(neq, ":value", ":player_agent_no"),
				(agent_get_position, 33, ":value"),
				(get_distance_between_positions, ":distance_between_positions_32_33", 32, 33),
				(try_begin),
					(lt, ":distance_between_positions_32_33", 350),
					(set_show_messages, 0),
					(agent_set_visibility, ":value", 0),
					(agent_set_hit_points, ":value", 0, 0),
					(agent_deliver_damage_to_agent, ":value", ":value", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(try_for_agents, ":value"),
				(agent_is_human, ":value"),
				(agent_is_alive, ":value"),
				(neq, ":value", ":player_agent_no"),
				(agent_get_troop_id, ":troop_id_value", ":value"),
				(try_begin),
					(this_or_next|eq, ":troop_id_value", "trp_raid_bandit_boss"),
					(eq, ":troop_id_value", "trp_raid_bandit_boss_mounted"),
					(agent_set_scripted_destination_no_attack, ":value", 31, 0),
				(try_end),
				(neq, ":troop_id_value", "trp_raid_bandit_boss"),
				(neq, ":troop_id_value", "trp_raid_bandit_boss_mounted"),
				(agent_set_scripted_destination_no_attack, ":value", 32, 0),
				(agent_get_position, 33, ":value"),
				(get_distance_between_positions, ":distance_between_positions_32_33", 32, 33),
				(try_begin),
					(lt, ":distance_between_positions_32_33", 150),
					(val_add, "$temp_num_01", 1),
					(presentation_set_duration, 0),
					(start_presentation, "prsnt_mini_map"),
					(play_sound, "snd_bad_drum"),
					(assign, reg8, "$temp_num_01"),
					(display_message, "str_farm_def_count", 0x00ff0000),
					(set_show_messages, 0),
					(agent_set_visibility, ":value", 0),
					(agent_set_hit_points, ":value", 0, 0),
					(agent_deliver_damage_to_agent, ":value", ":value", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end),
			(try_begin),
				(ge, "$temp_num_01", 5),
				(assign, "$wm_quest_result", 2),
				(play_sound, "snd_bad_drum"),
				(display_message, "str_farm_def_fail", 0x00ff0000),
			(try_end)
		]),

		(10.0, 0.0, 0.0,
		[],

		[
			(get_player_agent_no, ":player_agent_no"),
			(agent_set_ammo, ":player_agent_no", 197, 100),
			(assign, reg8, "$temp_num_01"),
			(display_message, "str_farm_def_count", 0x00ffff00)
		]),

		(0.0, 4.0, 0.0,
		[
			(eq, "$wm_quest_result", 2)
		],

		[
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(store_random_in_range, ":random_in_range_1_8", 1, 8),
			(store_random_in_range, ":random_in_range_0_3", 0, 3),
			(try_begin),
				(eq, ":random_in_range_0_3", 0),
				(add_visitors_to_current_scene, ":random_in_range_1_8", "trp_raid_bandit_looter_mounted", 1, 2, 1),
			(else_try),
				(add_visitors_to_current_scene, ":random_in_range_1_8", "trp_raid_bandit_looter", 1, 2, 1),
			(try_end)
		]),

		(0.0, 100.0, ti_once,
		[],

		[
			(display_message, "str_def_fam_arc", 0x00ff0000),
			(store_random_in_range, ":random_in_range_1_8", 1, 8),
			(try_begin),
				(add_visitors_to_current_scene, ":random_in_range_1_8", "trp_raid_bandit_boss", 1, 2, 1),
			(try_end),
			(dialog_box, "str_farm_def_leader", "str_box_note")
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(assign, "$wm_quest_result", 1),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("insult_woman", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 1, 2, 0)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[
			(display_message, "str_prison_infil", 0x00ff0000)
		]),

		(0.0, 1.0, ti_once,
		[
			(num_active_teams_le, 2),
			(neg|main_hero_fallen)
		],

		[
			(mission_enable_talk)
		]),

		(2.0, 5.0, 0.0,
		[
			(main_hero_fallen)
		],

		[
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("beat_lady", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_everything, aif_start_alarmed, 1, [itm_pilgrim_disguise, itm_pilgrim_hood]),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, -1),
			(team_set_relation, 1, 2, 0)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[
			(display_message, "str_nobel_infil", 0x00ff0000)
		]),

		(2.0, 2.0, 0.0,
		[
			(num_active_teams_le, 1),
			(neg|main_hero_fallen)
		],

		[
			(play_sound, "snd_quest_succeeded"),
			(display_message, "str_questsucc", 0x00ffff00),
			(assign, "$qquest_progress", 1),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_for_quest_villa")
		]),

		(2.0, 5.0, 0.0,
		[
			(main_hero_fallen)
		],

		[
			(play_sound, "snd_bad_drum"),
			(display_message, "str_questfail", 0x00ffff00),
			(assign, "$qquest_progress", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_for_quest_villa")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("nofight_noble_villa", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
	(1, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(2, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, 0, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, 0, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, 0, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, 0, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, 0, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, 0, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, 0, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, 0, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, 0, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, 0, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, 0, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, 0, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, 0, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, 0, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, 0, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, 0, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, 0, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, 0, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, 0, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, 0, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, 0, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, 0, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, 0, 1, [])],
	[
		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(play_track, "track_love_scene", 2)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 1, 2, 0)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		],

		[]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("family_exterminate", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(team_set_relation, 0, 1, 1),
			(team_set_relation, 0, 2, -1),
			(team_set_relation, 1, 2, -1)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 2.0, ti_once,
		[],

		[
			(display_message, "str_def_dungeon_1", 0x0000ff00),
			(add_visitors_to_current_scene, 11, "trp_raid_bandit_looter", 1, 2, 1),
			(add_visitors_to_current_scene, 12, "trp_raid_bandit_looter", 1, 2, 1)
		]),

		(0.0, 15.0, ti_once,
		[],

		[
			(display_message, "str_def_dungeon_2", 0x00ff0000),
			(add_visitors_to_current_scene, 11, "trp_raid_bandit_boss", 1, 2, 1)
		]),

		(2.0, 5.0, 0.0,
		[],

		[
			(assign, ":var_1", 0),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(this_or_next|eq, ":troop_id_var_2", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_var_2", "trp_protect_family_2"),
				(this_or_next|eq, ":troop_id_var_2", "trp_protect_family_3"),
				(eq, ":troop_id_var_2", "trp_protect_family_4"),
				(val_add, ":var_1", 1),
			(try_end),
			(try_begin),
				(le, ":var_1", 0),
				(assign, "$wm_quest_result", 1),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(2.0, 5.0, ti_once,
		[
			(main_hero_fallen)
		],

		[
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("defence_bandit_hideout", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, [])],
	[
		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, -1),
			(team_set_relation, 1, 2, 1)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 1.0, ti_once,
		[],

		[
			(store_character_level, ":character_level_player", "trp_player"),
			(val_add, ":character_level_player", 20),
			(val_div, ":character_level_player", 4),
			(call_script, "script_wm_troop_type_depend_train", "$g_encountered_party", 0),
			(add_visitors_to_current_scene, 0, "$temp_party_troop_02", ":character_level_player", 0, 1),
			(add_visitors_to_current_scene, 0, "$temp_party_troop_03", ":character_level_player", 0, 1)
		]),

		(2.0, 5.0, ti_once,
		[],

		[
			(assign, ":var_1", 0),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(this_or_next|eq, ":troop_id_var_2", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_var_2", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_var_2", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_var_2", "trp_raid_bandit_brigand"),
				(eq, ":troop_id_var_2", "trp_raid_bandit_boss"),
				(val_add, ":var_1", 1),
			(try_end),
			(try_begin),
				(le, ":var_1", 0),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(2.0, 4.0, ti_once,
		[
			(num_active_teams_le, 1),
			(neg|main_hero_fallen)
		],

		[
			(assign, "$wm_quest_result", 1),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(2.0, 4.0, ti_once,
		[
			(main_hero_fallen)
		],

		[
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("raid_rebel_fort", mtf_battle_mode|mtf_synch_inventory, 8,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(1, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(6, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(7, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(8, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(9, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(10, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(11, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_troop_party_true_count_spawn", 1),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(question_box, "str_do_you_want_to_retreat")
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
			(call_script, "script_moral_level_diff", "p_main_party", -15),
			(call_script, "script_wm_count_army_damage_after_battle"),
			(try_begin),
				(eq, "$g_encountered_party", "p_ruin_dummy_5"),
				(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(else_try),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 3, 0)
		]),

		(5.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(try_begin),
					(eq, ":team_var_1", 0),
					(agent_ai_set_always_attack_in_melee, ":var_1", 1),
				(try_end),
			(try_end)
		]),

		(2.0, 4.0, ti_once,
		[
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(try_for_agents, ":var_3"),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(try_begin),
					(eq, ":team_var_3", 0),
					(val_add, ":var_1", 1),
				(else_try),
					(val_add, ":var_2", 1),
				(try_end),
			(try_end),
			(this_or_next|le, ":var_2", 0),
			(le, ":var_1", 0)
		],

		[
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(try_for_agents, ":var_3"),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(try_begin),
					(eq, ":team_var_3", 0),
					(val_add, ":var_1", 1),
				(else_try),
					(val_add, ":var_2", 1),
				(try_end),
			(try_end),
			(try_begin),
				(eq, "$g_encountered_party", "p_ruin_dummy_5"),
				(try_begin),
					(le, ":var_2", 0),
					(call_script, "script_moral_level_diff", "p_main_party", 15),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(val_add, "$main_q_step", 1),
					(call_script, "script_adv_exp_diff", 250, 87),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(le, ":var_1", 0),
					(call_script, "script_moral_level_diff", "p_main_party", -25),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(try_end),
			(else_try),
				(try_begin),
					(le, ":var_2", 0),
					(call_script, "script_moral_level_diff", "p_main_party", 15),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(assign, "$wm_quest_result", 1),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
				(else_try),
					(le, ":var_1", 0),
					(call_script, "script_moral_level_diff", "p_main_party", -25),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(assign, "$wm_quest_result", 2),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
				(try_end),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("subdue_nomad", mtf_battle_mode|mtf_synch_inventory, 8,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(2, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(3, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(4, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(5, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(10, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(11, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, [])],
	[
		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 1)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_troop_party_true_count_spawn", 1),
			(call_script, "script_bt_missin_add_spawn")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_ex_npc_054"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(question_box, "str_do_you_want_to_retreat")
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
			(call_script, "script_moral_level_diff", "p_main_party", -15),
			(call_script, "script_wm_count_army_damage_after_battle"),
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 3, 0)
		]),

		(2.0, 4.0, ti_once,
		[
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(try_for_agents, ":var_3"),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(try_begin),
					(eq, ":team_var_3", 0),
					(val_add, ":var_1", 1),
				(else_try),
					(val_add, ":var_2", 1),
				(try_end),
			(try_end),
			(this_or_next|le, ":var_2", 0),
			(le, ":var_1", 0)
		],

		[
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(try_for_agents, ":var_3"),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(try_begin),
					(eq, ":team_var_3", 0),
					(val_add, ":var_1", 1),
				(else_try),
					(val_add, ":var_2", 1),
				(try_end),
			(try_end),
			(try_begin),
				(le, ":var_2", 0),
				(call_script, "script_moral_level_diff", "p_main_party", 15),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(assign, "$wm_quest_result", 1),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(else_try),
				(le, ":var_1", 0),
				(call_script, "script_moral_level_diff", "p_main_party", -25),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("camp_assassination", mtf_battle_mode, -1,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(scene_set_day_time, 23),
			(mission_disable_talk),
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 1, 2, 0)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 1.0, ti_once,
		[],

		[
			(display_message, "str_assassin_1", 0x00ff0000)
		]),

		(2.0, 4.0, ti_once,
		[
			(num_active_teams_le, 1),
			(neg|main_hero_fallen)
		],

		[
			(display_message, "str_assassin_2", 0x00ffff00),
			(try_begin),
				(this_or_next|eq, "$main_q_step", 39),
				(eq, "$main_q_step", 34),
				(val_add, "$main_q_step", 1),
				(call_script, "script_adv_exp_diff", 500, 87),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(else_try),
				(gt, "$molda_start_map_conversation", 0),
				(assign, "$wm_talk_state", 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_molda_map_talk"),
			(else_try),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neg|main_hero_fallen),
				(eq, ":troop_id_trigger_param_1", "trp_npc14"),
				(assign, "$molda_start_map_conversation", "trp_npc14"),
			(try_end),
			(try_begin),
				(neg|main_hero_fallen),
				(eq, ":troop_id_trigger_param_1", "trp_tt_lady_ex_12"),
				(assign, "$molda_start_map_conversation", "trp_tt_lady_ex_12"),
			(try_end)
		]),

		(2.0, 4.0, 0.0,
		[
			(main_hero_fallen)
		],

		[
			(assign, "$molda_start_map_conversation", -1),
			(try_begin),
				(this_or_next|eq, "$main_q_step", 39),
				(eq, "$main_q_step", 34),
				(val_add, "$main_q_step", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(else_try),
				(call_script, "script_wm_troop_wound_disease_slot", "trp_player", 3),
				(call_script, "script_party_money_level_set_percent", "p_main_party", 25),
				(display_message, "str_almost_died", 0x00ff0000),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("protect_caravan", mtf_battle_mode, 8,
	"Ambushing a bandit lair",
	[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(1, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(neq, ":team_player_agent_no", ":team_trigger_param_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(neq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(neq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(neq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master2"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master3"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master4"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master5"),
				(neq, ":troop_id_trigger_param_1", "trp_caravan_master6"),
				(store_character_level, ":character_level_player", "trp_player"),
				(val_add, ":character_level_player", 1),
				(try_begin),
					(lt, ":character_level_player", 8),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 12),
					(val_mul, ":character_level_player", 1),
				(else_try),
					(lt, ":character_level_player", 16),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 20),
					(val_mul, ":character_level_player", 2),
				(else_try),
					(lt, ":character_level_player", 24),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 28),
					(val_mul, ":character_level_player", 3),
				(else_try),
					(lt, ":character_level_player", 32),
					(val_mul, ":character_level_player", 4),
				(else_try),
					(lt, ":character_level_player", 36),
					(val_mul, ":character_level_player", 5),
				(else_try),
					(lt, ":character_level_player", 40),
					(val_mul, ":character_level_player", 6),
				(else_try),
					(val_mul, ":character_level_player", 7),
				(try_end),
				(store_add, ":value", 10, ":character_level_player"),
				(try_begin),
					(gt, ":value", 0),
					(agent_set_max_hit_points, ":trigger_param_1", ":value", 1),
					(agent_set_hit_points, ":trigger_param_1", ":value", 1),
				(try_end),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_private_guard"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss_mounted"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_2"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_man"),
				(call_script, "script_civil_outfit_sett_man", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nurse_for_lady"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_3"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_protect_family_4"),
				(eq, ":troop_id_trigger_param_1", "trp_noble_woman"),
				(call_script, "script_civil_outfit_sett_women", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(0.0, 1.0, ti_once,
		[
			(party_slot_eq, "$g_encountered_party", 15, 25)
		],

		[
			(display_message, "str_caravan_def1", 0x00ffff00),
			(add_visitors_to_current_scene, 1, "trp_raid_bandit_looter_mounted", 10),
			(add_visitors_to_current_scene, 1, "trp_raid_bandit_brigand_mounted", 6)
		]),

		(0.0, 1.0, ti_once,
		[
			(party_slot_eq, "$g_encountered_party", 15, 26)
		],

		[
			(add_visitors_to_current_scene, 1, "trp_raid_bandit_looter_mounted", 3),
			(add_visitors_to_current_scene, 1, "trp_raid_bandit_brigand_mounted", 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_caravan_master_setting", "$g_encountered_party"),
			(assign, ":var_1", reg0),
			(add_visitors_to_current_scene, 0, ":var_1", 10)
		]),

		(2.0, 5.0, ti_once,
		[
			(assign, ":var_1", 0),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_for_agents, ":var_4"),
				(agent_is_human, ":var_4"),
				(agent_is_alive, ":var_4"),
				(agent_get_team, ":team_var_4", ":var_4"),
				(try_begin),
					(neq, ":team_var_4", ":team_player_agent_no"),
					(val_add, ":var_1", 1),
				(try_end),
			(try_end),
			(le, ":var_1", 0)
		],

		[
			(assign, "$wm_quest_result", 1),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(2.0, 5.0, ti_once,
		[
			(main_hero_fallen)
		],

		[
			(assign, "$wm_quest_result", 2),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$eyecandy_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$eyecandy_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$eyecandy_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, 110),
				(set_spawn_position, 1),
				(spawn_agent, "$eyecandy_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("dungeon_fight", 0, 0,
	"You lead your men to battle.",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, 0, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, 0, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, 0, aif_start_alarmed, 1, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, 0)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$molda_dun_win", 1),
				(question_box, "str_dung_compl"),
			(else_try),
				(question_box, "str_do_you_want_to_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_ruin_menu")
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(store_current_scene, ":current_scene"),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_impaler"),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_qq_m_3"),
					(dialog_box, "str_ruin_impaler_2", "str_box_say"),
					(team_set_relation, 0, 2, -1),
				(try_end),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_qq_a_2"),
					(dialog_box, "str_ruin_impaler_3", "str_box_say"),
					(team_set_relation, 0, 3, -1),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_askia"),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_afri_2_m"),
					(team_set_relation, 0, 2, -1),
				(try_end),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_afri_3_m"),
					(team_set_relation, 0, 3, -1),
				(try_end),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_afri_4_m"),
					(team_set_relation, 0, 4, -1),
					(dialog_box, "str_ruin_askia_1", "str_box_say"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_tt_lord_34_01"),
					(assign, ":var_4", 898),
					(troop_add_item, "trp_player", ":var_4", 0),
					(play_sound, "snd_good_news_2"),
					(dialog_box, "str_ruin_askia_2", "str_box_say"),
					(assign, "$ruin_dun_askia_clear", 5),
					(assign, "$molda_dun_win", 1),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_shaver"),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_qq_m_3"),
					(dialog_box, "str_ruin_shaver_1", "str_box_say"),
					(team_set_relation, 0, 2, -1),
				(try_end),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_qq_m_4"),
					(dialog_box, "str_ruin_shaver_2", "str_box_say"),
					(team_set_relation, 0, 3, -1),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_shiva_blade"),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_jungle_3_m"),
					(dialog_box, "str_ruin_shiva_blade_1", "str_box_say"),
					(team_set_relation, 0, 2, -1),
				(try_end),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_jungle_4_m"),
					(dialog_box, "str_ruin_shiva_blade_2", "str_box_say"),
					(team_set_relation, 0, 3, -1),
				(try_end),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_jungle_5_m"),
					(dialog_box, "str_ruin_shiva_blade_3", "str_box_say"),
					(team_set_relation, 0, 4, -1),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_sun_blade"),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_ww_m_3"),
					(dialog_box, "str_ruin_sun_blade_1", "str_box_say"),
					(team_set_relation, 0, 2, -1),
				(try_end),
				(try_begin),
					(eq, ":troop_id_trigger_param_1", "trp_ww_m_4"),
					(dialog_box, "str_ruin_sun_blade_2", "str_box_say"),
					(team_set_relation, 0, 3, -1),
				(try_end),
			(try_end)
		]),

		(0.0, 2.0, ti_once,
		[
			(num_active_teams_le, 1),
			(neg|main_hero_fallen)
		],

		[
			(store_current_scene, ":current_scene"),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_impaler"),
				(assign, ":value", 988),
				(troop_add_item, "trp_player", ":value", 0),
				(play_sound, "snd_good_news_2"),
				(dialog_box, "str_ruin_impaler_1", "str_box_note"),
				(assign, "$ruin_dun_impaler_clear", 5),
				(assign, "$molda_dun_win", 1),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_shaver"),
				(assign, ":value", 927),
				(troop_add_item, "trp_player", ":value", 0),
				(play_sound, "snd_good_news_2"),
				(dialog_box, "str_ruin_shaver_3", "str_box_note"),
				(assign, "$ruin_dun_shaver_clear", 5),
				(assign, "$molda_dun_win", 1),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_shiva_blade"),
				(assign, ":value", 947),
				(troop_add_item, "trp_player", ":value", 0),
				(play_sound, "snd_good_news_2"),
				(dialog_box, "str_ruin_shiva_blade_4", "str_box_note"),
				(assign, "$ruin_dun_shiva_blade_clear", 5),
				(assign, "$molda_dun_win", 1),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_sun_blade"),
				(assign, ":value", 948),
				(troop_add_item, "trp_player", ":value", 0),
				(play_sound, "snd_good_news_2"),
				(dialog_box, "str_ruin_sun_blade_3", "str_box_note"),
				(assign, "$ruin_dun_sun_blade_clear", 5),
				(assign, "$molda_dun_win", 1),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_evil_spirits_armor"),
				(assign, ":value", 497),
				(troop_add_item, "trp_player", ":value", 0),
				(play_sound, "snd_good_news_2"),
				(dialog_box, "str_ruin_evil_spirits_armor_1", "str_box_note"),
				(assign, "$ruin_dun_Evil_spirits_armor_clear", 5),
				(assign, "$molda_dun_win", 1),
			(try_end),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_dracul_armor"),
				(assign, ":value", 990),
				(troop_add_item, "trp_player", ":value", 0),
				(play_sound, "snd_good_news_2"),
				(dialog_box, "str_ruin_dracul_armor_1", "str_box_note"),
				(assign, "$ruin_dun_dracul_armor_clear", 5),
				(assign, "$molda_dun_win", 1),
			(try_end)
		]),

		(0.0, 1.0, ti_once,
		[],

		[
			(store_current_scene, ":current_scene"),
			(try_begin),
				(eq, ":current_scene", "scn_ruin_dun_evil_spirits_armor"),
				(dialog_box, "str_ruin_evil_spirits_armor_0", "str_box_note"),
			(else_try),
				(eq, ":current_scene", "scn_ruin_dun_dracul_armor"),
				(dialog_box, "str_ruin_dracul_armor_0", "str_box_note"),
			(else_try),
				(dialog_box, "str_ruin_warning", "str_box_note"),
			(try_end)
		]),

		(1.0, 4.0, 0.0,
		[
			(main_hero_fallen)
		],

		[
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_ruin_menu")
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(gt, "$bodyguard_troop", 0),
				(call_script, "script_wm_main_party_has_troop_sc", "$bodyguard_troop"),
				(eq, "$wm_comp_continue", 1),
				(neg|party_slot_eq, "$g_encountered_party", 15, 30),
				(neg|party_slot_eq, "$g_encountered_party", 15, 5),
				(store_current_scene, ":current_scene"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(troop_equip_items, "$bodyguard_troop"),
				(agent_get_position, 1, ":player_agent_no"),
				(position_move_x, 1, -110),
				(set_spawn_position, 1),
				(spawn_agent, "$bodyguard_troop"),
				(assign, ":var_4", reg0),
				(agent_get_horse, ":horse_var_4", ":var_4"),
				(try_begin),
					(neq, ":current_scene", "scn_protect_caravan"),
					(gt, ":horse_var_4", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_4", 0),
					(agent_set_hit_points, ":horse_var_4", 0, 0),
					(agent_deliver_damage_to_agent, ":var_4", ":horse_var_4", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_team, ":var_4", ":team_player_agent_no"),
				(agent_set_division, ":var_4", 3),
				(agent_add_relation_with_agent, ":var_4", ":player_agent_no", 1),
				(store_current_scene, ":current_scene"),
				(try_begin),
					(eq, ":current_scene", "$town_scene_tavern"),
					(party_slot_eq, "$g_encountered_party", 15, 2),
				(else_try),
					(eq, ":current_scene", "scn_kidnapper_fight"),
					(party_slot_eq, "$g_encountered_party", 15, 23),
				(else_try),
					(agent_set_is_alarmed, ":var_4", 1),
				(try_end),
				(agent_ai_set_aggressiveness, ":var_4", 199),
				(set_show_messages, 0),
				(agent_get_team, ":team_var_4", ":var_4"),
				(team_give_order, ":team_var_4", 3, 10),
				(team_give_order, ":team_var_4", 3, 1),
				(set_show_messages, 1),
			(try_end)
		])
	]),

	("jailbreak", 0, 0,
	"You lead your men to battle.",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(6, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(7, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(8, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(9, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
	(10, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(11, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(12, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(13, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(14, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(15, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(16, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(17, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(18, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(19, mtef_visitor_source|mtef_team_2, af_override_horse, aif_start_alarmed, 1, []),
	(20, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(21, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(22, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(23, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(24, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(25, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(26, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(27, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(28, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(29, mtef_visitor_source|mtef_team_3, af_override_horse, aif_start_alarmed, 1, []),
	(30, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(31, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(32, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, []),
	(33, mtef_visitor_source|mtef_team_4, af_override_horse, aif_start_alarmed, 1, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 1, -1),
			(team_set_relation, 0, 2, -1),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, 0),
			(mission_disable_talk)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(eq, ":troop_id_var_1", "$qquest_target_troop"),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":var_1", ":number"),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(question_box, "str_do_you_want_to_retreat")
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(display_message, "str_questfail", 0x00ffff00),
			(play_sound, "snd_bad_drum"),
			(call_script, "script_qquest_initialize"),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return")
		]),

		(0.0, 2.0, ti_once,
		[
			(num_active_teams_le, 2),
			(neg|main_hero_fallen)
		],

		[
			(mission_enable_talk)
		]),

		(1.0, 4.0, 0.0,
		[
			(main_hero_fallen)
		],

		[
			(display_message, "str_questfail", 0x00ffff00),
			(play_sound, "snd_bad_drum"),
			(call_script, "script_qquest_initialize"),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return")
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("quest_inn", mtf_battle_mode, -1,
	"Default town visit",
	[(0, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(1, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(5, mtef_visitor_source, af_override_horse, 0, 1, []),
	(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
	(8, mtef_scene_source, af_override_horse, 0, 1, []),
	(9, mtef_visitor_source, af_override_horse, 0, 1, []),
	(10, mtef_scene_source, af_override_horse, 0, 1, []),
	(11, mtef_visitor_source, af_override_horse, 0, 1, []),
	(12, mtef_scene_source, af_override_horse, 0, 1, []),
	(13, mtef_scene_source, 0, 0, 1, []),
	(14, mtef_scene_source, 0, 0, 1, []),
	(15, mtef_scene_source, 0, 0, 1, []),
	(16, mtef_visitor_source, af_override_horse, 0, 1, []),
	(17, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
	(18, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(19, mtef_visitor_source, af_override_horse, 0, 1, []),
	(20, mtef_visitor_source, af_override_horse, 0, 1, []),
	(21, mtef_visitor_source, af_override_horse, 0, 1, []),
	(22, mtef_visitor_source, af_override_horse, 0, 1, []),
	(23, mtef_visitor_source, af_override_horse, 0, 1, []),
	(24, mtef_visitor_source, af_override_horse, 0, 1, []),
	(25, mtef_visitor_source, af_override_horse, 0, 1, []),
	(26, mtef_visitor_source, af_override_horse, 0, 1, []),
	(27, mtef_visitor_source, af_override_horse, 0, 1, []),
	(28, mtef_visitor_source, af_override_horse, 0, 1, []),
	(29, mtef_visitor_source, af_override_horse, 0, 1, []),
	(30, mtef_visitor_source, af_override_horse, 0, 1, []),
	(31, mtef_visitor_source, af_override_horse, 0, 1, [])],
	[
		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$sex_cam_on", 1),
			(eq, "$deathcam_on", 0)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_watching_mode", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 1, 2, 0)
		]),

		(1.0, 0.0, ti_once,
		[
			(eq, "$main_q_step", 94),
			(assign, ":var_1", 0),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(eq, ":troop_id_var_2", "trp_cru_5_m"),
				(val_add, ":var_1", 1),
			(try_end),
			(this_or_next|le, ":var_1", 0),
			(main_hero_fallen)
		],

		[
			(try_begin),
				(main_hero_fallen),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(else_try),
				(assign, "$main_q_step", 95),
				(mission_enable_talk),
			(try_end)
		]),

		(1.0, 0.0, ti_once,
		[
			(eq, "$main_q_step", 95),
			(main_hero_fallen)
		],

		[
			(try_begin),
				(main_hero_fallen),
				(assign, "$main_q_step", 94),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(eq, ":troop_id_trigger_param_1", "trp_vaegir_merchant"),
				(eq, "$main_q_step", 95),
				(assign, "$main_q_step", 96),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(try_end)
		]),

		(-21.0, 0.0, 0.0,
		[
			(display_message, "str_cannot_leave_now")
		],

		[]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("arena_mission", mtf_battle_mode, -1,
	"You enter a melee fight in the arena.",
	[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
	(1, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(2, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(3, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(4, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(5, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(6, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(7, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(8, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(9, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(10, mtef_visitor_source|mtef_team_0, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_blue]),
	(11, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(12, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(13, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(14, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(15, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(16, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(17, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(18, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(19, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(20, mtef_visitor_source|mtef_team_1, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_green]),
	(21, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(22, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(23, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(24, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(25, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(26, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(27, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(28, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(29, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(30, mtef_visitor_source|mtef_team_2, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_white]),
	(31, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(32, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(33, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(34, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(35, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(36, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(37, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(38, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(39, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(40, mtef_visitor_source|mtef_team_3, af_override_body|af_override_horse, aif_start_alarmed, 1, [itm_arena_armor_red]),
	(41, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_change_banners_and_chest")
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_arena")
		],

		[]),

		(0.0, 1.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(set_show_messages, 0),
				(agent_set_ammo, ":var_1", 197, 0),
				(agent_set_ammo, ":var_1", 198, 0),
				(agent_set_ammo, ":var_1", 199, 0),
				(agent_set_ammo, ":var_1", 200, 0),
				(agent_set_ammo, ":var_1", 1333, 0),
				(agent_set_ammo, ":var_1", 1334, 0),
				(agent_set_ammo, ":var_1", 1335, 0),
				(agent_set_ammo, ":var_1", 1336, 0),
				(set_show_messages, 1),
			(try_end)
		]),

		(1.0, 0.0, ti_once,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(try_begin),
					(gt, ":horse_var_1", 0),
					(store_agent_hit_points, ":agent_hit_points_horse_var_1_1", ":horse_var_1", 1),
					(store_mul, ":value", 100, 1000),
					(val_add, ":agent_hit_points_horse_var_1_1", ":value"),
					(agent_set_max_hit_points, ":horse_var_1", ":agent_hit_points_horse_var_1_1", 1),
					(agent_set_hit_points, ":horse_var_1", 100, 0),
				(try_end),
			(try_end)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_1"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_adventurer_2"),
				(eq, ":troop_id_trigger_param_1", "trp_adventurer_3"),
				(agent_ai_set_always_attack_in_melee, ":trigger_param_1", 1),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(play_sound, "snd_arena_ambiance", 2),
			(call_script, "script_molda_music_box", 4, 0)
		]),

		(2.0, 4.0, ti_once,
		[
			(this_or_next|main_hero_fallen),
			(num_active_teams_le, 1)
		],

		[
			(try_begin),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(try_begin),
					(eq, "$wm_duel_persnal", 1),
					(try_begin),
						(neg|main_hero_fallen),
						(call_script, "script_moral_level_diff", "p_main_party", 25),
						(call_script, "script_wm_honor_change_diff", "trp_player", 5, 87),
						(display_message, "str_duel_fellow"),
						(assign, "$wm_quest_mission_anti_skip_menu", 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
					(else_try),
						(call_script, "script_moral_level_diff", "p_main_party", -50),
						(call_script, "script_wm_honor_change_diff", "trp_player", 5, 34),
						(display_message, "str_duel_fellow_fail"),
						(assign, "$wm_quest_mission_anti_skip_menu", 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
					(try_end),
				(else_try),
					(party_slot_eq, "$g_encountered_party", 15, 6),
					(try_begin),
						(gt, "$molda_start_map_conversation", 0),
						(assign, "$wm_quest_result", 1),
						(assign, "$wm_quest_mission_anti_skip_menu", 0),
						(assign, "$wm_talk_state", 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_molda_map_talk"),
					(else_try),
						(neg|main_hero_fallen),
						(assign, "$wm_quest_mission_anti_skip_menu", 0),
						(assign, "$wm_quest_result", 1),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
					(else_try),
						(assign, "$wm_quest_mission_anti_skip_menu", 0),
						(assign, "$wm_quest_result", 2),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
					(try_end),
				(try_end),
			(else_try),
				(eq, "$wm_duel_persnal", 1),
				(try_begin),
					(eq, "$qquest_type", 22),
					(main_hero_fallen),
					(assign, "$qquest_progress", 2),
					(display_message, "str_questfail", 0x00ffff00),
					(play_sound, "snd_bad_drum"),
					(display_message, "str_duel_lord_lose"),
				(else_try),
					(eq, "$qquest_type", 22),
					(num_active_teams_le, 1),
					(assign, "$qquest_progress", 1),
					(display_message, "str_questsucc", 0x00ffff00),
					(play_sound, "snd_quest_succeeded"),
					(display_message, "str_duel_lord_win"),
				(try_end),
				(try_begin),
					(eq, "$start_age", 1184),
					(eq, "$wm_target_troop", "trp_tt_lord_18_00"),
					(neg|main_hero_fallen),
					(num_active_teams_le, 1),
					(display_message, "str_l_lionheart"),
					(assign, "$bt_st_lionheart", 1),
				(else_try),
					(eq, "$start_age", 1573),
					(eq, "$wm_target_troop", "trp_tt_lord_01_08"),
					(neg|main_hero_fallen),
					(num_active_teams_le, 1),
					(display_message, "str_l_briver"),
					(assign, "$bt_st_briver", 1),
				(try_end),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
			(else_try),
				(try_begin),
					(eq, "$tournament_phase", 1),
					(neg|main_hero_fallen),
					(assign, "$tournament_phase", 2),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_tournament"),
				(else_try),
					(eq, "$tournament_phase", 1),
					(ge, "$ply_tournament_kill_num", 4),
					(assign, "$tournament_phase", 2),
					(assign, "$tournament_begging", 1),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_tournament"),
				(else_try),
					(eq, "$tournament_phase", 2),
					(neg|main_hero_fallen),
					(assign, "$tournament_phase", 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_tournament"),
				(else_try),
					(eq, "$tournament_phase", 2),
					(ge, "$ply_tournament_kill_num", 4),
					(assign, "$tournament_phase", 3),
					(assign, "$tournament_begging", 1),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_tournament"),
				(else_try),
					(eq, "$tournament_phase", 3),
					(neg|main_hero_fallen),
					(assign, "$tournament_phase", 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_tournament"),
				(else_try),
					(assign, "$tournament_phase", -1),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_tournament"),
				(try_end),
			(try_end)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(question_box, "str_give_up_fight")
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(try_begin),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(party_slot_eq, "$g_encountered_party", 15, 6),
				(assign, "$wm_quest_mission_anti_skip_menu", 0),
				(assign, "$wm_quest_result", 2),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
			(else_try),
				(eq, "$wm_duel_persnal", 1),
				(try_begin),
					(eq, "$qquest_type", 22),
					(assign, "$qquest_progress", 2),
					(display_message, "str_questfail", 0x00ffff00),
					(play_sound, "snd_bad_drum"),
					(display_message, "str_duel_lord_lose"),
				(try_end),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
			(else_try),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(eq, ":trigger_param_2", "$bt_player_agent"),
				(eq, "$wm_duel_persnal", 0),
				(val_add, "$ply_tournament_kill_num", 1),
			(try_end),
			(try_begin),
				(party_slot_eq, "$g_encountered_party", 15, 6),
				(neg|main_hero_fallen),
				(eq, ":troop_id_trigger_param_1", "trp_npc13"),
				(assign, "$molda_start_map_conversation", "trp_npc13"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(this_or_next|eq, "$deathcam_on", 2),
			(main_hero_fallen)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(team_give_order, "$bt_player_team", 9, 2)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(call_script, "script_alive_count_global_sett", 1),
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		])
	]),

	("fuck_mission", 0, -1,
	"village center",
	[(0, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(1, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(2, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(3, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(4, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(5, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(6, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(7, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(8, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(9, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(10, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(11, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(12, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(13, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(14, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(15, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(16, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(17, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(18, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(19, mtef_scene_source|mtef_team_0, af_override_everything, 0, 1, []),
	(20, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_horse, 0, 1, [itm_club]),
	(21, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(22, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(23, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(24, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(25, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(26, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(27, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(28, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(29, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(30, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(31, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(32, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(33, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(34, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(35, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(36, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(37, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(38, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(39, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, []),
	(40, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 0, [])],
	[
		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$sex_cam_on", 1),
			(eq, "$deathcam_on", 0)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_watching_mode", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(0.0, 0.0, 0.0,
		[
			(key_clicked, 1)
		],

		[
			(display_message, "str_escape_alarm", 0x00ffff00)
		]),

		(-22.0, 0.0, 0.0,
		[
			(display_message, "str_cant_use_inventory_now")
		],

		[]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_disable_talk),
			(assign, "$fuck_event_occu", 0)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(entry_point_get_position, 1, 0),
			(set_spawn_position, 1),
			(spawn_agent, "trp_player")
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(play_track, "track_love_scene", 2),
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_spy_walker_2"),
					(agent_equip_item, ":var_1", 713),
				(try_end),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(try_begin),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_horse, ":horse_player_agent_no", ":player_agent_no"),
				(try_begin),
					(gt, ":horse_player_agent_no", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_player_agent_no", 0),
					(agent_set_hit_points, ":horse_player_agent_no", 0, 0),
					(agent_deliver_damage_to_agent, ":player_agent_no", ":horse_player_agent_no", 1255),
					(set_show_messages, 1),
				(try_end),
				(agent_set_visibility, ":player_agent_no", 0),
				(set_show_messages, 0),
				(agent_set_hit_points, ":player_agent_no", 1),
				(agent_deliver_damage_to_agent, ":player_agent_no", ":player_agent_no", 1255),
				(neg|agent_is_alive, ":player_agent_no"),
				(agent_equip_item, ":player_agent_no", 1395),
				(agent_equip_item, ":player_agent_no", 1396),
				(agent_equip_item, ":player_agent_no", 1397),
				(agent_equip_item, ":player_agent_no", 1398),
				(set_show_messages, 1),
			(try_end)
		]),

		(0.0, 2.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 1)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(key_clicked, 22),
				(try_begin),
					(eq, "$fuck_progress_end", 0),
					(eq, "$women_fucked_mission", 0),
					(start_presentation, "prsnt_pst_fuck_cum"),
				(try_end),
			(try_end)
		]),

		(0.0, 9.0, 0.0,
		[],

		[
			(eq, "$women_fucked_mission", 0),
			(eq, "$fuck_progress_end", 0),
			(display_message, "str_ejaculate_u", 0x00ffff00)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(eq, "$women_fucked_mission", 0),
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(call_script, "script_troop_type_sett", ":troop_id_var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "$g_sex_troop_id"),
					(assign, "$sex_troop_agent", ":var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", "$g_sex_troop_id", 0, ":var_1"),
					(agent_set_stand_animation, ":var_1", "$fuck_anim_girl"),
				(try_end),
				(try_begin),
					(eq, "$is_three_some", 1),
					(eq, ":troop_id_var_1", "$2nd_sex_troop_id"),
					(gt, "$troop_gender_type", 10),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", "$2nd_sex_troop_id", 0, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker_2"),
				(try_end),
				(try_begin),
					(eq, "$is_three_some", 1),
					(eq, ":troop_id_var_1", "$2nd_sex_troop_id"),
					(lt, "$troop_gender_type", 10),
					(call_script, "script_molda_body_hand_for_man", "$2nd_sex_troop_id", ":var_1"),
					(agent_set_stand_animation, ":var_1", "$fuck_anim_man"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_player"),
					(call_script, "script_molda_body_hand_for_man", "trp_player", ":var_1"),
					(agent_set_stand_animation, ":var_1", "$fuck_anim_man"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$fuck_progress_end", 1)
		],

		[
			(eq, "$women_fucked_mission", 0),
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(call_script, "script_troop_type_sett", ":troop_id_var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "$g_sex_troop_id"),
					(agent_play_sound, ":var_1", "snd_gbt_orgasm"),
					(agent_set_stand_animation, ":var_1", "anim_female_cum"),
				(try_end),
				(try_begin),
					(eq, "$is_three_some", 1),
					(eq, ":troop_id_var_1", "$2nd_sex_troop_id"),
					(gt, "$troop_gender_type", 10),
					(entry_point_get_position, 31, 43),
					(agent_set_position, ":var_1", 31),
					(agent_play_sound, ":var_1", "snd_gbt_orgasm"),
					(agent_set_stand_animation, ":var_1", "anim_female_cum"),
				(try_end),
				(try_begin),
					(eq, "$is_three_some", 1),
					(eq, ":troop_id_var_1", "$2nd_sex_troop_id"),
					(lt, "$troop_gender_type", 10),
					(entry_point_get_position, 31, 44),
					(agent_set_position, ":var_1", 31),
					(agent_set_stand_animation, ":var_1", "anim_male_masterb"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_player"),
					(entry_point_get_position, 31, 41),
					(agent_set_position, ":var_1", 31),
					(agent_set_stand_animation, ":var_1", "anim_male_masterb"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(key_clicked, 22),
				(eq, "$fuck_progress_end", 0),
				(eq, "$women_fucked_mission", 1),
				(store_random_in_range, ":random_in_range_0_5", 0, 5),
				(try_begin),
					(eq, ":random_in_range_0_5", 0),
					(play_sound, "snd_gbt_orgasm"),
					(call_script, "script_molda_body_hand_set", "$g_sex_troop_id", 4, "$sex_troop_agent"),
					(try_begin),
						(troop_slot_eq, "trp_player", slot_troop_last_persuasion_time, 1),
						(call_script, "script_molda_body_hand_set", "trp_player", 7, "$sex_troop_agent"),
					(try_end),
					(call_script, "script_after_fuck_sett", "$sit_is_rape", 1),
					(assign, "$fuck_progress_end", 1),
					(play_sound, "snd_mansatis"),
					(presentation_set_duration, 0),
					(presentation_set_duration, 0),
					(store_random_in_range, ":random_in_range_0_9", 0, 9),
					(try_begin),
						(le, "$sit_is_rape", 0),
						(eq, ":random_in_range_0_9", 0),
						(call_script, "script_fuck_event_occur"),
					(try_end),
				(else_try),
					(eq, ":random_in_range_0_5", 1),
					(play_sound, "snd_gbt_orgasm"),
					(call_script, "script_molda_body_hand_set", "trp_player", 5, "$sex_troop_agent"),
					(try_begin),
						(troop_slot_eq, "trp_player", slot_troop_last_persuasion_time, 1),
						(call_script, "script_molda_body_hand_set", "trp_player", 7, "$sex_troop_agent"),
					(try_end),
					(call_script, "script_after_fuck_sett", "$sit_is_rape", 1),
					(assign, "$fuck_progress_end", 1),
					(play_sound, "snd_mansatis"),
					(store_random_in_range, ":random_in_range_0_9", 0, 9),
					(try_begin),
						(le, "$sit_is_rape", 0),
						(eq, ":random_in_range_0_9", 0),
						(call_script, "script_fuck_event_occur"),
					(try_end),
				(else_try),
					(eq, ":random_in_range_0_5", 2),
					(play_sound, "snd_gbt_orgasm"),
					(call_script, "script_molda_body_hand_set", "trp_player", 6, "$sex_troop_agent"),
					(try_begin),
						(troop_slot_eq, "trp_player", slot_troop_last_persuasion_time, 1),
						(call_script, "script_molda_body_hand_set", "trp_player", 7, "$sex_troop_agent"),
					(try_end),
					(call_script, "script_after_fuck_sett", "$sit_is_rape", 1),
					(assign, "$fuck_progress_end", 1),
					(play_sound, "snd_mansatis"),
					(store_random_in_range, ":random_in_range_0_9", 0, 9),
					(try_begin),
						(le, "$sit_is_rape", 0),
						(eq, ":random_in_range_0_9", 0),
						(call_script, "script_fuck_event_occur"),
					(try_end),
				(else_try),
					(eq, ":random_in_range_0_5", 3),
					(play_sound, "snd_gbt_orgasm"),
					(call_script, "script_molda_s_scene", 412, 0),
					(try_begin),
						(troop_slot_eq, "trp_player", slot_troop_last_persuasion_time, 1),
						(call_script, "script_molda_body_hand_set", "trp_player", 7, "$sex_troop_agent"),
					(try_end),
					(call_script, "script_after_fuck_sett", "$sit_is_rape", 1),
					(assign, "$fuck_progress_end", 1),
					(play_sound, "snd_mansatis"),
					(store_random_in_range, ":random_in_range_0_9", 0, 9),
					(try_begin),
						(le, "$sit_is_rape", 0),
						(eq, ":random_in_range_0_9", 0),
						(call_script, "script_fuck_event_occur"),
					(try_end),
				(else_try),
					(play_sound, "snd_gbt_orgasm"),
					(call_script, "script_molda_s_scene", 413, 0),
					(try_begin),
						(troop_slot_eq, "trp_player", slot_troop_last_persuasion_time, 1),
						(call_script, "script_molda_body_hand_set", "trp_player", 7, "$sex_troop_agent"),
					(try_end),
					(assign, "$fuck_progress_end", 1),
					(call_script, "script_after_fuck_sett", "$sit_is_rape", 1),
					(play_sound, "snd_mansatis"),
					(store_random_in_range, ":random_in_range_0_9", 0, 9),
					(try_begin),
						(le, "$sit_is_rape", 0),
						(eq, ":random_in_range_0_9", 0),
						(call_script, "script_fuck_event_occur"),
					(try_end),
				(try_end),
			(try_end)
		]),

		(0.0, 9.0, 0.0,
		[],

		[
			(eq, "$women_fucked_mission", 1),
			(eq, "$fuck_progress_end", 0),
			(display_message, "str_stop_u", 0x00ffff00)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(eq, "$women_fucked_mission", 1),
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_player"),
					(assign, "$sex_troop_agent", ":var_1"),
					(call_script, "script_troop_type_sett", "trp_player"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", "trp_player", 0, ":var_1"),
					(agent_set_stand_animation, ":var_1", "$fuck_anim_girl"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$g_sex_troop_id"),
					(call_script, "script_molda_body_hand_for_man", "$g_sex_troop_id", ":var_1"),
					(agent_set_stand_animation, ":var_1", "$fuck_anim_man"),
				(try_end),
				(call_script, "script_troop_type_sett", ":troop_id_var_1"),
				(try_begin),
					(eq, "$is_three_some", 1),
					(eq, ":troop_id_var_1", "$2nd_sex_troop_id"),
					(gt, "$troop_gender_type", 10),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", "$2nd_sex_troop_id", 0, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker_2"),
				(try_end),
				(try_begin),
					(eq, "$is_three_some", 1),
					(eq, ":troop_id_var_1", "$2nd_sex_troop_id"),
					(lt, "$troop_gender_type", 10),
					(call_script, "script_molda_body_hand_for_man", "$2nd_sex_troop_id", ":var_1"),
					(agent_set_stand_animation, ":var_1", "$fuck_anim_man"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$fuck_progress_end", 1)
		],

		[
			(eq, "$women_fucked_mission", 1),
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(call_script, "script_troop_type_sett", ":troop_id_var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_player"),
					(agent_play_sound, ":var_1", "snd_gbt_orgasm"),
					(agent_set_stand_animation, ":var_1", "anim_female_cum"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$g_sex_troop_id"),
					(entry_point_get_position, 31, 41),
					(agent_set_position, ":var_1", 31),
					(agent_set_stand_animation, ":var_1", "anim_male_masterb"),
				(try_end),
				(try_begin),
					(eq, "$is_three_some", 1),
					(eq, ":troop_id_var_1", "$2nd_sex_troop_id"),
					(gt, "$troop_gender_type", 10),
					(entry_point_get_position, 31, 43),
					(agent_set_position, ":var_1", 31),
					(agent_play_sound, ":var_1", "snd_gbt_orgasm"),
					(agent_set_stand_animation, ":var_1", "anim_female_cum"),
				(try_end),
				(try_begin),
					(eq, "$is_three_some", 1),
					(eq, ":troop_id_var_1", "$2nd_sex_troop_id"),
					(lt, "$troop_gender_type", 10),
					(entry_point_get_position, 31, 42),
					(agent_set_position, ":var_1", 31),
					(agent_set_stand_animation, ":var_1", "anim_male_masterb"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(key_clicked, 22),
				(eq, "$fuck_progress_end", 0),
				(eq, "$women_fucked_mission", 2),
				(store_random_in_range, ":random_in_range_0_2", 0, 2),
				(try_begin),
					(eq, ":random_in_range_0_2", 0),
					(play_sound, "snd_gbt_orgasm"),
					(call_script, "script_molda_s_scene", 212, 0),
					(call_script, "script_after_fuck_sett", "$sit_is_rape", 1),
					(assign, "$fuck_progress_end", 1),
					(play_sound, "snd_mansatis"),
					(store_random_in_range, ":random_in_range_0_9", 0, 9),
					(try_begin),
						(le, "$sit_is_rape", 0),
						(eq, ":random_in_range_0_9", 0),
						(call_script, "script_fuck_event_occur"),
					(try_end),
				(else_try),
					(play_sound, "snd_gbt_orgasm"),
					(call_script, "script_molda_s_scene", 213, 0),
					(assign, "$fuck_progress_end", 1),
					(call_script, "script_after_fuck_sett", "$sit_is_rape", 1),
					(play_sound, "snd_mansatis"),
					(store_random_in_range, ":random_in_range_0_9", 0, 9),
					(try_begin),
						(le, "$sit_is_rape", 0),
						(eq, ":random_in_range_0_9", 0),
						(call_script, "script_fuck_event_occur"),
					(try_end),
				(try_end),
			(try_end)
		]),

		(0.0, 9.0, 0.0,
		[],

		[
			(eq, "$women_fucked_mission", 2),
			(eq, "$fuck_progress_end", 0),
			(display_message, "str_stop_u", 0x00ffff00)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(eq, "$women_fucked_mission", 2),
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_player"),
					(assign, "$sex_troop_agent", ":var_1"),
					(call_script, "script_troop_type_sett", "trp_player"),
					(agent_play_sound, ":var_1", "snd_mansatis"),
					(call_script, "script_molda_body_hand_for_man", "trp_player", ":var_1"),
					(agent_set_stand_animation, ":var_1", "$fuck_anim_girl"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$g_sex_troop_id"),
					(call_script, "script_molda_body_hand_for_man", "$g_sex_troop_id", ":var_1"),
					(agent_set_stand_animation, ":var_1", "$fuck_anim_man"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$fuck_progress_end", 1)
		],

		[
			(eq, "$women_fucked_mission", 2),
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_player"),
					(agent_play_sound, ":var_1", "snd_mansatis"),
					(agent_set_stand_animation, ":var_1", "anim_female_cum"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$g_sex_troop_id"),
					(entry_point_get_position, 31, 41),
					(agent_set_position, ":var_1", 31),
					(agent_set_stand_animation, ":var_1", "anim_male_masterb"),
				(try_end),
			(try_end)
		]),

		(0.0, 6.0, ti_once,
		[
			(eq, "$fuck_event_occu", 1)
		],

		[
			(display_message, "str_spouse_rush", 0x00ffff00),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return")
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$wm_quest_mission_anti_skip_menu", 1),
				(this_or_next|party_slot_eq, "$g_encountered_party", 15, 7),
				(this_or_next|party_slot_eq, "$g_encountered_party", 15, 8),
				(party_slot_eq, "$g_encountered_party", 15, 1),
				(assign, "$wm_quest_mission_anti_skip_menu", 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_quest_menu"),
				(assign, "$need_rope_body", 0),
			(else_try),
				(eq, "$fuck_progress_end", 1),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(assign, "$need_rope_body", 0),
			(else_try),
				(display_message, "str_cannot_leave_now"),
			(try_end)
		])
	]),

	("hideout_mission", 0, -1,
	"You enter the halls of the lord.",
	[(0, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(6, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(7, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(8, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(9, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(10, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(11, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(12, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(13, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(14, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(15, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(16, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(17, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(18, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(19, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(20, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(21, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(22, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(23, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(24, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(25, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(26, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(27, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(28, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(29, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(30, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(31, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(32, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(33, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(34, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(35, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(36, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(37, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(38, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(39, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(40, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(41, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(42, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(43, mtef_visitor_source|mtef_team_4, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(44, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(45, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(46, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(47, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(48, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(49, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(50, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, [])],
	[
		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, 0.0,
		[
			(key_clicked, 1)
		],

		[
			(display_message, "str_escape_alarm", 0x00ffff00)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, -1),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, -1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_change_banners_and_chest")
		]),

		(-22.0, 0.0, 0.0,
		[
			(set_trigger_result, 1)
		],

		[]),

		(-21.0, 0.0, 0.0,
		[
			(try_begin),
				(eq, "$wm_talk_state", 11),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_brothel"),
			(else_try),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_ply_hideout"),
			(try_end)
		],

		[]),

		(-25.0, 0.0, 0.0,
		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_fightpit_manager"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_brothel_manager"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_hideout_warder"),
				(eq, ":troop_id_trigger_param_1", "trp_hideout_torturer"),
				(call_script, "script_for_culture_sett_find_source_party"),
				(call_script, "script_bandit_outfit_setting", "$wm_target_number11", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		],

		[]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_current_scene, ":current_scene"),
			(eq, ":current_scene", "scn_hideout_slave"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(is_between, ":troop_id_trigger_param_1", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(assign, "$need_quit_mission", 1),
			(try_end)
		]),

		(5.0, 0.0, 0.0,
		[
			(eq, "$need_quit_mission", 1)
		],

		[
			(store_current_scene, ":current_scene"),
			(eq, ":current_scene", "scn_hideout_slave"),
			(try_for_agents, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(neq, ":var_2", "$g_talk_agent"),
				(neq, ":var_2", "$bt_player_agent"),
				(neq, ":troop_id_var_2", "trp_hideout_warder"),
				(agent_stop_running_away, ":var_2"),
			(try_end),
			(assign, "$need_quit_mission", 0)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(store_current_scene, ":current_scene"),
			(eq, ":current_scene", "scn_hideout_slave"),
			(agent_equip_item, "$bt_player_agent", 1355)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(store_current_scene, ":current_scene"),
			(eq, ":current_scene", "scn_hideout_comp"),
			(try_for_agents, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(gt, ":troop_id_var_2", 0),
				(this_or_next|eq, ":troop_id_var_2", "$wm_slave_dancer"),
				(eq, ":troop_id_var_2", "trp_hideout_dancer"),
				(store_random_in_range, ":random_in_range_0_4", 0, 4),
				(try_begin),
					(eq, ":random_in_range_0_4", 0),
					(agent_set_stand_animation, ":var_2", "anim_dancer_1"),
				(else_try),
					(eq, ":random_in_range_0_4", 1),
					(agent_set_stand_animation, ":var_2", "anim_dancer_2"),
				(else_try),
					(eq, ":random_in_range_0_4", 2),
					(agent_set_stand_animation, ":var_2", "anim_dancer_3"),
				(else_try),
					(agent_set_stand_animation, ":var_2", "anim_dancer_4"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(is_between, "$torture_room_gangbang", "trp_tt_lady_01_01", "trp_tt_lady_end"),
			(troop_slot_eq, "$torture_room_gangbang", slot_troop_leaded_party, 3)
		],

		[
			(store_current_scene, ":current_scene"),
			(eq, ":current_scene", "scn_hideout_torture"),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(try_begin),
					(eq, ":troop_id_var_2", "$torture_room_gangbang"),
					(call_script, "script_troop_type_sett", ":troop_id_var_2"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_2", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_2", "snd_sex_asian_female"),
					(try_end),
					(agent_equip_item, ":var_2", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_2", 6, ":var_2"),
					(agent_set_stand_animation, ":var_2", "anim_fuck_female_1"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_2", "trp_kidnapper_rape"),
					(call_script, "script_molda_body_hand_for_man", "trp_kidnapper_rape", ":var_2"),
					(agent_set_stand_animation, ":var_2", "anim_fuck_male"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_2", "trp_raid_bandit_looter"),
					(call_script, "script_molda_body_hand_for_man", "trp_raid_bandit_looter", ":var_2"),
					(agent_set_stand_animation, ":var_2", "anim_male_masterb"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(is_between, "$torture_room_beat", "trp_tt_lady_01_01", "trp_tt_lady_end"),
			(troop_slot_eq, "$torture_room_beat", slot_troop_leaded_party, 3)
		],

		[
			(store_current_scene, ":current_scene"),
			(eq, ":current_scene", "scn_hideout_torture"),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(try_begin),
					(eq, ":troop_id_var_2", "$torture_room_beat"),
					(call_script, "script_troop_type_sett", ":troop_id_var_2"),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_2", 3, ":var_2"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_2", "trp_rebels_fort_peasant"),
					(call_script, "script_molda_body_hand_for_man", "trp_rebels_fort_peasant", ":var_2"),
					(agent_equip_item, ":var_2", 1355),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(is_between, "$torture_room_cage", "trp_tt_lady_01_01", "trp_tt_lady_end"),
			(troop_slot_eq, "$torture_room_cage", slot_troop_leaded_party, 3)
		],

		[
			(store_current_scene, ":current_scene"),
			(eq, ":current_scene", "scn_hideout_torture"),
			(play_sound, "snd_swalloww"),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(agent_get_troop_id, ":troop_id_var_2", ":var_2"),
				(try_begin),
					(eq, ":troop_id_var_2", "$torture_room_cage"),
					(call_script, "script_troop_type_sett", ":troop_id_var_2"),
					(agent_equip_item, ":var_2", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_2", 7, ":var_2"),
					(agent_set_stand_animation, ":var_2", "anim_female_fucker_1"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$wm_talk_state", 11)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(gt, ":troop_id_var_1", 0),
				(try_begin),
					(eq, ":troop_id_var_1", "$brothel_member_3"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 0, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_female"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$brothel_member_4"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 4, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_female_1"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$brothel_member_7"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 6, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_female_2"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$brothel_member_1"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 0, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$brothel_member_2"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 4, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker_1"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$brothel_member_5"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 6, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker_2"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$brothel_member_6"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 7, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_cum"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_walker_m"),
					(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_male_masterb"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_light_guild_npc"),
					(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_male_fucked"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_arena_master"),
					(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_male"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, ti_once,
		[
			(gt, "$temp_num_01", 0),
			(gt, "$temp_num_02", 0)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(gt, ":troop_id_var_1", 0),
				(try_begin),
					(eq, ":troop_id_var_1", "$temp_num_01"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 7, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker_1"),
					(try_begin),
						(is_between, ":troop_id_var_1", "trp_tt_lady_01_01", "trp_tt_lady_end"),
						(troop_slot_eq, "$temp_num_01", slot_troop_last_persuasion_time, 1),
						(troop_set_slot, "$temp_num_01", slot_troop_last_persuasion_time, 0),
						(display_message, "str_gbt_virgin", 0x00ff0000),
						(str_store_troop_name, 8, "$temp_num_01"),
						(display_message, "str_gbt_virgin3", 0x00ff0000),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$temp_num_02"),
					(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_male_fucked"),
				(try_end),
			(try_end)
		])
	]),

	("quest_brothel_mission", 0, -1,
	"You enter the halls of the lord.",
	[(0, mtef_scene_source|mtef_team_0, af_override_head|af_override_horse, 0, 1, []),
	(1, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(2, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(3, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(4, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(5, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(6, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(7, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(8, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(9, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(10, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(11, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(12, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(13, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(14, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(15, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(16, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(17, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(18, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(19, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(20, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(21, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(22, mtef_visitor_source|mtef_team_2, af_override_horse, 0, 1, []),
	(23, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(24, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(25, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(26, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(27, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(28, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(29, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(30, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(31, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(32, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(33, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(34, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(35, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(36, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(37, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(38, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(39, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(40, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(41, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(42, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(43, mtef_visitor_source|mtef_team_4, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(44, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(45, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(46, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(47, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(48, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(49, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(50, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, [])],
	[
		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(0.0, 0.0, 0.0,
		[
			(key_clicked, 1)
		],

		[
			(display_message, "str_escape_alarm", 0x00ffff00)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, -1),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, 0),
			(team_set_relation, 1, 3, 0),
			(team_set_relation, 1, 4, 0),
			(team_set_relation, 2, 3, 0),
			(team_set_relation, 2, 4, 0),
			(team_set_relation, 3, 4, -1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_change_banners_and_chest")
		]),

		(-22.0, 0.0, 0.0,
		[
			(set_trigger_result, 1)
		],

		[]),

		(-25.0, 0.0, 0.0,
		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_fightpit_manager"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_brothel_manager"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_hideout_warder"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(eq, ":troop_id_trigger_param_1", "trp_hideout_torturer"),
				(call_script, "script_for_culture_sett_find_source_party"),
				(call_script, "script_bandit_outfit_setting", "$wm_target_number11", ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		],

		[]),

		(-20.0, 0.0, ti_once,
		[
			(eq, "$main_q_step", 73)
		],

		[
			(get_player_agent_no, ":player_agent_no"),
			(try_for_agents, ":var_2"),
				(agent_is_alive, ":var_2"),
				(neq, ":var_2", ":player_agent_no"),
				(set_show_messages, 0),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(agent_deliver_damage_to_agent, ":var_2", ":var_2", 1255),
				(set_show_messages, 1),
			(try_end)
		]),

		(1.0, 0.0, 0.0,
		[
			(eq, "$main_q_step", 73)
		],

		[
			(get_player_agent_no, ":player_agent_no"),
			(entry_point_get_position, 21, 3),
			(agent_get_position, 22, ":player_agent_no"),
			(get_distance_between_positions, ":distance_between_positions_22_21", 22, 21),
			(try_begin),
				(le, ":distance_between_positions_22_21", 100),
				(eq, "$main_q_step", 73),
				(assign, "$main_q_step", 74),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(try_end)
		]),

		(0.0, 90.0, ti_once,
		[
			(eq, "$main_q_step", 73)
		],

		[
			(try_begin),
				(eq, "$main_q_step", 73),
				(assign, "$main_q_step", 74),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
			(try_end)
		]),

		(1.0, 0.0, 0.0,
		[
			(eq, "$main_q_step", 17)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_team, ":team_var_1", ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(this_or_next|eq, ":troop_id_var_1", "$wm_npc_walker_m"),
				(this_or_next|eq, ":troop_id_var_1", "$wm_npc_light_guild_npc"),
				(this_or_next|eq, ":troop_id_var_1", "$wm_npc_arena_master"),
				(eq, ":troop_id_var_1", "trp_raid_bandit_boss"),
				(neq, ":team_var_1", 2),
				(agent_set_team, ":var_1", 2),
				(agent_set_is_alarmed, ":var_1", 1),
				(agent_ai_set_aggressiveness, ":var_1", 199),
				(agent_force_rethink, ":var_1"),
			(try_end)
		]),

		(30.0, 0.0, 0.0,
		[
			(eq, "$main_q_step", 17),
			(neg|main_hero_fallen)
		],

		[
			(add_visitors_to_current_scene, 22, "trp_raid_bandit_boss", 2)
		]),

		(1.0, 0.0, ti_once,
		[
			(eq, "$main_q_step", 17),
			(main_hero_fallen)
		],

		[
			(assign, "$main_q_step", 18),
			(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu")
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$main_q_step", 16)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(gt, ":troop_id_var_1", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":var_1", ":number"),
				(try_end),
				(set_show_messages, 1),
				(eq, "$adult_content", 1),
				(try_begin),
					(eq, ":troop_id_var_1", "$younger_sister_id"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 0, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_female"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_town_walker_w_iber"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 4, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_female_1"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_town_walker_6"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 6, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_female_2"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_town_walker_2"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 0, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_town_walker_4"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 4, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker_1"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_town_walker_w_inka"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(try_begin),
						(neq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_female"),
					(else_try),
						(eq, "$troop_gender_type", 14),
						(agent_play_sound, ":var_1", "snd_sex_asian_female"),
					(try_end),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 6, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_fucker_2"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "trp_town_walker_w_rr"),
					(call_script, "script_troop_type_sett", ":troop_id_var_1"),
					(agent_equip_item, ":var_1", 1468),
					(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 7, ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_female_cum"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_walker_m"),
					(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_male_masterb"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_light_guild_npc"),
					(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_male_fucked"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$wm_npc_arena_master"),
					(call_script, "script_molda_body_hand_for_man", ":troop_id_var_1", ":var_1"),
					(agent_set_stand_animation, ":var_1", "anim_fuck_male"),
				(try_end),
			(try_end)
		])
	]),

	("fight_pit_mission", mtf_battle_mode, -1,
	"You enter the halls of the lord.",
	[(0, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(1, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, []),
	(2, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, []),
	(3, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, []),
	(4, mtef_visitor_source|mtef_team_0, af_override_everything, 0, 1, []),
	(5, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(6, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(7, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(8, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(9, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(10, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(11, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(12, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(13, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(14, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(15, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(16, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(17, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(18, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(19, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(20, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(21, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(22, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(23, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(24, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(25, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(26, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(27, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(28, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(29, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(30, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(31, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(32, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(33, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(34, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(35, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(36, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(37, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(38, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(39, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(40, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(41, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(42, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(43, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(44, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(45, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(46, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(47, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(48, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(49, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, []),
	(50, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_head|af_override_gloves|af_override_horse, 0, 1, [])],
	[
		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(mission_enable_talk),
			(team_set_relation, 0, 1, 0),
			(team_set_relation, 0, 2, 0),
			(team_set_relation, 0, 3, 0),
			(team_set_relation, 0, 4, 0),
			(team_set_relation, 1, 2, -1),
			(team_set_relation, 1, 3, -1),
			(team_set_relation, 1, 4, -1),
			(team_set_relation, 2, 3, -1),
			(team_set_relation, 2, 4, -1),
			(team_set_relation, 3, 4, -1)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_change_banners_and_chest")
		]),

		(-22.0, 0.0, 0.0,
		[
			(set_trigger_result, 1)
		],

		[]),

		(-21.0, 0.0, 0.0,
		[
			(try_begin),
				(eq, "$g_encountered_party", "p_nakepit_party"),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_nakepit"),
			(else_try),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_town_visit"),
			(try_end)
		],

		[]),

		(-25.0, 0.0, 0.0,
		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_fightpit_manager"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_nakepit_manager"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_brothel_manager"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_hideout_warder"),
				(eq, ":troop_id_trigger_param_1", "trp_hideout_torturer"),
				(try_begin),
					(neg|is_between, "$g_encountered_party", "p_pyongyang", "p_place_end"),
					(call_script, "script_for_culture_sett_find_source_party"),
					(call_script, "script_bandit_outfit_setting", "$wm_target_number11", ":trigger_param_1"),
				(else_try),
					(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":troop_id_trigger_param_1", "trp_nakepit_manager"),
				(call_script, "script_molda_body_hand_set", ":troop_id_trigger_param_1", 1, ":trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		],

		[]),

		(0.0, 0.0, ti_once,
		[
			(is_currently_night)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(gt, ":troop_id_var_1", 0),
				(this_or_next|eq, ":troop_id_var_1", "$pit_fighter_1"),
				(this_or_next|eq, ":troop_id_var_1", "$pit_fighter_2"),
				(this_or_next|eq, ":troop_id_var_1", "$pit_fighter_3"),
				(eq, ":troop_id_var_1", "$pit_fighter_4"),
				(store_random_in_range, ":random_in_range_0_4", 0, 4),
				(try_begin),
					(eq, ":random_in_range_0_4", 0),
					(agent_set_stand_animation, ":var_1", "anim_dancer_1"),
				(else_try),
					(eq, ":random_in_range_0_4", 1),
					(agent_set_stand_animation, ":var_1", "anim_dancer_2"),
				(else_try),
					(eq, ":random_in_range_0_4", 2),
					(agent_set_stand_animation, ":var_1", "anim_dancer_3"),
				(else_try),
					(agent_set_stand_animation, ":var_1", "anim_dancer_4"),
				(try_end),
				(call_script, "script_molda_body_hand_set", ":troop_id_var_1", 0, ":var_1"),
			(try_end)
		]),

		(1.0, 5.0, 0.0,
		[
			(gt, "$bet_troop_no", 0),
			(eq, "$pit_fight_begin", 0)
		],

		[
			(try_for_agents, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(gt, ":troop_id_var_1", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_1"),
				(try_begin),
					(gt, "$troop_gender_type", 10),
					(agent_play_sound, ":var_1", "snd_woman_yell"),
				(else_try),
					(lt, "$troop_gender_type", 10),
					(agent_play_sound, ":var_1", "snd_man_yell"),
				(try_end),
				(try_begin),
					(eq, ":troop_id_var_1", "$pit_fighter_1"),
					(agent_set_team, ":var_1", 1),
					(agent_ai_set_aggressiveness, ":var_1", 199),
				(else_try),
					(eq, ":troop_id_var_1", "$pit_fighter_2"),
					(agent_set_team, ":var_1", 2),
					(agent_ai_set_aggressiveness, ":var_1", 199),
				(else_try),
					(eq, ":troop_id_var_1", "$pit_fighter_3"),
					(agent_set_team, ":var_1", 3),
					(agent_ai_set_aggressiveness, ":var_1", 199),
				(else_try),
					(eq, ":troop_id_var_1", "$pit_fighter_4"),
					(agent_set_team, ":var_1", 4),
					(agent_ai_set_aggressiveness, ":var_1", 199),
				(try_end),
			(try_end),
			(assign, "$pit_fight_begin", 1),
			(mission_disable_talk),
			(play_sound, "snd_command_horn_2d"),
			(play_sound, "snd_command_horn_2d"),
			(display_message, "str_pit_ready", 0x00ffff00)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$pit_fight_winner_no", 0)
		],

		[
			(assign, ":var_1", 0),
			(try_for_agents, ":value"),
				(agent_is_alive, ":value"),
				(agent_get_troop_id, ":troop_id_value", ":value"),
				(gt, ":troop_id_value", 0),
				(this_or_next|eq, ":troop_id_value", "$pit_fighter_1"),
				(this_or_next|eq, ":troop_id_value", "$pit_fighter_2"),
				(this_or_next|eq, ":troop_id_value", "$pit_fighter_3"),
				(eq, ":troop_id_value", "$pit_fighter_4"),
				(val_add, ":var_1", 1),
			(try_end),
			(try_begin),
				(le, ":var_1", 1),
				(mission_enable_talk),
				(try_for_agents, ":value"),
					(agent_is_alive, ":value"),
					(agent_get_troop_id, ":troop_id_value", ":value"),
					(gt, ":troop_id_value", 0),
					(neq, ":troop_id_value", "trp_nakepit_manager"),
					(neq, ":troop_id_value", "trp_fightpit_manager"),
					(call_script, "script_troop_type_sett", ":troop_id_value"),
					(try_begin),
						(gt, "$troop_gender_type", 10),
						(agent_play_sound, ":value", "snd_woman_yell"),
					(else_try),
						(lt, "$troop_gender_type", 10),
						(store_random_in_range, ":random_in_range_0_6", 0, 6),
						(eq, ":random_in_range_0_6", 0),
						(agent_play_sound, ":value", "snd_man_victory"),
						(agent_set_stand_animation, ":value", "anim_cheer"),
					(try_end),
					(this_or_next|eq, ":troop_id_value", "$pit_fighter_1"),
					(this_or_next|eq, ":troop_id_value", "$pit_fighter_2"),
					(this_or_next|eq, ":troop_id_value", "$pit_fighter_3"),
					(eq, ":troop_id_value", "$pit_fighter_4"),
					(agent_set_stand_animation, ":value", "anim_cheer"),
					(assign, "$pit_fight_winner_no", ":troop_id_value"),
					(try_begin),
						(eq, "$pit_fight_winner_no", "$pit_fighter_1"),
						(str_store_string, 8, "str_nakepit_winner_1"),
					(else_try),
						(eq, "$pit_fight_winner_no", "$pit_fighter_2"),
						(str_store_string, 8, "str_nakepit_winner_2"),
					(else_try),
						(eq, "$pit_fight_winner_no", "$pit_fighter_3"),
						(str_store_string, 8, "str_nakepit_winner_3"),
					(else_try),
						(eq, "$pit_fight_winner_no", "$pit_fighter_4"),
						(str_store_string, 8, "str_nakepit_winner_4"),
					(try_end),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(display_message, "str_pit_winner", 0x00ffff00),
				(try_end),
			(try_end)
		]),

		(4.0, 0.0, 0.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(gt, ":troop_id_var_1", 0),
				(neq, ":troop_id_var_1", "trp_nakepit_manager"),
				(neq, ":troop_id_var_1", "trp_fightpit_manager"),
				(neq, ":troop_id_var_1", "$pit_fighter_1"),
				(neq, ":troop_id_var_1", "$pit_fighter_2"),
				(neq, ":troop_id_var_1", "$pit_fighter_3"),
				(neq, ":troop_id_var_1", "$pit_fighter_4"),
				(call_script, "script_troop_type_sett", ":troop_id_var_1"),
				(lt, "$troop_gender_type", 10),
				(store_random_in_range, ":random_in_range_0_7", 0, 7),
				(eq, ":random_in_range_0_7", 0),
				(agent_play_sound, ":var_1", "snd_man_victory"),
				(agent_set_stand_animation, ":var_1", "anim_cheer"),
			(try_end)
		])
	]),

	("formation_battle", mtf_battle_mode|mtf_synch_inventory, -1,
	"You lead your men to battle.",
	[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(16, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(17, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(18, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(19, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(20, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(21, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(22, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(23, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(24, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(25, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(26, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(27, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(28, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(29, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(30, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 0, []),
	(31, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(32, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(33, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(34, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(35, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(36, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(37, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(38, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(39, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(40, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(41, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(42, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(43, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(44, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(45, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(46, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(47, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, []),
	(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 0, [])],
	[
		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_change_banners_and_chest")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(set_show_messages, 0),
			(store_trigger_param_1, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(try_begin),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_looter"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_raid_bandit_brigand"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_rape"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_kidnapper_fight"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_peasant"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_rebels_fort_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_pirate_leader"),
				(this_or_next|eq, ":troop_id_trigger_param_1", "trp_looter_leader"),
				(eq, ":troop_id_trigger_param_1", "trp_raid_bandit_boss"),
				(call_script, "script_bandit_outfit_setting", "$g_encountered_party", ":trigger_param_1"),
			(try_end),
			(try_begin),
				(eq, "$battle_tile_type", 6),
				(this_or_next|eq, "$bt_terrain_strategy_state", 1),
				(eq, "$bt_terrain_strategy_state", 2),
				(agent_is_human, ":trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(try_begin),
					(eq, "$bt_terrain_strategy_state", 1),
					(eq, ":team_trigger_param_1", ":team_player_agent_no"),
					(agent_equip_item, ":trigger_param_1", 655),
				(else_try),
					(eq, "$bt_terrain_strategy_state", 2),
					(neq, ":team_trigger_param_1", ":team_player_agent_no"),
					(agent_equip_item, ":trigger_param_1", 655),
				(try_end),
			(try_end),
			(set_show_messages, 1)
		]),

		(-21.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(assign, "$tutorial_battle", 0),
				(assign, "$wm_battle_result_state", 0),
				(call_script, "script_troop_class_init"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_start_phase_x3"),
			(else_try),
				(eq, "$tutorial_battle", 1),
				(gt, "$main_q_step", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 0),
					(display_message, "str_can_not_retreat"),
				(else_try),
					(eq, "$wm_battle_result_state", 1),
					(val_add, "$main_q_step", 1),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 25, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 75, 3),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_main_quest_menu"),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(assign, "$tutorial_battle", 0),
					(assign, "$wm_battle_result_state", 0),
					(call_script, "script_troop_class_init"),
					(stop_all_sounds, 0),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_wm_after_battle_health_result"),
					(call_script, "script_stack_kill_sc", 50, 0, 0, 0),
					(call_script, "script_party_army_size_execute", "p_main_party", 50, 3),
					(assign, "$main_q_day", 60),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_pst_map_return"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(gt, "$attempt_coup", 0),
				(try_begin),
					(eq, "$wm_battle_result_state", 1),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(try_begin),
						(eq, "$attempt_coup", 1),
						(assign, "$attempt_coup", 2),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 2),
						(assign, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_progress"),
					(else_try),
						(eq, "$attempt_coup", 3),
						(stop_all_sounds, 0),
						(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_success"),
					(try_end),
				(else_try),
					(eq, "$wm_battle_result_state", 2),
					(call_script, "script_wm_count_army_damage_after_battle"),
					(call_script, "script_rand_glob_dice"),
					(set_mission_result, -1),
					(assign, "$attempt_coup", 0),
					(stop_all_sounds, 0),
					(call_script, "script_wm_finish_mission_menu_popup", "mnu_coup_fail"),
				(else_try),
					(display_message, "str_can_not_retreat"),
				(try_end),
			(else_try),
				(eq, "$wm_battle_result_state", 1),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_battle_result_state", 2),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(set_mission_result, -1),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(eq, "$deathcam_on", 1),
				(neq, "$wm_battle_result_state", 2),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(eq, "$wm_allow_retreat", 1),
				(call_script, "script_rand_glob_dice"),
				(question_box, "str_do_you_want_to_retreat"),
			(else_try),
				(display_message, "str_can_not_retreat"),
			(try_end)
		]),

		(-8.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(eq, ":trigger_param_1", 0),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(neq, "$is_siege_battle", 1),
				(eq, ":random_in_range_0_5", 0),
				(dialog_box, "str_retreat_failed", "str_box_note"),
				(assign, "$wm_allow_retreat", 0),
			(else_try),
				(display_message, "str_molda_retreat_penel", 0x00ff0000),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_party_army_size_execute", "p_main_party", 80, 3),
				(assign, "$wm_battle_result_state", 3),
				(stop_all_sounds, 0),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(team_set_relation, 0, 2, 1),
			(team_set_relation, 1, 3, 1),
			(call_script, "script_place_player_banner_near_inventory_bms")
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_molda_music_box", 2, 0)
		]),

		(2.0, 0.0, ti_once,
		[
			(store_mission_timer_a, reg1),
			(ge, reg1, 1),
			(all_enemies_defeated, 5),
			(set_mission_result, 1),
			(display_message, "str_msg_battle_won"),
			(assign, "$wm_battle_result_state", 1),
			(call_script, "script_molda_music_box", 10, 0)
		],

		[]),

		(2.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$wm_battle_result_state", 1),
			(eq, "$wm_battle_result_state", 2)
		],

		[
			(presentation_set_duration, 0),
			(presentation_set_duration, 0),
			(start_presentation, "prsnt_mini_map")
		]),

		(2.0, 0.0, ti_once,
		[
			(main_hero_fallen),
			(assign, ":value", 0),
			(try_for_agents, ":var_2"),
				(neq, ":value", 1),
				(agent_is_ally, ":var_2"),
				(agent_is_alive, ":var_2"),
				(assign, ":value", 1),
			(try_end),
			(eq, ":value", 0)
		],

		[
			(assign, "$wm_battle_result_state", 2),
			(display_message, "str_tab_end_battle_mess"),
			(call_script, "script_molda_music_box", 10, 0)
		]),

		(-22.0, 0.0, 0.0,
		[],

		[
			(display_message, "str_use_baggage_for_inventory")
		]),

		(-30.0, 0.0, 0.0,
		[],

		[
			(change_screen_quit)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(assign, "$count_player_team", 1),
			(assign, "$count_enemy_team", 0),
			(try_begin),
				(eq, "$battle_tile_type", 7),
				(call_script, "script_scene_replace_trig"),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(try_begin),
				(eq, "$low_encounter_battle", 1),
				(call_script, "script_battle_scale_sett"),
				(call_script, "script_low_encounter_spawn", "p_ally_casualties", "$bt_player_team", 1),
				(call_script, "script_bt_missin_add_spawn"),
				(call_script, "script_low_encounter_spawn", "p_enemy_casualties", "$bt_enemy_team", -1),
			(else_try),
				(assign, ":var_1", "$enemy_scale_rate"),
				(assign, ":var_2", "$player_scale_rate"),
				(try_begin),
					(this_or_next|eq, "$battle_tile_type", 5),
					(eq, "$battle_tile_type", 6),
					(set_show_messages, 0),
					(val_mul, ":var_1", 85),
					(val_mul, ":var_2", 85),
					(val_div, ":var_1", 100),
					(val_div, ":var_2", 100),
					(set_show_messages, 1),
				(try_end),
				(call_script, "script_bt_fb_full_spawn", "p_ally_casualties", "$bt_player_team", 1, ":var_2"),
				(call_script, "script_bt_missin_add_spawn"),
				(call_script, "script_bt_fb_full_spawn", "p_enemy_casualties", "$bt_enemy_team", -1, ":var_1"),
			(try_end),
			(try_begin),
				(assign, ":var_3", 0),
				(assign, ":var_4", 0),
				(try_for_agents, ":var_5"),
					(agent_is_alive, ":var_5"),
					(agent_is_human, ":var_5"),
					(agent_get_troop_id, ":troop_id_var_5", ":var_5"),
					(agent_get_team, ":team_var_5", ":var_5"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_5"),
						(agent_set_slot, ":var_5", 23, 8),
						(agent_set_division, ":var_5", 8),
					(try_end),
					(agent_get_slot, ":var_5_23", ":var_5", 23),
					(try_begin),
						(eq, ":var_5_23", 8),
						(eq, ":team_var_5", "$bt_player_team"),
						(val_add, ":var_3", 1),
						(agent_get_horse, ":horse_var_5", ":var_5"),
						(gt, ":horse_var_5", 0),
						(val_add, ":var_4", 1),
					(try_end),
				(try_end),
				(try_for_range, ":var_5_23", 0, 8),
					(store_add, ":value", ":var_5_23", 1),
					(troop_get_slot, ":slot_division_ally_value", "trp_slot_division_ally", ":value"),
					(gt, ":slot_division_ally_value", 0),
					(str_store_troop_name, 8, ":slot_division_ally_value"),
					(store_add, reg8, ":var_5_23", 1),
					(str_store_string, 9, "str_bt_temp_class_name"),
					(class_set_name, ":var_5_23", 9),
				(try_end),
				(class_set_name, 8, "str_new_name_divi_ply"),
				(set_show_messages, 0),
				(try_begin),
					(ge, ":var_3", 2),
					(val_div, ":var_3", 2),
					(gt, ":var_4", ":var_3"),
					(troop_set_slot, "trp_slot_division_ally", slot_troop_present_at_event, "trp_temp_player_cav"),
				(else_try),
					(troop_set_slot, "trp_slot_division_ally", slot_troop_present_at_event, "trp_temp_player_inf"),
				(try_end),
				(set_show_messages, 1),
				(set_show_messages, 0),
				(try_for_range, ":var_5_23", 0, 9),
					(team_give_order, "$bt_player_team", ":var_5_23", 11),
				(try_end),
				(try_for_range, ":var_5_23", 0, 9),
					(team_give_order, "$bt_enemy_team", ":var_5_23", 11),
				(try_end),
				(set_show_messages, 1),
			(try_end),
			(display_message, "str_tutorial_mess_battle1"),
			(display_message, "str_tutorial_mess_battle2"),
			(display_message, "str_tutorial_mess_battle3"),
			(display_message, "str_tutorial_mess_battle4"),
			(display_message, "str_tutorial_mess_battle5"),
			(display_message, "str_tutorial_mess_battle6")
		]),

		(15.0, 0.0, 0.0,
		[
			(eq, "$battle_tile_type", 2)
		],

		[
			(try_begin),
				(eq, "$battle_tile_type", 2),
				(scene_prop_get_instance, "$river_flood_prop_id", "spr_5_river_flood", 0),
				(prop_instance_get_position, 4, "$river_flood_prop_id"),
				(position_get_z, ":position_z_4", 4),
				(set_show_messages, 0),
				(try_for_agents, ":var_2"),
					(agent_is_alive, ":var_2"),
					(agent_get_position, 3, ":var_2"),
					(position_get_z, ":position_z_3", 3),
					(try_begin),
						(le, ":position_z_3", ":position_z_4"),
						(agent_set_hit_points, ":var_2", 0, 0),
						(agent_deliver_damage_to_agent, ":var_2", ":var_2"),
					(try_end),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		]),

		(0.0, 3.0, ti_once,
		[
			(this_or_next|eq, "$bt_terrain_strategy_state", 1),
			(eq, "$bt_terrain_strategy_state", 2)
		],

		[
			(try_begin),
				(this_or_next|eq, "$bt_terrain_strategy_state", 1),
				(eq, "$bt_terrain_strategy_state", 2),
				(try_begin),
					(eq, "$bt_terrain_strategy_state", 1),
					(assign, ":value", "$bt_player_team"),
				(else_try),
					(eq, "$bt_terrain_strategy_state", 2),
					(assign, ":value", "$bt_enemy_team"),
				(try_end),
				(try_for_agents, ":var_2"),
					(agent_is_alive, ":var_2"),
					(agent_is_human, ":var_2"),
					(agent_get_team, ":team_var_2", ":var_2"),
					(eq, ":team_var_2", ":value"),
					(agent_play_sound, ":var_2", "snd_man_victory"),
				(try_end),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value_2", 0),
					(assign, ":value_3", 1),
				(else_try),
					(assign, ":value_2", 1),
					(assign, ":value_3", 0),
				(try_end),
				(try_begin),
					(eq, "$battle_tile_type", 2),
					(play_sound, "snd_fallrocks"),
					(play_sound, "snd_command_horn_2d"),
					(entry_point_get_position, 8, 101),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 102),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 103),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 104),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 105),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 106),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 107),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 108),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 101),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 102),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 103),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 104),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 105),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 106),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 107),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(entry_point_get_position, 8, 108),
					(set_spawn_position, 8),
					(spawn_scene_prop, "spr_rock_dynamic_physics"),
					(call_script, "script_molda_prop_scale_set", "spr_rock_dynamic_physics", 1500),
					(assign, "$bt_terrain_strategy_dmg_start", 1),
					(assign, "$molda_battle_scn_prop_pos_dmg_timer", 5),
				(else_try),
					(eq, "$battle_tile_type", 3),
					(play_sound, "snd_siege_weapon_hit_2d"),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_Tsunami"),
					(call_script, "script_molda_prop_visible_on_off", "spr_7773_wall_on_off", 0),
					(call_script, "script_molda_prop_physics_on_off", "spr_7773_wall_on_off", 0),
					(call_script, "script_molda_prop_visible_on_off", "spr_water_river", 0),
					(entry_point_get_position, 1, 92),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_5_big_smoke"),
					(entry_point_get_position, 1, 93),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_5_big_smoke"),
					(scene_prop_get_instance, "$river_flood_prop_id", "spr_5_river_flood", 0),
					(entry_point_get_position, 1, 90),
					(prop_instance_animate_to_position, "$river_flood_prop_id", 1, 500),
					(assign, "$bt_terrain_strategy_dmg_start", 1),
					(assign, "$molda_battle_scn_prop_pos_dmg_timer", 7),
				(else_try),
					(eq, "$battle_tile_type", 4),
					(play_sound, "snd_fireworkss"),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_Forest_fires"),
					(entry_point_get_position, 1, 101),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 102),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 103),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 104),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 105),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 106),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 107),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 108),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 109),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 110),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 111),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 112),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 113),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 114),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 115),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 116),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 117),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 118),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 119),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(entry_point_get_position, 1, 120),
					(set_spawn_position, 1),
					(spawn_scene_prop, "spr_Village_fire_big"),
					(call_script, "script_molda_prop_scale_set", "spr_Village_fire_big", 4000),
					(assign, "$bt_terrain_strategy_dmg_start", 1),
					(assign, "$molda_battle_scn_prop_pos_dmg_timer", 20),
				(else_try),
					(eq, "$battle_tile_type", 5),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(set_show_messages, 0),
					(store_mul, ":value_4", 60, "$bt_scale_mult"),
					(val_div, ":value_4", 100),
					(val_div, ":value_4", 4),
					(set_show_messages, 1),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(assign, ":value_5", "p_ally_casualties"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(assign, ":value_5", "p_enemy_casualties"),
					(try_end),
					(assign, ":value_6", 0),
					(party_get_num_companion_stacks, ":num_companion_stacks_value_5", ":value_5"),
					(try_for_range, ":localvariable", 0, ":num_companion_stacks_value_5"),
						(party_stack_get_troop_id, ":party_stack_troop_id_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_troop_id_value_5_localvariable", "trp_army_size_troop"),
						(neg|troop_is_hero, ":party_stack_troop_id_value_5_localvariable"),
						(party_stack_get_size, ":party_stack_size_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_size_value_5_localvariable", 0),
						(neg|troop_is_guarantee_horse, ":party_stack_troop_id_value_5_localvariable"),
						(troop_is_guarantee_ranged, ":party_stack_troop_id_value_5_localvariable"),
						(try_begin),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(store_character_level, ":character_level_party_stack_troop_id_value_5_localvariable", ":party_stack_troop_id_value_5_localvariable"),
							(gt, ":character_level_party_stack_troop_id_value_5_localvariable", ":character_level_value_6"),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(else_try),
							(le, ":value_6", 0),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(try_end),
					(try_end),
					(try_begin),
						(le, ":value_6", 0),
						(try_begin),
							(eq, "$bt_terrain_strategy_state", 1),
							(call_script, "script_wm_troop_type_depend_train", "p_main_party", 100),
							(assign, ":value_6", "$temp_party_troop_03"),
						(else_try),
							(eq, "$bt_terrain_strategy_state", 2),
							(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 100),
							(assign, ":value_6", "$temp_party_troop_03"),
						(try_end),
					(try_end),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(call_script, "script_bt_multi_spawn", 21, ":value_6", ":value_2", 1, 5, ":value_4"),
						(call_script, "script_bt_multi_spawn", 22, ":value_6", ":value_2", 1, 5, ":value_4"),
						(call_script, "script_bt_multi_spawn", 23, ":value_6", ":value_2", 1, 6, ":value_4"),
						(call_script, "script_bt_multi_spawn", 24, ":value_6", ":value_2", 1, 6, ":value_4"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(call_script, "script_bt_multi_spawn", 51, ":value_6", ":value_3", -1, 5, ":value_4"),
						(call_script, "script_bt_multi_spawn", 52, ":value_6", ":value_3", -1, 5, ":value_4"),
						(call_script, "script_bt_multi_spawn", 53, ":value_6", ":value_3", -1, 6, ":value_4"),
						(call_script, "script_bt_multi_spawn", 54, ":value_6", ":value_3", -1, 6, ":value_4"),
					(try_end),
				(else_try),
					(eq, "$battle_tile_type", 6),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(set_show_messages, 0),
					(store_mul, ":value_4", 60, "$bt_scale_mult"),
					(val_div, ":value_4", 100),
					(val_div, ":value_4", 4),
					(set_show_messages, 1),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(assign, ":value_5", "p_ally_casualties"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(assign, ":value_5", "p_enemy_casualties"),
					(try_end),
					(assign, ":value_6", 0),
					(party_get_num_companion_stacks, ":num_companion_stacks_value_5", ":value_5"),
					(try_for_range, ":localvariable", 0, ":num_companion_stacks_value_5"),
						(party_stack_get_troop_id, ":party_stack_troop_id_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_troop_id_value_5_localvariable", "trp_army_size_troop"),
						(neg|troop_is_hero, ":party_stack_troop_id_value_5_localvariable"),
						(party_stack_get_size, ":party_stack_size_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_size_value_5_localvariable", 0),
						(neg|troop_is_guarantee_horse, ":party_stack_troop_id_value_5_localvariable"),
						(neg|troop_is_guarantee_ranged, ":party_stack_troop_id_value_5_localvariable"),
						(try_begin),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(is_between, ":character_level_value_6", 25, 28),
						(else_try),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(neg|is_between, ":character_level_value_6", 25, 28),
							(store_character_level, ":character_level_party_stack_troop_id_value_5_localvariable", ":party_stack_troop_id_value_5_localvariable"),
							(is_between, ":character_level_party_stack_troop_id_value_5_localvariable", 25, 28),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(else_try),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(lt, ":character_level_value_6", 25),
							(store_character_level, ":character_level_party_stack_troop_id_value_5_localvariable", ":party_stack_troop_id_value_5_localvariable"),
							(gt, ":character_level_party_stack_troop_id_value_5_localvariable", ":character_level_value_6"),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(else_try),
							(le, ":value_6", 0),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(try_end),
					(try_end),
					(try_begin),
						(le, ":value_6", 0),
						(try_begin),
							(eq, "$bt_terrain_strategy_state", 1),
							(call_script, "script_wm_troop_type_depend_train", "p_main_party", 100),
							(assign, ":value_6", "$temp_party_troop_04"),
						(else_try),
							(eq, "$bt_terrain_strategy_state", 2),
							(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 100),
							(assign, ":value_6", "$temp_party_troop_04"),
						(try_end),
					(try_end),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(call_script, "script_bt_multi_spawn", 21, ":value_6", ":value_2", 1, 0, ":value_4"),
						(call_script, "script_bt_multi_spawn", 22, ":value_6", ":value_2", 1, 1, ":value_4"),
						(call_script, "script_bt_multi_spawn", 23, ":value_6", ":value_2", 1, 2, ":value_4"),
						(call_script, "script_bt_multi_spawn", 24, ":value_6", ":value_2", 1, 3, ":value_4"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(call_script, "script_bt_multi_spawn", 51, ":value_6", ":value_3", -1, 0, ":value_4"),
						(call_script, "script_bt_multi_spawn", 52, ":value_6", ":value_3", -1, 1, ":value_4"),
						(call_script, "script_bt_multi_spawn", 53, ":value_6", ":value_3", -1, 2, ":value_4"),
						(call_script, "script_bt_multi_spawn", 54, ":value_6", ":value_3", -1, 3, ":value_4"),
					(try_end),
				(else_try),
					(eq, "$battle_tile_type", 0),
					(this_or_next|eq, "$battle_tactics_type", 5),
					(this_or_next|eq, "$battle_tactics_type", 2),
					(eq, "$battle_tactics_type", 1),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(assign, ":value_7", 30),
					(try_begin),
						(eq, "$battle_tactics_type", 5),
						(assign, ":value_7", 60),
					(try_end),
					(set_show_messages, 0),
					(store_mul, ":value_4", ":value_7", "$bt_scale_mult"),
					(val_div, ":value_4", 100),
					(val_div, ":value_4", 2),
					(set_show_messages, 1),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(assign, ":value_5", "p_ally_casualties"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(assign, ":value_5", "p_enemy_casualties"),
					(try_end),
					(assign, ":value_6", 0),
					(party_get_num_companion_stacks, ":num_companion_stacks_value_5", ":value_5"),
					(try_for_range, ":localvariable", 0, ":num_companion_stacks_value_5"),
						(party_stack_get_troop_id, ":party_stack_troop_id_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_troop_id_value_5_localvariable", "trp_army_size_troop"),
						(neg|troop_is_hero, ":party_stack_troop_id_value_5_localvariable"),
						(party_stack_get_size, ":party_stack_size_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_size_value_5_localvariable", 0),
						(troop_is_guarantee_horse, ":party_stack_troop_id_value_5_localvariable"),
						(try_begin),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(is_between, ":character_level_value_6", 25, 28),
						(else_try),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(neg|is_between, ":character_level_value_6", 25, 28),
							(store_character_level, ":character_level_party_stack_troop_id_value_5_localvariable", ":party_stack_troop_id_value_5_localvariable"),
							(is_between, ":character_level_party_stack_troop_id_value_5_localvariable", 25, 28),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(else_try),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(lt, ":character_level_value_6", 25),
							(store_character_level, ":character_level_party_stack_troop_id_value_5_localvariable", ":party_stack_troop_id_value_5_localvariable"),
							(gt, ":character_level_party_stack_troop_id_value_5_localvariable", ":character_level_value_6"),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(else_try),
							(le, ":value_6", 0),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(try_end),
					(try_end),
					(try_begin),
						(le, ":value_6", 0),
						(try_begin),
							(eq, "$bt_terrain_strategy_state", 1),
							(call_script, "script_wm_troop_type_depend_train", "p_main_party", 100),
							(assign, ":value_6", "$temp_party_troop_06"),
						(else_try),
							(eq, "$bt_terrain_strategy_state", 2),
							(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 100),
							(assign, ":value_6", "$temp_party_troop_06"),
						(try_end),
					(try_end),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_5", ":value_6", ":value_2", 1, 4, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_8", ":value_6", ":value_2", 1, 7, ":value_4"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_5", ":value_6", ":value_3", -1, 4, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_8", ":value_6", ":value_3", -1, 7, ":value_4"),
					(try_end),
				(else_try),
					(eq, "$battle_tile_type", 0),
					(eq, "$battle_tactics_type", 6),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(assign, ":value_7", 63),
					(set_show_messages, 0),
					(store_mul, ":value_4", ":value_7", "$bt_scale_mult"),
					(val_div, ":value_4", 100),
					(val_div, ":value_4", 9),
					(set_show_messages, 1),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(assign, ":value_5", "p_ally_casualties"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(assign, ":value_5", "p_enemy_casualties"),
					(try_end),
					(assign, ":value_6", 0),
					(party_get_num_companion_stacks, ":num_companion_stacks_value_5", ":value_5"),
					(try_for_range, ":localvariable", 0, ":num_companion_stacks_value_5"),
						(party_stack_get_troop_id, ":party_stack_troop_id_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_troop_id_value_5_localvariable", "trp_army_size_troop"),
						(neg|troop_is_hero, ":party_stack_troop_id_value_5_localvariable"),
						(party_stack_get_size, ":party_stack_size_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_size_value_5_localvariable", 0),
						(troop_is_guarantee_horse, ":party_stack_troop_id_value_5_localvariable"),
						(try_begin),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(is_between, ":character_level_value_6", 25, 28),
						(else_try),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(neg|is_between, ":character_level_value_6", 25, 28),
							(store_character_level, ":character_level_party_stack_troop_id_value_5_localvariable", ":party_stack_troop_id_value_5_localvariable"),
							(is_between, ":character_level_party_stack_troop_id_value_5_localvariable", 25, 28),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(else_try),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(lt, ":character_level_value_6", 25),
							(store_character_level, ":character_level_party_stack_troop_id_value_5_localvariable", ":party_stack_troop_id_value_5_localvariable"),
							(gt, ":character_level_party_stack_troop_id_value_5_localvariable", ":character_level_value_6"),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(else_try),
							(le, ":value_6", 0),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(try_end),
					(try_end),
					(try_begin),
						(le, ":value_6", 0),
						(try_begin),
							(eq, "$bt_terrain_strategy_state", 1),
							(call_script, "script_wm_troop_type_depend_train", "p_main_party", 100),
							(assign, ":value_6", "$temp_party_troop_06"),
						(else_try),
							(eq, "$bt_terrain_strategy_state", 2),
							(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 100),
							(assign, ":value_6", "$temp_party_troop_06"),
						(try_end),
					(try_end),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_1", ":value_6", ":value_2", 1, 0, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_2", ":value_6", ":value_2", 1, 1, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_3", ":value_6", ":value_2", 1, 2, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_4", ":value_6", ":value_2", 1, 3, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_5", ":value_6", ":value_2", 1, 4, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_6", ":value_6", ":value_2", 1, 5, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_7", ":value_6", ":value_2", 1, 6, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_8", ":value_6", ":value_2", 1, 7, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_9", ":value_6", ":value_2", 1, 8, ":value_4"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_1", ":value_6", ":value_3", -1, 0, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_2", ":value_6", ":value_3", -1, 1, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_3", ":value_6", ":value_3", -1, 2, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_4", ":value_6", ":value_3", -1, 3, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_5", ":value_6", ":value_3", -1, 4, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_6", ":value_6", ":value_3", -1, 5, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_7", ":value_6", ":value_3", -1, 6, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_8", ":value_6", ":value_3", -1, 7, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_9", ":value_6", ":value_3", -1, 8, ":value_4"),
					(try_end),
				(else_try),
					(eq, "$battle_tile_type", 0),
					(this_or_next|eq, "$battle_tactics_type", 8),
					(eq, "$battle_tactics_type", 3),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(play_sound, "snd_command_horn_2d"),
					(assign, ":value_7", 50),
					(try_begin),
						(eq, "$battle_tactics_type", 8),
						(assign, ":value_7", 70),
					(try_end),
					(set_show_messages, 0),
					(store_mul, ":value_4", ":value_7", "$bt_scale_mult"),
					(val_div, ":value_4", 100),
					(val_div, ":value_4", 2),
					(set_show_messages, 1),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(assign, ":value_5", "p_ally_casualties"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(assign, ":value_5", "p_enemy_casualties"),
					(try_end),
					(assign, ":value_6", 0),
					(party_get_num_companion_stacks, ":num_companion_stacks_value_5", ":value_5"),
					(try_for_range, ":localvariable", 0, ":num_companion_stacks_value_5"),
						(party_stack_get_troop_id, ":party_stack_troop_id_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_troop_id_value_5_localvariable", "trp_army_size_troop"),
						(neg|troop_is_hero, ":party_stack_troop_id_value_5_localvariable"),
						(party_stack_get_size, ":party_stack_size_value_5_localvariable", ":value_5", ":localvariable"),
						(gt, ":party_stack_size_value_5_localvariable", 0),
						(neg|troop_is_guarantee_horse, ":party_stack_troop_id_value_5_localvariable"),
						(troop_is_guarantee_ranged, ":party_stack_troop_id_value_5_localvariable"),
						(try_begin),
							(gt, ":value_6", 0),
							(store_character_level, ":character_level_value_6", ":value_6"),
							(store_character_level, ":character_level_party_stack_troop_id_value_5_localvariable", ":party_stack_troop_id_value_5_localvariable"),
							(gt, ":character_level_party_stack_troop_id_value_5_localvariable", ":character_level_value_6"),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(else_try),
							(le, ":value_6", 0),
							(assign, ":value_6", ":party_stack_troop_id_value_5_localvariable"),
						(try_end),
					(try_end),
					(try_begin),
						(le, ":value_6", 0),
						(try_begin),
							(eq, "$bt_terrain_strategy_state", 1),
							(call_script, "script_wm_troop_type_depend_train", "p_main_party", 100),
							(assign, ":value_6", "$temp_party_troop_03"),
						(else_try),
							(eq, "$bt_terrain_strategy_state", 2),
							(call_script, "script_wm_troop_type_depend_train", "$wm_target_party", 100),
							(assign, ":value_6", "$temp_party_troop_03"),
						(try_end),
					(try_end),
					(try_begin),
						(eq, "$bt_terrain_strategy_state", 1),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_6", ":value_6", ":value_2", 1, 5, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_player_entry_7", ":value_6", ":value_2", 1, 6, ":value_4"),
					(else_try),
						(eq, "$bt_terrain_strategy_state", 2),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_6", ":value_6", ":value_3", -1, 5, ":value_4"),
						(call_script, "script_bt_multi_spawn", "$bt_enemy_entry_7", ":value_6", ":value_3", -1, 6, ":value_4"),
					(try_end),
				(try_end),
			(try_end)
		]),

		(1.0, 0.0, 1.0,
		[
			(eq, "$bt_terrain_strategy_dmg_start", 1),
			(gt, "$molda_battle_scn_prop_pos_dmg_timer", 0)
		],

		[
			(try_begin),
				(eq, "$bt_terrain_strategy_dmg_start", 1),
				(gt, "$molda_battle_scn_prop_pos_dmg_timer", 0),
				(try_begin),
					(eq, "$battle_tile_type", 2),
					(gt, "$molda_battle_scn_prop_pos_dmg_timer", 0),
					(call_script, "script_molda_battle_scn_fallrock_dmg", "spr_rock_dynamic_physics"),
					(val_sub, "$molda_battle_scn_prop_pos_dmg_timer", 1),
				(else_try),
					(eq, "$battle_tile_type", 3),
					(try_begin),
						(eq, "$molda_battle_scn_prop_pos_dmg_timer", 1),
						(play_sound, "snd_Flood"),
						(entry_point_get_position, 5, 91),
						(prop_instance_animate_to_position, "$river_flood_prop_id", 5, 500),
						(val_sub, "$molda_battle_scn_prop_pos_dmg_timer", 1),
					(else_try),
						(gt, "$molda_battle_scn_prop_pos_dmg_timer", 1),
						(set_fixed_point_multiplier, 1000),
						(try_for_agents, ":var_1"),
							(agent_is_alive, ":var_1"),
							(agent_get_position, 3, ":var_1"),
							(position_get_z, ":position_z_3", 3),
							(prop_instance_get_position, 4, "$river_flood_prop_id"),
							(position_get_z, ":position_z_4", 4),
							(val_add, ":position_z_4", 50),
							(try_begin),
								(le, ":position_z_3", ":position_z_4"),
								(store_agent_hit_points, ":agent_hit_points_var_1_1", ":var_1", 1),
								(store_sub, ":value", ":agent_hit_points_var_1_1", 17),
								(try_begin),
									(le, ":value", 0),
									(agent_set_hit_points, ":var_1", 1, 1),
									(agent_deliver_damage_to_agent, ":var_1", ":var_1", 1255),
								(else_try),
									(agent_set_hit_points, ":var_1", ":value", 1),
								(try_end),
							(try_end),
						(try_end),
						(val_sub, "$molda_battle_scn_prop_pos_dmg_timer", 1),
					(try_end),
				(else_try),
					(eq, "$battle_tile_type", 4),
					(gt, "$molda_battle_scn_prop_pos_dmg_timer", 0),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 101),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 102),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 103),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 104),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 105),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 106),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 107),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 108),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 109),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 110),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 111),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 112),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 113),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 114),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 115),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 116),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 117),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 118),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 119),
					(call_script, "script_molda_battle_scn_fireworks_dmg", 120),
					(val_sub, "$molda_battle_scn_prop_pos_dmg_timer", 1),
				(try_end),
			(try_end)
		]),

		(5.0, 0.0, ti_once,
		[
			(eq, "$battle_tile_type", 4),
			(le, "$molda_battle_scn_prop_pos_dmg_timer", 0)
		],

		[
			(try_begin),
				(eq, "$battle_tile_type", 4),
				(le, "$molda_battle_scn_prop_pos_dmg_timer", 0),
				(call_script, "script_molda_prop_visible_on_off", "spr_Village_fire_big", 0),
			(try_end)
		]),

		(0.0, 4.0, ti_once,
		[],

		[
			(assign, reg11, "$count_player_team"),
			(assign, reg12, "$count_enemy_team"),
			(display_message, "str_battle_st_count_mess"),
			(call_script, "script_tact_modifier"),
			(try_begin),
				(eq, "$tutorial_battle", 1),
				(le, "$main_q_step", 0),
				(dialog_box, "str_tutorial_mess_battle", "str_box_note"),
			(try_end)
		]),

		(0.0, 2.0, ti_once,
		[
			(eq, "$bt_need_ai_fast_decision", 1)
		],

		[
			(set_show_messages, 0),
			(try_begin),
				(eq, "$bt_need_ai_fast_decision", 2),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_slot_eq, "trp_slot_formation_enemy", ":value", 0),
					(troop_set_slot, "trp_slot_formation_enemy", ":value", 3),
				(try_end),
			(else_try),
				(eq, "$bt_need_ai_fast_decision", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_enemy", ":value", 3),
				(try_end),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 10.0, ti_once,
		[],

		[
			(try_begin),
				(set_show_messages, 0),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_slot_eq, "trp_slot_formation_enemy", ":value", 0),
					(troop_set_slot, "trp_slot_formation_enemy", ":value", 3),
				(try_end),
				(set_show_messages, 1),
				(try_begin),
					(neq, "$low_encounter_battle", 1),
					(eq, "$enemy_has_defence", 1),
					(eq, "$player_already_in_battle", 0),
					(display_message, "str_bt_player_is_attack"),
				(try_end),
			(try_end)
		]),

		(30.0, 0.0, 0.0,
		[
			(ge, "$bt_trigger_10", 1)
		],

		[
			(try_begin),
				(set_show_messages, 0),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_slot_eq, "trp_slot_formation_enemy", ":value", 0),
					(troop_set_slot, "trp_slot_formation_enemy", ":value", 3),
				(try_end),
				(set_show_messages, 1),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(this_or_next|eq, "$player_already_in_battle", 0),
			(eq, "$enemy_already_in_battle", 0)
		],

		[
			(set_show_messages, 0),
			(store_add, ":value", "trp_slot_formation_enemy", 1),
			(try_for_range, ":troop", "trp_slot_formation_ally", ":value"),
				(try_begin),
					(eq, ":troop", "trp_slot_formation_ally"),
					(assign, ":value_2", "$bt_player_team"),
				(else_try),
					(assign, ":value_2", "$bt_enemy_team"),
				(try_end),
				(try_for_range, ":number", 0, 9),
					(team_get_movement_order, ":movement_order_value_2_number", ":value_2", ":number"),
					(store_add, ":value_3", ":number", 46),
					(troop_get_slot, ":troop_value_3", ":troop", ":value_3"),
					(try_begin),
						(lt, "$bt_trigger_10", 1),
						(eq, ":troop", "trp_slot_formation_enemy"),
						(eq, ":number", 8),
						(team_give_order, ":value_2", ":number", 11),
					(else_try),
						(eq, ":troop", "trp_slot_formation_enemy"),
						(eq, "$enemy_has_defence", 1),
						(eq, "$player_already_in_battle", 0),
						(team_give_order, ":value_2", ":number", 11),
					(else_try),
						(eq, ":troop_value_3", 0),
						(team_give_order, ":value_2", ":number", 11),
					(else_try),
						(this_or_next|eq, ":troop_value_3", 11),
						(this_or_next|eq, ":troop_value_3", 7),
						(eq, ":troop_value_3", 4),
						(neq, ":movement_order_value_2_number", 2),
						(team_give_order, ":value_2", ":number", 2),
					(else_try),
						(eq, ":movement_order_value_2_number", 1),
						(team_give_order, ":value_2", ":number", 11),
					(else_try),
						(neq, ":troop_value_3", 11),
						(neq, ":troop_value_3", 4),
						(neq, ":troop_value_3", 5),
						(neq, ":troop_value_3", 7),
						(eq, ":movement_order_value_2_number", 2),
						(team_give_order, ":value_2", ":number", 11),
					(try_end),
				(try_end),
			(try_end),
			(set_show_messages, 1)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(ge, "$bt_trigger_tick", 10),
				(assign, "$bt_trigger_tick", 1),
				(val_add, "$bt_trigger_10", 1),
			(else_try),
				(val_add, "$bt_trigger_tick", 1),
			(try_end),
			(try_begin),
				(call_script, "script_bt_mission_slot_init"),
				(call_script, "script_bt_mission_slot_save"),
				(call_script, "script_bt_base_dist_div_by_member_count"),
				(try_begin),
					(try_begin),
						(eq, "$enemy_has_defence", 1),
						(try_begin),
							(this_or_next|ge, "$bt_trigger_10", 10),
							(gt, "$player_team_avg_distant", 15000),
							(assign, "$player_already_in_battle", 1),
							(assign, "$enemy_already_in_battle", 1),
						(else_try),
							(this_or_next|gt, "$g_enemy_team_dead_num", 8),
							(gt, "$g_player_team_dead_num", 8),
							(assign, "$player_already_in_battle", 1),
							(assign, "$enemy_already_in_battle", 1),
						(try_end),
					(else_try),
						(eq, "$enemy_has_defence", 0),
						(try_begin),
							(this_or_next|ge, "$bt_trigger_10", 3),
							(gt, "$player_team_avg_distant", 10000),
							(assign, "$player_already_in_battle", 1),
						(try_end),
						(try_begin),
							(this_or_next|ge, "$bt_trigger_10", 3),
							(gt, "$enemy_team_avg_distant", 12000),
							(assign, "$enemy_already_in_battle", 1),
						(try_end),
					(try_end),
				(try_end),
				(try_begin),
					(eq, "$bt_just_battle", 1),
					(assign, "$player_already_in_battle", 1),
					(assign, "$enemy_already_in_battle", 1),
					(lt, "$bt_trigger_10", 11),
					(assign, "$bt_trigger_10", 11),
				(try_end),
				(try_begin),
					(store_add, ":value", "trp_slot_formation_enemy", 1),
					(try_for_range, ":troop", "trp_slot_formation_ally", ":value"),
						(try_for_range, ":number", 0, 9),
							(store_add, ":value_2", ":number", 55),
							(troop_get_slot, ":troop_value_2", ":troop", ":value_2"),
							(try_begin),
								(gt, ":troop_value_2", 0),
								(val_sub, ":troop_value_2", 1),
								(troop_set_slot, ":troop", ":value_2", ":troop_value_2"),
							(try_end),
							(le, ":troop_value_2", 0),
							(store_add, ":value_3", ":number", 37),
							(troop_get_slot, ":troop_value_3", ":troop", ":value_3"),
							(gt, ":troop_value_3", 0),
							(store_add, ":value_4", ":number", 10),
							(troop_get_slot, ":troop_value_4", ":troop", ":value_4"),
							(gt, ":troop_value_4", 0),
							(agent_is_alive, ":troop_value_4"),
							(agent_is_human, ":troop_value_4"),
							(store_add, ":value_5", ":number", 46),
							(troop_get_slot, ":troop_value_5", ":troop", ":value_5"),
							(try_begin),
								(eq, ":troop", "trp_slot_formation_ally"),
								(assign, ":value_6", "trp_slot_division_ally"),
								(assign, ":value_7", "$bt_player_team"),
								(assign, ":value_8", "$player_moral_level"),
								(assign, ":value_9", "$player_train_level"),
								(assign, ":value_10", "$player_scale_rate"),
							(else_try),
								(assign, ":value_6", "trp_slot_division_enemy"),
								(assign, ":value_7", "$bt_enemy_team"),
								(assign, ":value_8", "$enemy_moral_level"),
								(assign, ":value_9", "$enemy_train_level"),
								(assign, ":value_10", "$enemy_scale_rate"),
							(try_end),
							(store_add, ":value_11", ":number", 1),
							(troop_get_slot, ":value_6_value_11", ":value_6", ":value_11"),
							(troop_get_slot, ":value_6_value_11_prisoner_of_party", ":value_6_value_11", slot_troop_prisoner_of_party),
							(assign, ":value_12", 0),
							(try_begin),
								(eq, "$bt_runaway_impossible", 2),
								(try_begin),
									(eq, ":troop", "trp_slot_formation_ally"),
									(eq, "$bt_terrain_strategy_state", 1),
									(assign, ":value_12", 1),
								(else_try),
									(eq, ":troop", "trp_slot_formation_enemy"),
									(eq, "$bt_terrain_strategy_state", 2),
									(assign, ":value_12", 1),
								(try_end),
							(else_try),
								(eq, "$bt_runaway_impossible", 1),
								(assign, ":value_12", 1),
							(try_end),
							(assign, ":value_13", 0),
							(try_begin),
								(eq, ":value_12", 0),
								(store_sub, ":value_14", 110, ":value_9"),
								(set_show_messages, 0),
								(val_div, ":value_14", 5),
								(val_mul, ":value_14", "$bt_scale_mult"),
								(val_div, ":value_14", 100),
								(val_mul, ":value_14", ":value_10"),
								(val_div, ":value_14", 100),
								(set_show_messages, 1),
								(try_begin),
									(eq, ":troop_value_5", 12),
									(assign, ":value_13", 1),
								(else_try),
									(neq, ":number", 8),
									(le, ":troop_value_3", ":value_14"),
									(store_random_in_range, ":random_in_range_0_100", 0, 100),
									(gt, ":random_in_range_0_100", ":value_8"),
									(store_add, ":value_15", ":number", 46),
									(troop_set_slot, ":troop", ":value_15", 12),
									(assign, ":value_13", 1),
								(try_end),
							(try_end),
							(eq, ":value_13", 0),
							(assign, ":value_16", 0),
							(try_begin),
								(eq, "$bt_charge_only", 1),
								(assign, ":value_16", 1),
							(else_try),
								(eq, "$bt_charge_only", 3),
								(eq, ":troop", "trp_slot_formation_enemy"),
								(assign, ":value_16", 1),
							(else_try),
								(eq, "$bt_charge_only", 2),
								(this_or_next|eq, ":number", 4),
								(eq, ":number", 7),
								(try_begin),
									(eq, ":troop", "trp_slot_formation_ally"),
									(eq, "$bt_terrain_strategy_state", 1),
									(assign, ":value_16", 1),
								(else_try),
									(eq, ":troop", "trp_slot_formation_enemy"),
									(eq, "$bt_terrain_strategy_state", 2),
									(assign, ":value_16", 1),
								(try_end),
							(try_end),
							(try_begin),
								(eq, ":value_16", 1),
								(store_add, ":value_15", ":number", 46),
								(troop_set_slot, ":troop", ":value_15", 4),
								(set_show_messages, 0),
								(team_give_order, ":value_7", ":number", 2),
								(set_show_messages, 1),
							(try_end),
							(eq, ":value_16", 0),
							(store_add, ":value_17", ":number", 37),
							(troop_get_slot, ":value_6_value_17", ":value_6", ":value_17"),
							(try_begin),
								(eq, ":troop_value_5", 3),
								(try_begin),
									(gt, ":value_6_value_17", 2),
									(call_script, "script_bt_trace_enemy_division_start", ":troop", ":value_7", ":number", ":value_6_value_11", -1),
									(store_add, ":value_5", ":number", 46),
									(troop_get_slot, ":troop_value_5", ":troop", ":value_5"),
									(troop_set_slot, ":value_6", ":value_17", 0),
								(try_end),
							(else_try),
								(gt, ":value_6_value_17", 0),
								(troop_set_slot, ":value_6", ":value_17", 0),
							(try_end),
							(assign, "$bt_first_order", 0),
							(try_begin),
								(ge, ":value_6_value_11_prisoner_of_party", 4),
								(call_script, "script_bt_archer_shooting_count", ":troop", ":value_7", ":number"),
							(try_end),
							(try_begin),
								(try_begin),
									(eq, ":troop", "trp_slot_formation_enemy"),
									(eq, "$player_spawn_is_zero", 1),
									(le, "$minimap_ally_team_num", 25),
									(store_add, ":value_15", ":number", 46),
									(troop_set_slot, ":troop", ":value_15", 4),
									(assign, "$bt_first_order", 1),
									(set_show_messages, 0),
									(team_give_order, ":value_7", ":number", 2),
									(set_show_messages, 1),
								(else_try),
									(eq, ":troop", "trp_slot_formation_ally"),
									(eq, "$enemy_spawn_is_zero", 1),
									(le, "$minimap_enemy_team_num", 25),
									(store_add, ":value_15", ":number", 46),
									(troop_set_slot, ":troop", ":value_15", 4),
									(assign, "$bt_first_order", 1),
									(set_show_messages, 0),
									(team_give_order, ":value_7", ":number", 2),
									(set_show_messages, 1),
								(else_try),
									(ge, ":value_6_value_11_prisoner_of_party", 4),
									(neq, ":troop_value_5", 5),
									(eq, "$bt_arc_shooting_mode", 1),
									(call_script, "script_bt_archer_shooting_execute", ":troop", ":value_7", ":number"),
									(assign, "$bt_first_order", 1),
								(else_try),
									(ge, ":value_6_value_11_prisoner_of_party", 4),
									(this_or_next|eq, ":troop_value_5", 9),
									(eq, ":troop_value_5", 5),
									(call_script, "script_bt_archer_moveto_high_start", ":troop", ":value_7", ":number", ":value_6_value_11", ":value_6_value_11_prisoner_of_party", ":troop_value_4"),
									(assign, "$bt_first_order", 1),
								(else_try),
									(ge, ":value_6_value_11_prisoner_of_party", 4),
									(this_or_next|eq, ":troop_value_5", 13),
									(eq, ":troop_value_5", 1),
									(assign, "$bt_first_order", 1),
								(else_try),
									(ge, ":value_6_value_11_prisoner_of_party", 4),
									(this_or_next|eq, ":troop_value_5", 8),
									(this_or_next|eq, ":troop_value_5", 2),
									(eq, ":troop_value_5", 6),
									(call_script, "script_bt_archer_avoid_in_formation", ":troop", ":value_7", ":number", ":troop_value_5", ":value_6_value_11_prisoner_of_party", ":troop_value_4", ":value_6_value_11"),
								(try_end),
							(try_end),
							(try_begin),
								(eq, "$bt_first_order", 0),
								(try_begin),
									(eq, ":troop_value_5", 13),
								(else_try),
									(eq, ":troop_value_5", 0),
								(else_try),
									(eq, ":troop_value_5", 11),
									(store_add, ":value_15", ":number", 46),
									(troop_set_slot, ":troop", ":value_15", 14),
									(call_script, "script_bt_none_need_charge", ":troop", ":value_7", ":number", ":troop_value_4", ":value_6_value_11_prisoner_of_party"),
								(else_try),
									(eq, ":troop_value_5", 1),
								(else_try),
									(eq, ":troop_value_5", 14),
									(call_script, "script_bt_none_need_charge", ":troop", ":value_7", ":number", ":troop_value_4", ":value_6_value_11_prisoner_of_party"),
								(else_try),
									(eq, ":troop_value_5", 2),
									(call_script, "script_bt_trace_enemy_division_retry", ":troop", ":value_7", ":number", ":value_6_value_11_prisoner_of_party", ":troop_value_4", ":value_6_value_11"),
								(else_try),
									(eq, ":troop_value_5", 7),
									(call_script, "script_bt_trace_enemy_division_start", ":troop", ":value_7", ":number", ":value_6_value_11", -1),
									(call_script, "script_bt_near_enemy_check_for_charge", ":troop", ":value_7", ":number", ":value_6_value_11_prisoner_of_party", ":troop_value_4"),
								(else_try),
									(eq, ":troop_value_5", 10),
									(call_script, "script_bt_tactical_move_retry", ":troop", ":value_7", ":number", ":value_6_value_11", ":troop_value_4", ":value_6_value_11_prisoner_of_party"),
								(else_try),
									(eq, ":troop_value_5", 6),
									(call_script, "script_bt_archer_backup_retry", ":troop", ":value_7", ":number", ":value_6_value_11_prisoner_of_party", ":value_6_value_11", ":troop_value_4"),
								(else_try),
									(eq, ":troop_value_5", 8),
									(call_script, "script_bt_archer_moveto_high_retry", ":troop", ":value_7", ":number", ":value_6_value_11_prisoner_of_party", ":value_6_value_11", ":troop_value_4"),
								(else_try),
									(eq, ":troop_value_5", 3),
									(store_random_in_range, ":random_in_range_0_5", 0, 5),
									(try_begin),
										(eq, ":troop", "trp_slot_formation_enemy"),
										(eq, "$enemy_has_defence", 1),
										(eq, "$player_already_in_battle", 0),
									(else_try),
										(eq, ":troop", "trp_slot_formation_enemy"),
										(this_or_next|eq, ":value_6_value_11_prisoner_of_party", 2),
										(eq, ":value_6_value_11_prisoner_of_party", 3),
										(eq, "$player_already_in_battle", 0),
									(else_try),
										(eq, ":troop", "trp_slot_formation_enemy"),
										(this_or_next|eq, ":value_6_value_11_prisoner_of_party", 2),
										(eq, ":value_6_value_11_prisoner_of_party", 3),
										(eq, "$player_already_in_battle", 1),
										(le, "$bt_trigger_10", 4),
										(call_script, "script_bt_tactical_move_start", ":troop", ":value_7", ":number", ":value_6_value_11", ":value_6_value_11_prisoner_of_party", ":troop_value_4"),
									(else_try),
										(ge, ":value_6_value_11_prisoner_of_party", 4),
										(call_script, "script_bt_archer_moveto_high_start", ":troop", ":value_7", ":number", ":value_6_value_11", ":value_6_value_11_prisoner_of_party", ":troop_value_4"),
									(else_try),
										(eq, ":troop", "trp_slot_formation_enemy"),
										(eq, "$player_already_in_battle", 0),
										(this_or_next|eq, ":number", 0),
										(this_or_next|eq, ":number", 3),
										(this_or_next|eq, ":number", 4),
										(eq, ":number", 7),
										(lt, ":random_in_range_0_5", 3),
										(call_script, "script_bt_tactical_move_start", ":troop", ":value_7", ":number", ":value_6_value_11", ":value_6_value_11_prisoner_of_party", ":troop_value_4"),
									(else_try),
										(eq, ":troop", "trp_slot_formation_ally"),
										(this_or_next|eq, ":value_6_value_11_prisoner_of_party", 2),
										(eq, ":value_6_value_11_prisoner_of_party", 3),
										(this_or_next|eq, "$enemy_already_in_battle", 0),
										(le, "$bt_trigger_10", 2),
										(call_script, "script_bt_tactical_move_start", ":troop", ":value_7", ":number", ":value_6_value_11", ":value_6_value_11_prisoner_of_party", ":troop_value_4"),
									(else_try),
										(eq, ":troop", "trp_slot_formation_ally"),
										(eq, "$enemy_already_in_battle", 0),
										(this_or_next|eq, ":number", 0),
										(this_or_next|eq, ":number", 3),
										(this_or_next|eq, ":number", 4),
										(eq, ":number", 7),
										(lt, ":random_in_range_0_5", 3),
										(call_script, "script_bt_tactical_move_start", ":troop", ":value_7", ":number", ":value_6_value_11", ":value_6_value_11_prisoner_of_party", ":troop_value_4"),
									(else_try),
										(this_or_next|eq, ":value_6_value_11_prisoner_of_party", 2),
										(eq, ":value_6_value_11_prisoner_of_party", 3),
										(eq, "$player_already_in_battle", 1),
										(eq, "$enemy_already_in_battle", 1),
										(gt, "$bt_trigger_10", 4),
										(store_add, ":value_15", ":number", 46),
										(troop_set_slot, ":troop", ":value_15", 4),
										(set_show_messages, 0),
										(team_give_order, ":value_7", ":number", 2),
										(set_show_messages, 1),
									(else_try),
										(eq, ":number", 8),
										(le, "$bt_trigger_10", 4),
										(call_script, "script_bt_archer_moveto_high_start", ":troop", ":value_7", ":number", ":value_6_value_11", ":value_6_value_11_prisoner_of_party", ":troop_value_4"),
									(else_try),
										(call_script, "script_bt_trace_enemy_division_start", ":troop", ":value_7", ":number", ":value_6_value_11", -1),
									(try_end),
								(try_end),
							(try_end),
						(try_end),
					(try_end),
				(try_end),
				(try_begin),
					(try_for_agents, ":var_29"),
						(agent_is_alive, ":var_29"),
						(agent_is_human, ":var_29"),
						(agent_get_team, ":team_var_29", ":var_29"),
						(agent_get_troop_id, ":troop_id_var_29", ":var_29"),
						(gt, ":troop_id_var_29", 0),
						(try_begin),
							(eq, ":team_var_29", "$bt_player_team"),
							(assign, ":value_18", "$player_start_entry"),
							(assign, ":value_19", "$player_retreat_entry_begin"),
							(assign, ":value_20", "$player_retreat_entry_end"),
							(assign, ":troop", "trp_slot_formation_ally"),
						(else_try),
							(assign, ":value_18", "$enemy_start_entry"),
							(assign, ":value_19", "$enemy_retreat_entry_begin"),
							(assign, ":value_20", "$enemy_retreat_entry_end"),
							(assign, ":troop", "trp_slot_formation_enemy"),
						(try_end),
						(agent_get_slot, ":number", ":var_29", 23),
						(store_add, ":value_21", ":number", 46),
						(troop_get_slot, ":troop_value_5", ":troop", ":value_21"),
						(troop_get_slot, ":value_6_value_11_prisoner_of_party", ":troop_id_var_29", slot_troop_prisoner_of_party),
						(try_begin),
							(eq, ":troop_value_5", 12),
							(neg|agent_slot_ge, ":var_29", 25, 1),
							(agent_set_slot, ":var_29", slot_agent_walker_occupation, 30),
							(agent_set_speed_limit, ":var_29", 20),
							(agent_clear_scripted_mode, ":var_29"),
							(agent_start_running_away, ":var_29"),
							(agent_set_slot, ":var_29", slot_agent_is_in_scripted_mode, 0),
						(try_end),
						(neq, ":troop_value_5", 12),
						(assign, ":value_22", 0),
						(try_begin),
							(agent_slot_ge, ":var_29", 25, 2),
							(agent_get_slot, ":var_29_walker_occupation", ":var_29", slot_agent_walker_occupation),
							(val_sub, ":var_29_walker_occupation", 1),
							(agent_set_slot, ":var_29", slot_agent_walker_occupation, ":var_29_walker_occupation"),
							(assign, ":value_22", 1),
						(else_try),
							(agent_slot_ge, ":var_29", 25, 1),
							(agent_set_slot, ":var_29", slot_agent_walker_occupation, 0),
							(agent_stop_running_away, ":var_29"),
							(agent_slot_eq, ":var_29", slot_agent_is_in_scripted_mode, 1),
							(agent_clear_scripted_mode, ":var_29"),
							(agent_set_slot, ":var_29", slot_agent_is_in_scripted_mode, 0),
							(agent_force_rethink, ":var_29"),
						(try_end),
						(try_begin),
							(agent_slot_eq, ":var_29", slot_agent_is_in_scripted_mode, 1),
							(this_or_next|eq, ":troop_value_5", 11),
							(this_or_next|eq, ":troop_value_5", 4),
							(eq, ":troop_value_5", 7),
							(agent_clear_scripted_mode, ":var_29"),
							(agent_force_rethink, ":var_29"),
							(agent_set_slot, ":var_29", slot_agent_is_in_scripted_mode, 0),
						(try_end),
						(try_begin),
							(ge, ":value_6_value_11_prisoner_of_party", 4),
							(this_or_next|eq, ":troop_value_5", 13),
							(eq, ":troop_value_5", 1),
						(else_try),
							(neq, "$bt_runaway_impossible", 1),
							(ge, ":value_6_value_11_prisoner_of_party", 4),
							(neg|agent_slot_ge, ":var_29", 25, 1),
							(this_or_next|eq, ":troop_value_5", 8),
							(this_or_next|eq, ":troop_value_5", 9),
							(this_or_next|eq, ":troop_value_5", 2),
							(this_or_next|eq, ":troop_value_5", 5),
							(eq, ":troop_value_5", 6),
							(agent_ai_set_aggressiveness, ":var_29", 199),
							(assign, ":value_23", 0),
							(agent_get_wielded_item, ":wielded_item_var_29_0", ":var_29", 0),
							(try_begin),
								(gt, ":wielded_item_var_29_0", 0),
								(item_get_type, ":type_wielded_item_var_29_0", ":wielded_item_var_29_0"),
								(this_or_next|eq, ":type_wielded_item_var_29_0", 2),
								(this_or_next|eq, ":type_wielded_item_var_29_0", 3),
								(eq, ":type_wielded_item_var_29_0", 4),
								(assign, ":value_23", 1),
							(try_end),
							(try_begin),
								(eq, ":value_23", 1),
								(assign, ":var_41", 10000000),
								(agent_get_position, 25, ":var_29"),
								(try_for_range, ":var_42", ":value_19", ":value_20"),
									(entry_point_get_position, 22, ":var_42"),
									(get_distance_between_positions, ":distance_between_positions_22_25", 22, 25),
									(try_begin),
										(lt, ":distance_between_positions_22_25", ":var_41"),
										(assign, ":var_44", ":var_42"),
									(try_end),
								(try_end),
								(entry_point_get_position, 22, ":var_44"),
								(agent_clear_scripted_mode, ":var_29"),
								(agent_set_slot, ":var_29", slot_agent_is_in_scripted_mode, 0),
								(agent_start_running_away, ":var_29", 22),
								(agent_set_slot, ":var_29", slot_agent_walker_occupation, 2),
								(agent_set_speed_limit, ":var_29", 20),
								(assign, ":value_22", 1),
								(assign, ":value_24", 0),
								(troop_get_inventory_capacity, ":inventory_capacity_troop_id_var_29", ":troop_id_var_29"),
								(try_for_range, ":localvariable", 0, ":inventory_capacity_troop_id_var_29"),
									(troop_get_inventory_slot, ":inventory_slot_troop_id_var_29_localvariable", ":troop_id_var_29", ":localvariable"),
									(gt, ":inventory_slot_troop_id_var_29_localvariable", 0),
									(item_get_type, ":type_wielded_item_var_29_0", ":inventory_slot_troop_id_var_29_localvariable"),
									(this_or_next|eq, ":type_wielded_item_var_29_0", 8),
									(this_or_next|eq, ":type_wielded_item_var_29_0", 9),
									(this_or_next|eq, ":type_wielded_item_var_29_0", 10),
									(this_or_next|eq, ":type_wielded_item_var_29_0", 16),
									(eq, ":type_wielded_item_var_29_0", 17),
									(assign, ":value_24", ":inventory_slot_troop_id_var_29_localvariable"),
								(try_end),
								(try_begin),
									(gt, ":value_24", 0),
									(agent_set_wielded_item, ":var_29", ":value_24"),
								(try_end),
							(try_end),
						(try_end),
						(agent_get_horse, ":horse_var_29", ":var_29"),
						(try_begin),
							(neq, "$battle_tactics_type", 3),
							(neq, "$battle_tactics_type", 8),
							(neq, "$battle_tile_type", 2),
							(neq, "$battle_tile_type", 3),
							(neq, "$battle_tile_type", 5),
							(neq, "$battle_tile_type", 9),
							(neq, "$battle_tile_type", 10),
							(eq, ":value_22", 0),
							(lt, ":horse_var_29", 0),
							(neg|agent_slot_ge, ":var_29", 25, 1),
							(neq, ":troop_value_5", 0),
							(team_get_movement_order, ":movement_order_team_var_29_number", ":team_var_29", ":number"),
							(try_begin),
								(neq, ":troop_value_5", 5),
								(eq, ":movement_order_team_var_29_number", 2),
								(agent_set_speed_limit, ":var_29", 11),
							(else_try),
								(entry_point_get_position, 22, ":value_18"),
								(agent_get_position, 25, ":var_29"),
								(agent_get_scripted_destination, 26, ":var_29"),
								(get_distance_between_positions, ":distance_between_positions_25_22", 25, 22),
								(get_distance_between_positions, ":distance_between_positions_26_22", 26, 22),
								(store_add, ":value_21", ":number", 28),
								(troop_get_slot, ":troop_value_21", ":troop", ":value_21"),
								(val_sub, ":troop_value_21", 150),
								(try_begin),
									(gt, ":distance_between_positions_26_22", ":distance_between_positions_25_22"),
									(try_begin),
										(gt, ":distance_between_positions_25_22", ":troop_value_21"),
										(assign, ":value_25", 9),
									(else_try),
										(assign, ":value_25", 13),
									(try_end),
								(else_try),
									(try_begin),
										(gt, ":distance_between_positions_25_22", ":troop_value_21"),
										(assign, ":value_25", 13),
									(else_try),
										(assign, ":value_25", 9),
									(try_end),
									(try_begin),
										(eq, "$low_encounter_battle", 1),
										(val_add, ":value_25", 3),
									(try_end),
								(try_end),
								(try_begin),
									(ge, ":value_6_value_11_prisoner_of_party", 4),
									(this_or_next|eq, ":troop_value_5", 8),
									(this_or_next|eq, ":troop_value_5", 2),
									(eq, ":troop_value_5", 6),
									(val_add, ":value_25", 2),
								(try_end),
								(agent_set_speed_limit, ":var_29", ":value_25"),
							(try_end),
						(try_end),
					(try_end),
				(try_end),
				(assign, ":var_55", 0),
				(assign, ":var_56", 0),
				(store_add, ":value", "trp_slot_formation_enemy", 1),
				(try_for_range, ":troop", "trp_slot_formation_ally", ":value"),
					(try_for_range, ":number", 0, 8),
						(store_add, ":value_3", ":number", 37),
						(troop_get_slot, ":troop_value_3", ":troop", ":value_3"),
						(try_begin),
							(le, ":troop_value_3", 0),
							(try_begin),
								(eq, ":troop", "trp_slot_formation_ally"),
								(assign, ":value_6", "trp_slot_division_ally"),
								(assign, ":value_26", 1),
								(assign, ":value_27", "$bt_player_team"),
								(assign, ":value_28", "$player_start_entry"),
							(else_try),
								(assign, ":value_6", "trp_slot_division_enemy"),
								(assign, ":value_26", -1),
								(assign, ":value_27", "$bt_enemy_team"),
								(assign, ":value_28", "$enemy_start_entry"),
							(try_end),
							(store_add, ":value_29", ":number", 28),
							(troop_get_slot, ":value_6_value_29", ":value_6", ":value_29"),
							(try_begin),
								(le, ":value_6_value_29", 0),
								(eq, ":troop", "trp_slot_formation_ally"),
								(val_add, ":var_55", 1),
							(else_try),
								(le, ":value_6_value_29", 0),
								(val_add, ":var_56", 1),
							(try_end),
							(store_add, ":value_30", ":number", 19),
							(troop_get_slot, ":value_6_value_30", ":value_6", ":value_30"),
							(try_begin),
								(gt, ":value_6_value_29", 0),
								(this_or_next|eq, "$low_encounter_battle", 1),
								(eq, "$battle_tactics_type", 7),
								(troop_set_slot, ":value_6", ":value_29", 0),
							(else_try),
								(gt, ":value_6_value_29", 0),
								(le, ":value_6_value_30", 7),
								(troop_set_slot, ":value_6", ":value_29", 0),
							(else_try),
								(gt, ":value_6_value_29", 0),
								(gt, ":value_6_value_30", 7),
								(store_add, ":value_31", ":number", 1),
								(troop_get_slot, ":value_11", ":value_6", ":value_31"),
								(gt, ":value_11", 0),
								(store_add, ":value_32", ":number", 10),
								(troop_get_slot, ":value_6_value_32", ":value_6", ":value_32"),
								(gt, ":value_6_value_32", 0),
								(val_sub, ":value_6_value_29", 1),
								(troop_set_slot, ":value_6", ":value_29", ":value_6_value_29"),
								(store_div, ":value_33", ":value_6_value_30", 2),
								(call_script, "script_bt_multi_spawn", ":value_28", ":value_11", ":value_27", ":value_26", ":number", ":value_33"),
								(call_script, "script_bt_multi_spawn", ":value_28", ":value_6_value_32", ":value_27", ":value_26", ":number", ":value_33"),
								(store_add, ":value_34", ":number", 46),
								(troop_set_slot, ":troop", ":value_34", 3),
								(assign, "$need_herald_fix", 1),
							(try_end),
						(try_end),
					(try_end),
				(try_end),
				(try_begin),
					(ge, ":var_55", 6),
					(assign, "$player_spawn_is_zero", 1),
				(try_end),
				(try_begin),
					(ge, ":var_56", 6),
					(assign, "$enemy_spawn_is_zero", 1),
				(try_end),
			(try_end)
		]),

		(-20.0, 0.0, ti_once,
		[],

		[
			(call_script, "script_dead_num_slot_reset"),
			(assign, "$ply_respawn", 10),
			(assign, "$g_player_team_dead_num", 0),
			(assign, "$g_enemy_team_dead_num", 0),
			(assign, "$bt_kill_count_player", 0),
			(assign, "$bt_kill_count_ally_hero", 0),
			(assign, "$bt_kill_count_enemy_hero", 0),
			(assign, "$bt_kill_count_ply_inf", 0),
			(assign, "$bt_kill_count_ply_arc", 0),
			(assign, "$bt_kill_count_ply_cav", 0),
			(assign, "$bt_kill_count_ene_inf", 0),
			(assign, "$bt_kill_count_ene_arc", 0),
			(assign, "$bt_kill_count_ene_cav", 0),
			(try_for_range, ":troop", "trp_townsman", "trp_tournament_master"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_npc1", "trp_kingdom_1_lord"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_elite_troops_01", "trp_elite_troops_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(try_for_range, ":troop", "trp_tt_lady_01_01", "trp_tt_lady_end"),
				(troop_set_slot, ":troop", slot_troop_player_debt, 0),
			(try_end),
			(store_add, ":value", "$enemy_army_size", "$player_army_size"),
			(try_begin),
				(gt, ":value", 10000),
				(assign, "$g_player_team_respawn", 0),
				(assign, "$g_enemy_team_respawn", 0),
			(else_try),
				(assign, "$g_player_team_respawn", 20),
				(assign, "$g_enemy_team_respawn", 20),
			(try_end),
			(get_player_agent_no, "$bt_player_agent"),
			(agent_get_team, "$bt_player_team", "$bt_player_agent"),
			(try_begin),
				(eq, "$bt_player_team", 0),
				(assign, "$bt_enemy_team", 1),
			(else_try),
				(eq, "$bt_player_team", 1),
				(assign, "$bt_enemy_team", 0),
			(try_end),
			(get_player_agent_no, ":player_agent_no"),
			(store_agent_hit_points, ":agent_hit_points_player_agent_no_1", ":player_agent_no", 1),
			(try_begin),
				(troop_get_slot, ":player_love_interests_end", "trp_player", slot_troop_love_interests_end),
				(val_mul, ":player_love_interests_end", 5),
				(val_add, ":agent_hit_points_player_agent_no_1", ":player_love_interests_end"),
			(try_end),
			(agent_set_max_hit_points, ":player_agent_no", ":agent_hit_points_player_agent_no_1", 1),
			(call_script, "script_wm_simp_troop_health_sett", "trp_player"),
			(assign, ":var_6", reg23),
			(agent_set_hit_points, ":player_agent_no", ":var_6", 0),
			(store_agent_hit_points, reg8, ":player_agent_no", 1),
			(display_message, "str_ply_hp_disp")
		]),

		(-25.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(set_show_messages, 0),
			(try_begin),
				(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
				(troop_is_guarantee_horse, ":troop_id_trigger_param_1"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(agent_get_team, ":team_trigger_param_1", ":trigger_param_1"),
				(eq, ":team_player_agent_no", ":team_trigger_param_1"),
				(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":trigger_param_1", ":troop_id_trigger_param_1"),
			(try_end),
			(set_show_messages, 1)
		]),

		(0.0, 0.0, ti_once,
		[],

		[
			(assign, "$sex_cam_on", 0),
			(assign, "$deathcam_on", 0),
			(assign, "$deathcam_death_pos_x", 0),
			(assign, "$deathcam_death_pos_y", 0),
			(assign, "$deathcam_death_pos_z", 0),
			(assign, "$deathcam_mouse_last_x", 5000),
			(assign, "$deathcam_mouse_last_y", 3750),
			(assign, "$deathcam_mouse_notmoved_x", 5000),
			(assign, "$deathcam_mouse_notmoved_y", 3750),
			(assign, "$deathcam_mouse_notmoved_counter", 0),
			(assign, "$deathcam_total_rotx", 0),
			(assign, "$deathcam_sensitivity_x", 400),
			(assign, "$deathcam_sensitivity_y", 300)
		]),

		(0.0, 0.0, ti_once,
		[
			(eq, "$deathcam_on", 2)
		],

		[
			(presentation_set_duration, 0),
			(set_fixed_point_multiplier, 10000),
			(assign, "$deathcam_on", 1),
			(display_message, "str_death_cam_1", 0x00ff2222),
			(display_message, "str_death_cam_2"),
			(display_message, "str_death_cam_3"),
			(display_message, "str_death_cam_4"),
			(mission_cam_get_position, 1),
			(position_get_x, reg3, 1),
			(position_get_y, reg4, 1),
			(position_get_z, reg5, 1),
			(assign, "$deathcam_death_pos_x", reg3),
			(assign, "$deathcam_death_pos_y", reg4),
			(assign, "$deathcam_death_pos_z", reg5),
			(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
			(init_position, 47),
			(position_copy_origin, 47, 1),
			(position_rotate_z, 47, ":position_rotation_around_z_1"),
			(mission_cam_set_mode, 1, 0, 0),
			(mission_cam_set_position, 47),
			(try_begin),
				(eq, "$formation_battle_mode", 1),
				(try_for_range, ":number", 0, 9),
					(store_add, ":value", ":number", 46),
					(troop_set_slot, "trp_slot_formation_ally", ":value", 3),
				(try_end),
			(else_try),
				(team_give_order, "$bt_player_team", 9, 2),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1),
			(this_or_next|game_key_is_down, 0),
			(this_or_next|game_key_is_down, 1),
			(this_or_next|game_key_is_down, 2),
			(this_or_next|game_key_is_down, 3),
			(this_or_next|key_is_down, 42),
			(this_or_next|key_is_down, 29),
			(this_or_next|key_is_down, 74),
			(this_or_next|key_is_down, 78),
			(key_clicked, 199)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(mission_cam_get_position, 47),
			(try_begin),
				(key_clicked, 199),
				(position_set_x, 47, "$deathcam_death_pos_x"),
				(position_set_y, 47, "$deathcam_death_pos_y"),
				(position_set_z, 47, "$deathcam_death_pos_z"),
			(try_end),
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(assign, ":var_3", 0),
			(try_begin),
				(game_key_is_down, 0),
				(val_add, ":var_2", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 1),
				(val_add, ":var_2", -10),
			(try_end),
			(try_begin),
				(game_key_is_down, 3),
				(val_add, ":var_1", 10),
			(try_end),
			(try_begin),
				(game_key_is_down, 2),
				(val_add, ":var_1", -10),
			(try_end),
			(try_begin),
				(key_is_down, 42),
				(val_add, ":var_3", 10),
			(try_end),
			(try_begin),
				(key_is_down, 29),
				(val_add, ":var_3", -10),
			(try_end),
			(try_begin),
				(key_is_down, 57),
				(val_mul, ":var_1", 4),
				(val_mul, ":var_2", 4),
				(val_mul, ":var_3", 2),
			(try_end),
			(position_move_x, 47, ":var_1"),
			(position_move_y, 47, ":var_2"),
			(position_move_z, 47, ":var_3"),
			(mission_cam_set_position, 47),
			(try_begin),
				(key_is_down, 74),
				(ge, "$deathcam_sensitivity_x", 4),
				(ge, "$deathcam_sensitivity_y", 3),
				(val_sub, "$deathcam_sensitivity_x", 4),
				(val_sub, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25"),
				(try_end),
			(else_try),
				(key_is_down, 78),
				(val_add, "$deathcam_sensitivity_x", 4),
				(val_add, "$deathcam_sensitivity_y", 3),
				(store_mod, reg6, "$deathcam_sensitivity_x", 100),
				(store_mod, reg7, "$deathcam_sensitivity_y", 75),
				(try_begin),
					(eq, reg6, 0),
					(eq, reg7, 0),
					(assign, reg8, "$deathcam_sensitivity_x"),
					(assign, reg9, "$deathcam_sensitivity_y"),
					(display_message, "str_death_cam_sen25_plus"),
				(try_end),
			(try_end)
		]),

		(0.0, 0.0, 0.0,
		[
			(eq, "$deathcam_on", 1)
		],

		[
			(set_fixed_point_multiplier, 10000),
			(neg|is_presentation_active, "prsnt_battle"),
			(mouse_get_position, 1),
			(position_get_x, reg1, 1),
			(position_get_y, reg2, 1),
			(mission_cam_get_position, 47),
			(assign, ":value", 0),
			(try_begin),
				(try_begin),
					(eq, reg1, "$deathcam_mouse_last_x"),
					(eq, reg2, "$deathcam_mouse_last_y"),
					(this_or_next|neq, reg1, "$deathcam_mouse_notmoved_x"),
					(neq, reg2, "$deathcam_mouse_notmoved_y"),
					(val_add, "$deathcam_mouse_notmoved_counter", 1),
					(try_begin),
						(ge, "$deathcam_mouse_notmoved_counter", 15),
						(assign, "$deathcam_mouse_notmoved_counter", 0),
						(assign, "$deathcam_mouse_notmoved_x", reg1),
						(assign, "$deathcam_mouse_notmoved_y", reg2),
					(try_end),
				(else_try),
					(assign, ":value", 1),
					(assign, "$deathcam_mouse_notmoved_counter", 0),
				(try_end),
				(assign, "$deathcam_mouse_last_x", reg1),
				(assign, "$deathcam_mouse_last_y", reg2),
			(try_end),
			(eq, ":value", 1),
			(store_sub, ":value_2", reg1, "$deathcam_mouse_notmoved_x"),
			(store_sub, ":value_3", reg2, "$deathcam_mouse_notmoved_y"),
			(val_mul, ":value_2", "$deathcam_sensitivity_x"),
			(val_mul, ":value_3", "$deathcam_sensitivity_y"),
			(val_clamp, ":value_2", -80000, 80001),
			(val_clamp, ":value_3", -60000, 60001),
			(store_mul, ":value_4", "$deathcam_total_rotx", -1),
			(position_rotate_x_floating, 47, ":value_4"),
			(position_rotate_y, 47, 90),
			(position_rotate_x_floating, 47, ":value_2"),
			(position_rotate_y, 47, -90),
			(position_rotate_x_floating, 47, "$deathcam_total_rotx"),
			(position_rotate_x_floating, 47, ":value_3"),
			(val_add, "$deathcam_total_rotx", ":value_3"),
			(mission_cam_set_position, 47)
		]),

		(1.0, 3.0, 3.0,
		[
			(eq, "$deathcam_on", 0),
			(main_hero_fallen)
		],

		[
			(assign, ":value", 1),
			(assign, ":value_2", -1),
			(try_for_agents, ":var_3"),
				(gt, "$ply_respawn", 0),
				(eq, ":value", 1),
				(agent_is_human, ":var_3"),
				(agent_is_alive, ":var_3"),
				(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
				(neg|troop_is_hero, ":troop_id_var_3"),
				(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
				(ge, ":character_level_troop_id_var_3", "$player_respawn_lvl_ge"),
				(agent_get_team, ":team_var_3", ":var_3"),
				(eq, ":team_var_3", "$bt_player_team"),
				(agent_get_horse, ":horse_var_3", ":var_3"),
				(lt, ":horse_var_3", 0),
				(call_script, "script_troop_type_sett", ":troop_id_var_3"),
				(lt, "$troop_gender_type", 10),
				(assign, ":value_3", 0),
				(try_begin),
					(eq, "$player_respawn_class_type", 0),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 1),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(else_try),
					(eq, "$player_respawn_class_type", 2),
					(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
					(troop_is_guarantee_ranged, ":troop_id_var_3"),
					(assign, ":value_3", 1),
				(try_end),
				(eq, ":value_3", 1),
				(agent_get_position, 6, ":var_3"),
				(set_spawn_position, 6),
				(spawn_agent, "trp_player"),
				(assign, "$bt_player_agent", reg0),
				(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
				(agent_set_hit_points, "$bt_player_agent", ":agent_hit_points_var_3_1", 1),
				(str_store_troop_name, 8, ":troop_id_var_3"),
				(assign, reg8, ":agent_hit_points_var_3_1"),
				(display_message, "str_resp_troop_name", 0x0000ff00),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, "$bt_player_agent", ":number"),
				(try_end),
				(set_show_messages, 1),
				(call_script, "script_agent_troop_export_item", ":troop_id_var_3"),
				(try_begin),
					(gt, "$troop_ek_item_0", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_0"),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 2),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 3),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 4),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 8),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 9),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 10),
						(this_or_next|eq, ":type_l_troop_ek_item_0", 16),
						(eq, ":type_l_troop_ek_item_0", 17),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_0"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_1", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_begin),
						(item_get_type, ":type_l_troop_ek_item_0", "$troop_ek_item_1"),
						(eq, ":type_l_troop_ek_item_0", 7),
						(agent_set_wielded_item, "$bt_player_agent", "$troop_ek_item_1"),
					(try_end),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_2", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_2"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_item_3", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_item_3"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_head", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_head"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_body", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_body"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_foot", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_foot"),
				(try_end),
				(try_begin),
					(gt, "$troop_ek_gloves", 0),
					(agent_equip_item, "$bt_player_agent", "$troop_ek_gloves"),
				(try_end),
				(agent_set_team, "$bt_player_agent", "$bt_player_team"),
				(agent_set_division, "$bt_player_agent", 8),
				(val_add, "$count_player_team", 1),
				(val_add, "$last_add_spawn_count", 1),
				(val_sub, "$ply_respawn", 1),
				(assign, ":value", 0),
				(assign, ":value_2", ":var_3"),
			(try_end),
			(try_begin),
				(ge, ":value_2", 0),
				(set_show_messages, 0),
				(try_for_range, ":number", 1, 1620),
					(agent_unequip_item, ":value_2", ":number"),
				(try_end),
				(agent_set_visibility, ":value_2", 0),
				(remove_agent, ":value_2"),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 0),
				(agent_get_horse, ":horse_l_bt_player_agent", "$bt_player_agent"),
				(gt, ":horse_l_bt_player_agent", 0),
				(set_show_messages, 0),
				(agent_set_visibility, ":horse_l_bt_player_agent", 0),
				(agent_set_hit_points, ":horse_l_bt_player_agent", 0, 0),
				(agent_deliver_damage_to_agent, "$bt_player_agent", ":horse_l_bt_player_agent", 1255),
				(set_show_messages, 1),
			(try_end),
			(try_begin),
				(eq, ":value", 1),
				(presentation_set_duration, 0),
				(set_fixed_point_multiplier, 10000),
				(assign, "$deathcam_on", 1),
				(display_message, "str_death_cam_1", 0x00ff2222),
				(display_message, "str_death_cam_2"),
				(display_message, "str_death_cam_3"),
				(display_message, "str_death_cam_4"),
				(mission_cam_get_position, 1),
				(position_get_x, reg3, 1),
				(position_get_y, reg4, 1),
				(position_get_z, reg5, 1),
				(assign, "$deathcam_death_pos_x", reg3),
				(assign, "$deathcam_death_pos_y", reg4),
				(assign, "$deathcam_death_pos_z", reg5),
				(position_get_rotation_around_z, ":position_rotation_around_z_1", 1),
				(init_position, 47),
				(position_copy_origin, 47, 1),
				(position_rotate_z, 47, ":position_rotation_around_z_1"),
				(mission_cam_set_mode, 1, 0, 0),
				(mission_cam_set_position, 47),
				(try_begin),
					(eq, "$formation_battle_mode", 1),
					(try_for_range, ":number_2", 0, 9),
						(store_add, ":value_4", ":number_2", 46),
						(troop_set_slot, "trp_slot_formation_ally", ":value_4", 3),
					(try_end),
				(else_try),
					(team_give_order, "$bt_player_team", 9, 2),
				(try_end),
			(try_end)
		]),

		(-28.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(assign, ":var_4", reg0),
			(agent_is_human, ":trigger_param_1"),
			(agent_get_troop_id, ":troop_id_trigger_param_1", ":trigger_param_1"),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(agent_is_human, ":trigger_param_2"),
			(agent_get_troop_id, ":troop_id_trigger_param_2", ":trigger_param_2"),
			(agent_get_team, ":team_trigger_param_2", ":trigger_param_2"),
			(assign, ":value", 0),
			(try_begin),
				(lt, ":trigger_param_3", 2),
				(assign, ":value", 2),
			(try_end),
			(assign, ":value_2", 0),
			(try_begin),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(val_add, ":value", "$last_modifier_player"),
					(assign, ":value_2", "$player_moral_level"),
				(else_try),
					(val_add, ":value", "$last_modifier_enemy"),
					(assign, ":value_2", "$enemy_moral_level"),
				(try_end),
			(try_end),
			(val_sub, ":value_2", 30),
			(try_begin),
				(ge, ":value_2", 20),
				(val_div, ":value_2", 20),
				(try_begin),
					(gt, ":value_2", 3),
					(assign, ":value_2", 3),
				(try_end),
				(val_add, ":value", ":value_2"),
			(try_end),
			(assign, ":value_3", 0),
			(try_begin),
				(ge, ":troop_id_trigger_param_2", 0),
				(gt, ":troop_id_trigger_param_1", 0),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(try_begin),
					(eq, ":team_trigger_param_2", ":team_player_agent_no"),
					(assign, ":value_4", "$player_has_iron"),
				(else_try),
					(assign, ":value_4", "$enemy_has_iron"),
				(try_end),
				(try_begin),
					(gt, ":var_4", 0),
					(item_get_type, ":type_var_4", ":var_4"),
					(try_begin),
						(eq, ":team_trigger_param_2", ":team_player_agent_no"),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$player_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$player_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$player_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$player_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$player_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$player_arquebus"),
						(try_end),
					(else_try),
						(try_begin),
							(eq, ":type_var_4", 2),
							(val_add, ":value", "$enemy_onehand"),
						(else_try),
							(eq, ":type_var_4", 3),
							(val_add, ":value", "$enemy_twohand"),
						(else_try),
							(eq, ":type_var_4", 4),
							(val_add, ":value", "$enemy_polearm"),
						(else_try),
							(eq, ":type_var_4", 8),
							(val_add, ":value", "$enemy_bow"),
						(else_try),
							(eq, ":type_var_4", 9),
							(val_add, ":value", "$enemy_crossbow"),
						(else_try),
							(this_or_next|eq, ":type_var_4", 17),
							(eq, ":type_var_4", 16),
							(val_add, ":value", "$enemy_arquebus"),
						(try_end),
					(try_end),
					(try_begin),
						(neg|troop_is_hero, ":troop_id_trigger_param_2"),
						(neg|troop_is_hero, ":troop_id_trigger_param_1"),
						(this_or_next|eq, ":type_var_4", 8),
						(this_or_next|eq, ":type_var_4", 9),
						(this_or_next|eq, ":type_var_4", 16),
						(eq, ":type_var_4", 17),
						(assign, ":value_5", 2),
						(try_begin),
							(this_or_next|eq, ":var_4", 1361),
							(eq, ":var_4", 1363),
							(assign, ":value_5", 3),
						(else_try),
							(eq, ":var_4", 1362),
							(assign, ":value_5", 4),
						(else_try),
							(eq, ":type_var_4", 9),
							(assign, ":value_5", 5),
						(else_try),
							(this_or_next|eq, ":type_var_4", 16),
							(eq, ":type_var_4", 17),
							(assign, ":value_5", 7),
						(try_end),
						(store_random_in_range, ":random_in_range_0_10", 0, 10),
						(lt, ":random_in_range_0_10", ":value_5"),
						(assign, ":value_3", 1),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value_4", 1),
					(val_add, ":value", 2),
				(try_end),
			(try_end),
			(try_begin),
				(eq, ":value_3", 1),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 200),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(neg|troop_is_hero, ":troop_id_trigger_param_1"),
				(ge, ":trigger_param_3", 50),
				(store_agent_hit_points, ":agent_hit_points_trigger_param_1_1", ":trigger_param_1", 1),
				(lt, ":agent_hit_points_trigger_param_1_1", 10),
				(agent_get_position, 1, ":trigger_param_1"),
				(get_distance_between_positions, ":distance_between_positions_1_0", 1, 0),
				(is_between, ":distance_between_positions_1_0", 150, 185),
				(agent_get_item_slot, ":item_slot_trigger_param_1_4", ":trigger_param_1", 4),
				(try_begin),
					(ge, ":item_slot_trigger_param_1_4", 1),
					(agent_unequip_item, ":trigger_param_1", ":item_slot_trigger_param_1_4"),
				(try_end),
				(agent_equip_item, ":trigger_param_1", "itm_headless_neck"),
				(particle_system_burst, "psys_game_blood_4", 0, 125),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", 300),
				(set_trigger_result, ":trigger_param_3"),
			(else_try),
				(gt, ":value", 0),
				(set_trigger_result, -1),
				(val_add, ":trigger_param_3", ":value"),
				(set_trigger_result, ":trigger_param_3"),
			(try_end)
		]),

		(-19.0, 0.0, ti_once,
		[],

		[
			(party_get_current_terrain, ":current_terrain_main_party", "p_main_party"),
			(store_random_in_range, ":random_in_range_0_5", 0, 5),
			(try_begin),
				(eq, "$glob_weather", 2),
				(neq, ":current_terrain_main_party", 5),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 1, ":random_in_range_50_100"),
			(else_try),
				(this_or_next|eq, ":random_in_range_0_5", 1),
				(eq, ":random_in_range_0_5", 2),
				(eq, ":current_terrain_main_party", 4),
				(store_random_in_range, ":random_in_range_50_100", 50, 100),
				(store_random_in_range, ":random_in_range_25_65", 25, 65),
				(set_global_haze_amount, ":random_in_range_25_65"),
				(set_rain, 2, ":random_in_range_50_100"),
			(else_try),
				(set_global_haze_amount, 0),
				(set_rain, 0, 0),
			(try_end)
		]),

		(0.0, 2.0, 13.0,
		[],

		[
			(try_for_agents, ":var_1"),
				(agent_is_alive, ":var_1"),
				(agent_is_human, ":var_1"),
				(agent_get_troop_id, ":troop_id_var_1", ":var_1"),
				(agent_get_horse, ":horse_var_1", ":var_1"),
				(assign, ":value", 0),
				(try_begin),
					(eq, "$siege_horse_kill_need", 1),
					(assign, ":value", 1),
				(try_end),
				(try_begin),
					(this_or_next|troop_is_guarantee_horse, ":troop_id_var_1"),
					(troop_is_hero, ":troop_id_var_1"),
					(lt, ":horse_var_1", 0),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ct_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_5_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_6_cav_ele"),
					(this_or_next|eq, ":troop_id_var_1", "trp_jungle_4_cav"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_5_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_ww_c_6_2"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_03_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_00"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_01"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_02"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_03"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_04"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_05"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_06"),
					(this_or_next|eq, ":troop_id_var_1", "trp_tt_lord_27_07"),
					(this_or_next|eq, ":troop_id_var_1", "trp_temp_commander_fac_27"),
					(eq, ":troop_id_var_1", "trp_ex_npc_008"),
					(try_for_range, ":number", 0, 4),
						(agent_get_wielded_item, ":wielded_item_var_1_number", ":var_1", ":number"),
						(gt, ":wielded_item_var_1_number", 0),
						(eq, ":wielded_item_var_1_number", 983),
						(agent_unequip_item, ":var_1", ":wielded_item_var_1_number"),
						(agent_equip_item, ":var_1", 932),
						(agent_set_wielded_item, ":var_1", 932),
					(try_end),
				(try_end),
				(try_begin),
					(eq, ":value", 1),
					(gt, ":horse_var_1", 0),
					(set_show_messages, 0),
					(agent_set_visibility, ":horse_var_1", 0),
					(agent_set_hit_points, ":horse_var_1", 0, 0),
					(agent_deliver_damage_to_agent, ":var_1", ":horse_var_1", 1255),
					(set_show_messages, 1),
				(try_end),
			(try_end)
		]),

		(1.0, 2.0, 0.0,
		[
			(eq, "$need_herald_fix", 1)
		],

		[
			(try_begin),
				(eq, "$need_herald_fix", 1),
				(call_script, "script_battle_tile_agent_division_reset"),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_for_agents, ":var_3"),
					(agent_is_human, ":var_3"),
					(agent_is_alive, ":var_3"),
					(agent_slot_eq, ":var_3", slot_agent_bought_horse, 0),
					(agent_get_troop_id, ":troop_id_var_3", ":var_3"),
					(agent_get_team, ":team_var_3", ":var_3"),
					(try_begin),
						(troop_is_hero, ":troop_id_var_3"),
						(agent_set_hit_points, ":var_3", 100, 0),
						(try_begin),
							(eq, "$battle_tactics_type", 4),
							(try_begin),
								(eq, "$bt_terrain_strategy_state", 1),
								(eq, ":var_3", ":player_agent_no"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(else_try),
								(eq, "$bt_terrain_strategy_state", 2),
								(eq, ":troop_id_var_3", "$enemy_commander"),
								(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
								(val_mul, ":agent_hit_points_var_3_1", 10),
								(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
								(agent_set_hit_points, ":var_3", 100, 0),
							(try_end),
						(try_end),
						(try_begin),
							(is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
							(agent_get_horse, ":horse_var_3", ":var_3"),
							(gt, ":horse_var_3", 0),
							(store_attribute_level, ":attribute_level_troop_id_var_3_0", ":troop_id_var_3", 0),
							(store_mul, ":value", ":attribute_level_troop_id_var_3_0", 5),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(neg|is_between, ":troop_id_var_3", "trp_tt_lord_01_00", "trp_tt_lord_end"),
						(try_begin),
							(eq, ":team_var_3", ":team_player_agent_no"),
							(assign, ":value_2", "$player_lightarmor"),
							(assign, ":value_3", "$player_heavyarmor"),
							(assign, ":value_4", "$player_horsearmor"),
							(assign, ":value_5", "$player_ammo"),
							(assign, ":value_6", "$player_has_finewood"),
							(assign, ":value_7", "$player_has_iron"),
							(assign, ":value_8", "$player_has_horse"),
							(assign, ":value_9", "$player_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(else_try),
							(assign, ":value_2", "$enemy_lightarmor"),
							(assign, ":value_3", "$enemy_heavyarmor"),
							(assign, ":value_4", "$enemy_horsearmor"),
							(assign, ":value_5", "$enemy_ammo"),
							(assign, ":value_6", "$enemy_has_finewood"),
							(assign, ":value_7", "$enemy_has_iron"),
							(assign, ":value_8", "$enemy_has_horse"),
							(assign, ":value_9", "$enemy_leadership_skill"),
							(assign, ":value_10", "$enemy_train_level"),
						(try_end),
						(store_agent_hit_points, ":agent_hit_points_var_3_1", ":var_3", 1),
						(try_begin),
							(gt, ":value_10", 3),
							(val_div, ":value_10", 3),
							(val_add, ":agent_hit_points_var_3_1", ":value_10"),
						(try_end),
						(try_begin),
							(this_or_next|eq, "$battle_tactics_type", 8),
							(this_or_next|eq, "$battle_tactics_type", 3),
							(eq, "$battle_tactics_type", 4),
							(agent_get_slot, ":var_3_23", ":var_3", 23),
							(try_begin),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(eq, ":var_3_23", 8),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 200),
							(else_try),
								(eq, "$battle_tactics_type", 4),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_sub, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(eq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 1),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(else_try),
								(this_or_next|eq, "$battle_tactics_type", 8),
								(eq, "$battle_tactics_type", 3),
								(neq, ":team_var_3", ":team_player_agent_no"),
								(eq, "$bt_terrain_strategy_state", 2),
								(val_add, ":agent_hit_points_var_3_1", 30),
							(try_end),
						(try_end),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(val_add, ":agent_hit_points_var_3_1", ":value_9"),
						(try_begin),
							(eq, "$is_siege_battle", 1),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 10),
						(try_end),
						(try_begin),
							(eq, "$molda_siege_type", 6),
							(this_or_next|eq, ":team_var_3", "$defender_team"),
							(eq, ":team_var_3", "$defender_team_2"),
							(val_add, ":agent_hit_points_var_3_1", 40),
						(try_end),
						(store_character_level, ":character_level_troop_id_var_3", ":troop_id_var_3"),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(le, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(lt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_2"),
						(else_try),
							(troop_is_guarantee_horse, ":troop_id_var_3"),
							(gt, ":character_level_troop_id_var_3", 25),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(else_try),
							(neg|troop_is_guarantee_horse, ":troop_id_var_3"),
							(neg|troop_is_guarantee_ranged, ":troop_id_var_3"),
							(val_add, ":agent_hit_points_var_3_1", ":value_3"),
						(try_end),
						(agent_get_horse, ":horse_var_3", ":var_3"),
						(try_begin),
							(gt, ":horse_var_3", 0),
							(try_begin),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_4_cav"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_5_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_jungle_6_cav_ele"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ct_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_5_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_ww_c_6_2"),
								(this_or_next|eq, ":troop_id_var_3", "trp_tt_lady_ex_05"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc3"),
								(this_or_next|eq, ":troop_id_var_3", "trp_npc6"),
								(eq, ":troop_id_var_3", "trp_ex_npc_008"),
								(assign, ":value", 300),
							(else_try),
								(eq, ":troop_id_var_3", "trp_player"),
								(assign, ":value", 100),
							(else_try),
								(assign, ":value", 150),
							(try_end),
							(try_begin),
								(eq, ":value_8", 1),
								(val_add, ":value", 50),
							(try_end),
							(val_add, ":value", ":value_4"),
							(agent_set_max_hit_points, ":horse_var_3", ":value", 1),
							(agent_set_hit_points, ":horse_var_3", 100, 0),
						(try_end),
						(try_begin),
							(this_or_next|troop_is_hero, ":troop_id_var_3"),
							(troop_is_guarantee_ranged, ":troop_id_var_3"),
							(assign, ":var_21", 20),
							(val_add, ":var_21", ":value_5"),
							(agent_set_ammo, ":var_3", 1336, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 197, ":var_21"),
							(agent_set_ammo, ":var_3", 198, ":var_21"),
							(agent_set_ammo, ":var_3", 199, ":var_21"),
							(agent_set_ammo, ":var_3", 200, ":var_21"),
							(agent_set_ammo, ":var_3", 1333, ":var_21"),
							(agent_set_ammo, ":var_3", 1334, ":var_21"),
							(try_begin),
								(eq, ":value_6", 1),
								(val_sub, ":var_21", 10),
							(try_end),
							(try_begin),
								(eq, ":value_7", 1),
								(val_add, ":var_21", 10),
							(try_end),
							(agent_set_ammo, ":var_3", 1335, ":var_21"),
							(try_begin),
								(eq, ":value_7", 1),
								(val_sub, ":var_21", 10),
							(try_end),
						(try_end),
						(agent_set_max_hit_points, ":var_3", ":agent_hit_points_var_3_1", 1),
						(try_begin),
							(troop_is_hero, ":troop_id_var_3"),
							(call_script, "script_wm_simp_troop_health_sett", ":troop_id_var_3"),
							(assign, ":var_22", reg23),
							(agent_set_hit_points, ":var_3", ":var_22", 0),
						(else_try),
							(agent_set_hit_points, ":var_3", 100, 0),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":troop_id_var_3", "trp_player"),
						(store_agent_hit_points, reg8, ":player_agent_no", 1),
						(display_message, "str_ply_hp_disp2"),
					(try_end),
					(try_for_range, ":number", 0, 8),
						(agent_get_item_slot, ":item_slot_var_3_number", ":var_3", ":number"),
						(gt, ":item_slot_var_3_number", 0),
						(try_begin),
							(this_or_next|eq, ":item_slot_var_3_number", 426),
							(this_or_next|eq, ":item_slot_var_3_number", 432),
							(this_or_next|eq, ":item_slot_var_3_number", 476),
							(this_or_next|eq, ":item_slot_var_3_number", 481),
							(this_or_next|eq, ":item_slot_var_3_number", 489),
							(this_or_next|eq, ":item_slot_var_3_number", 494),
							(this_or_next|eq, ":item_slot_var_3_number", 999),
							(this_or_next|is_between, ":item_slot_var_3_number", 1009, 1024),
							(this_or_next|is_between, ":item_slot_var_3_number", 1072, 1081),
							(this_or_next|eq, ":item_slot_var_3_number", 1325),
							(this_or_next|eq, ":item_slot_var_3_number", 1327),
							(this_or_next|eq, ":item_slot_var_3_number", 1328),
							(eq, ":item_slot_var_3_number", 1329),
							(agent_unequip_item, ":var_3", ":item_slot_var_3_number"),
							(agent_equip_item, ":var_3", ":item_slot_var_3_number"),
							(item_get_type, ":type_item_slot_var_3_number", ":item_slot_var_3_number"),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(this_or_next|eq, ":type_item_slot_var_3_number", 2),
								(this_or_next|eq, ":type_item_slot_var_3_number", 3),
								(this_or_next|eq, ":type_item_slot_var_3_number", 4),
								(this_or_next|eq, ":type_item_slot_var_3_number", 8),
								(this_or_next|eq, ":type_item_slot_var_3_number", 9),
								(this_or_next|eq, ":type_item_slot_var_3_number", 10),
								(this_or_next|eq, ":type_item_slot_var_3_number", 16),
								(eq, ":type_item_slot_var_3_number", 17),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
							(try_begin),
								(neq, ":troop_id_var_3", "trp_player"),
								(eq, ":type_item_slot_var_3_number", 7),
								(agent_set_wielded_item, ":var_3", ":item_slot_var_3_number"),
							(try_end),
						(try_end),
					(try_end),
					(agent_set_slot, ":var_3", slot_agent_bought_horse, 1),
				(try_end),
				(assign, "$need_herald_fix", 0),
			(try_end)
		]),

		(0.0, 200.0, ti_once,
		[
			(eq, "$tutorial_battle", 0)
		],

		[
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_for_agents, ":var_5"),
				(agent_is_human, ":var_5"),
				(agent_is_alive, ":var_5"),
				(agent_get_team, ":team_var_5", ":var_5"),
				(try_begin),
					(eq, ":team_var_5", ":team_player_agent_no"),
					(val_add, ":var_1", 1),
				(else_try),
					(val_add, ":var_2", 1),
				(try_end),
			(try_end),
			(store_mul, ":value", ":var_2", 2),
			(store_random_in_range, ":random_in_range_0_4", 0, 4),
			(try_begin),
				(eq, ":random_in_range_0_4", 0),
				(gt, ":var_1", ":value"),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(assign, "$wm_battle_result_state", 4),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(0.0, 400.0, ti_once,
		[
			(eq, "$tutorial_battle", 0)
		],

		[
			(assign, ":var_1", 0),
			(assign, ":var_2", 0),
			(get_player_agent_no, ":player_agent_no"),
			(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
			(try_for_agents, ":var_5"),
				(agent_is_human, ":var_5"),
				(agent_is_alive, ":var_5"),
				(agent_get_team, ":team_var_5", ":var_5"),
				(try_begin),
					(eq, ":team_var_5", ":team_player_agent_no"),
					(val_add, ":var_1", 1),
				(else_try),
					(val_add, ":var_2", 1),
				(try_end),
			(try_end),
			(store_mul, ":value", ":var_2", 2),
			(store_random_in_range, ":random_in_range_0_4", 0, 4),
			(try_begin),
				(eq, ":random_in_range_0_4", 0),
				(gt, ":var_1", ":value"),
				(call_script, "script_wm_count_army_damage_after_battle"),
				(call_script, "script_rand_glob_dice"),
				(assign, "$wm_battle_result_state", 4),
				(call_script, "script_wm_finish_mission_menu_popup", "mnu_wm_battle_debrief"),
			(try_end)
		]),

		(-26.0, 0.0, 0.0,
		[],

		[
			(store_trigger_param_1, ":trigger_param_1"),
			(store_trigger_param_2, ":trigger_param_2"),
			(store_trigger_param_3, ":trigger_param_3"),
			(agent_is_human, ":trigger_param_1"),
			(try_begin),
				(eq, "$bt_equipment_drop_off", 1),
				(try_for_range, ":number", 0, 4),
					(agent_get_wielded_item, ":wielded_item_trigger_param_1_number", ":trigger_param_1", ":number"),
					(gt, ":wielded_item_trigger_param_1_number", 0),
					(agent_unequip_item, ":trigger_param_1", ":wielded_item_trigger_param_1_number"),
				(try_end),
			(try_end),
			(call_script, "script_dead_num_slot_mission_count", ":trigger_param_1", ":trigger_param_3", ":trigger_param_2")
		]),

		(0.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(this_or_next|key_clicked, 47),
				(game_key_clicked, 22),
				(neg|is_presentation_active, "prsnt_battle"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_battle"),
			(try_end)
		]),

		(0.5, 0.0, 0.0,
		[],

		[
			(try_begin),
				(neg|is_presentation_active, "prsnt_battle"),
				(neg|is_presentation_active, "prsnt_mini_map"),
				(presentation_set_duration, 0),
				(start_presentation, "prsnt_mini_map"),
			(try_end),
			(try_begin),
				(is_presentation_active, "prsnt_battle"),
				(call_script, "script_update_order_panel_statistics_and_map"),
				(call_script, "script_update_order_panel", "$bt_player_team"),
			(else_try),
				(is_presentation_active, "prsnt_mini_map"),
				(call_script, "script_update_order_panel_map"),
			(try_end)
		]),

		(3.0, 0.0, 0.0,
		[],

		[
			(try_begin),
				(is_presentation_active, "prsnt_mini_map"),
				(start_presentation, "prsnt_mini_map"),
			(try_end)
		]),

		(5.0, 2.0, 0.0,
		[
			(this_or_next|le, "$minimap_ally_team_num", 20),
			(le, "$minimap_enemy_team_num", 20)
		],

		[
			(try_begin),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(call_script, "script_alive_count_global_sett", 0),
				(this_or_next|le, "$minimap_ally_team_num", 20),
				(le, "$minimap_enemy_team_num", 20),
				(get_player_agent_no, ":player_agent_no"),
				(agent_get_team, ":team_player_agent_no", ":player_agent_no"),
				(try_begin),
					(eq, ":team_player_agent_no", 0),
					(assign, ":value", 1),
				(else_try),
					(eq, ":team_player_agent_no", 1),
					(assign, ":value", 0),
				(try_end),
				(try_for_agents, ":var_4"),
					(agent_is_human, ":var_4"),
					(agent_is_alive, ":var_4"),
					(agent_get_team, ":team_var_4", ":var_4"),
					(neq, ":var_4", ":player_agent_no"),
					(assign, ":value_2", 0),
					(try_begin),
						(eq, ":team_var_4", ":team_player_agent_no"),
						(le, "$minimap_ally_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_ally_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_ally_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_ally_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_ally_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(try_begin),
						(eq, ":team_var_4", ":value"),
						(le, "$minimap_enemy_team_num", 20),
						(assign, ":value_2", 1),
						(assign, ":value_3", 0),
						(try_begin),
							(le, "$minimap_enemy_team_num", 6),
							(assign, ":value_3", 15),
						(else_try),
							(le, "$minimap_enemy_team_num", 10),
							(assign, ":value_3", 11),
						(else_try),
							(le, "$minimap_enemy_team_num", 15),
							(assign, ":value_3", 8),
						(else_try),
							(le, "$minimap_enemy_team_num", 20),
							(assign, ":value_3", 5),
						(try_end),
					(try_end),
					(eq, ":value_2", 1),
					(store_agent_hit_points, ":agent_hit_points_var_4_0", ":var_4", 0),
					(try_begin),
						(gt, ":agent_hit_points_var_4_0", ":value_3"),
						(val_sub, ":agent_hit_points_var_4_0", ":value_3"),
						(agent_set_hit_points, ":var_4", ":agent_hit_points_var_4_0", 0),
					(else_try),
						(set_show_messages, 0),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(agent_deliver_damage_to_agent, ":var_4", ":var_4", 1255),
						(set_show_messages, 1),
					(try_end),
				(try_end),
			(try_end)
		])
	]),

]